<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Gregoire Urvoy – projet_4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Gregoire Urvoy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./home.html"> 
<span class="menu-text">Home page</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-visualizations" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Visualizations</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-visualizations">    
        <li>
    <a class="dropdown-item" href="./visualization_using_Tableau.html">
 <span class="dropdown-text">Visualization using Tableau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./visualization_using_R.html">
 <span class="dropdown-text">Visualization using R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-academic-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Academic projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-academic-projects">    
        <li>
    <a class="dropdown-item" href="./projet_1.html">
 <span class="dropdown-text">Analysis of ESG factors in investment decisionmaking (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_2.html">
 <span class="dropdown-text">Estimating market capitalisation of companies using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_3.html">
 <span class="dropdown-text">House prices predictions using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_5.html">
 <span class="dropdown-text">Images classifier using deep learning and machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_4.html">
 <span class="dropdown-text">Open food facts dataset: simple analysis (2021)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-work-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Work project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-work-project">    
        <li>
    <a class="dropdown-item" href="./w_projet_1.html">
 <span class="dropdown-text">Proposal for a Maturity Continuum Model for Open Research Data (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./w_projet_2.html">
 <span class="dropdown-text">Performance analysis of marathon runners using Strava data (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-football-stories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Football stories</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-football-stories">    
        <li>
    <a class="dropdown-item" href="./premiere_league.html">
 <span class="dropdown-text">Premier league - Simply the best</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./manchester.html">
 <span class="dropdown-text">Manchester - Blue or Red? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./t_maps.html">
 <span class="dropdown-text">How to plot maps with R?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./t_animated.html">
 <span class="dropdown-text">How to animate your plots with R? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/gr%C3%A9goire-urvoy-456347a8/"> <i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#open-food-facts-dataset-simple-analysis" id="toc-open-food-facts-dataset-simple-analysis" class="nav-link active" data-scroll-target="#open-food-facts-dataset-simple-analysis">Open food facts dataset: simple analysis</a></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="..\..\Documents\ML\Course_2\09_Course_Project\Projet2_to_R-preview.html"><i class="bi bi-journal-code"></i>1. Importing and cleaning the data</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="open-food-facts-dataset-simple-analysis" class="level1">
<h1>Open food facts dataset: simple analysis</h1>
<p>The goal of this project was simply to clean and put the data in the best possible shape for analysis.</p>
<p>The dataset contains food products listing the ingredients and nutritional facts of more than 300’000 foods from over 150 countries in the world.</p>
</section>
<div class="quarto-embed-nb-cell">
<section id="importing-and-cleaning-the-data" class="level1">
<h1>1. Importing and cleaning the data</h1>
<p>List of tasks: - dealing with missing values - standardising entries and text data - bringing text or time entries in a common format - dealing with duplicates or incorrect values - getting certain data in more useful formats</p>
<section id="import-packages" class="level2">
<h2 class="anchored" data-anchor-id="import-packages">Import packages</h2>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-the-data" class="level2">
<h2 class="anchored" data-anchor-id="import-the-data">Import the data</h2>
<p>I opened the file in a text editor and I saw that the informations were separated by a tab. The file is really big so we have to use low_memory=False to open the file in chunks.</p>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'en.openfoodfacts.org.products.tsv'</span>, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="basic-informations-on-the-database" class="level2">
<h2 class="anchored" data-anchor-id="basic-informations-on-the-database">Basic informations on the database</h2>
<p>The idea of this section was to inspect the database, understand how it is construct, the size etc.</p>
<div id="cell-9" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(356027, 163)</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>Index(['code', 'url', 'creator', 'created_t', 'created_datetime',
       'last_modified_t', 'last_modified_datetime', 'product_name',
       'generic_name', 'quantity',
       ...
       'fruits-vegetables-nuts_100g', 'fruits-vegetables-nuts-estimate_100g',
       'collagen-meat-protein-ratio_100g', 'cocoa_100g', 'chlorophyl_100g',
       'carbon-footprint_100g', 'nutrition-score-fr_100g',
       'nutrition-score-uk_100g', 'glycemic-index_100g',
       'water-hardness_100g'],
      dtype='object', length=163)</code></pre>
</div>
</div>
<p>set_option is very usefull to look at all the elements we want to see. We can then have a great overview of the data and datatype.</p>
<div id="cell-12" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">creator</th>
<th data-quarto-table-cell-role="th">created_t</th>
<th data-quarto-table-cell-role="th">created_datetime</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">carbon-footprint_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
<th data-quarto-table-cell-role="th">glycemic-index_100g</th>
<th data-quarto-table-cell-role="th">water-hardness_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000000003087</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>openfoodfacts-contributors</td>
<td>1474103866</td>
<td>2016-09-17T09:17:46Z</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>1 rows × 163 columns</p>
</div>
</div>
</div>
</section>
<section id="dealing-with-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-missing-values">Dealing with missing values</h2>
<p>Let’s check first how many columns are completely empty. We delete them and check back if it is well done.</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(data.isnull().<span class="bu">sum</span>() <span class="op">==</span> data.shape[<span class="dv">0</span>]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>16</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data.dropna(how<span class="op">=</span><span class="st">'all'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data.dropna(how<span class="op">=</span><span class="st">'all'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(data.isnull().<span class="bu">sum</span>() <span class="op">==</span> data.shape[<span class="dv">0</span>]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">30</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>code                                        26
url                                         26
creator                                      3
created_t                                    3
created_datetime                            10
last_modified_t                              0
last_modified_datetime                       0
product_name                             17512
generic_name                            298313
quantity                                236742
packaging                               266068
packaging_tags                          266068
brands                                   29050
brands_tags                              29070
categories                              252728
                                         ...  
fluoride_100g                           355928
selenium_100g                           354846
chromium_100g                           356004
molybdenum_100g                         356007
iodine_100g                             355739
caffeine_100g                           355936
taurine_100g                            355994
ph_100g                                 355975
fruits-vegetables-nuts_100g             352799
fruits-vegetables-nuts-estimate_100g    355623
collagen-meat-protein-ratio_100g        355845
cocoa_100g                              354644
carbon-footprint_100g                   355749
nutrition-score-fr_100g                 101171
nutrition-score-uk_100g                 101171
Length: 147, dtype: int64</code></pre>
</div>
</div>
<p>We can see that many columnns are almost empty. We have to select a threshold to delete columns that do not have enough data. I first use an arbitrary threshold of 50%. I will adjust it later if I think it is not adequate.</p>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data.dropna(axis<span class="op">=</span><span class="dv">1</span>, thresh<span class="op">=</span><span class="fl">0.5</span><span class="op">*</span>data.shape[<span class="dv">0</span>],inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>code                           26
url                            26
creator                         3
created_t                       3
created_datetime               10
last_modified_t                 0
last_modified_datetime          0
product_name                17512
brands                      29050
brands_tags                 29070
countries                     275
countries_tags                275
countries_en                  275
ingredients_text            72134
serving_size               139406
                            ...  
nutrition_grade_fr         101171
states                         52
states_tags                    52
states_en                      52
energy_100g                 60660
fat_100g                    76530
saturated-fat_100g          92204
carbohydrates_100g          76807
sugars_100g                 76841
fiber_100g                 135344
proteins_100g               61866
salt_100g                   66288
sodium_100g                 66333
nutrition-score-fr_100g    101171
nutrition-score-uk_100g    101171
Length: 34, dtype: int64</code></pre>
</div>
</div>
<p>We went from 147 columns to 34 columns with this threshold. We can see that we still have many interesting columnns such as the brands, countries, ingredients and the main nutritional variables. And even if we still have columns with a lot of missing values, each of them have more than 200’000 values which I guess is sufficient for the analysis. So this threshold could be great.</p>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(356027, 34)</code></pre>
</div>
</div>
<p>Here we drop columns that display the same information in multiple formats. We keep the simplest format.</p>
<div id="cell-25" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data.drop([<span class="st">'brands'</span>,<span class="st">'countries'</span>,<span class="st">'countries_tags'</span>,<span class="st">'states'</span>,<span class="st">'states_tags'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(356027, 29)</code></pre>
</div>
</div>
<p>We can see that some columns have exactly the same number of missing values. It could be that they have they are the same even if they do not have the same name. For example, let’s check if nutrition_grade_fr, nutrition-score-fr_100g and nutrition-score-uk_100g are the same.</p>
<div id="cell-27" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'nutrition-score-fr_100g'</span>].equals(data[<span class="st">'nutrition-score-uk_100g'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>False</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'nutrition-score-fr_100g'</span>].equals(data[<span class="st">'nutrition_grade_fr'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>False</code></pre>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'nutrition-score-uk_100g'</span>].equals(data[<span class="st">'nutrition_grade_fr'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>False</code></pre>
</div>
</div>
<p>Actually nutrition-grade_fr contains string grades so it was obvious that these columns were not equals.</p>
<p>It is also possible that the scores are linear combinations. In this case we could maybe delete one of them. Let’s check.</p>
<div id="cell-32" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'nutrition-score-fr_100g'</span>] <span class="op">!=</span> data[<span class="st">'nutrition-score-uk_100g'</span>], [<span class="st">'nutrition-score-fr_100g'</span>,<span class="st">'nutrition-score-uk_100g'</span>]].dropna()[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">185</td>
<td>18.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">190</td>
<td>2.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">231</td>
<td>13.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">238</td>
<td>14.0</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>13.0</td>
<td>2.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It is clearly not the case.</p>
<p>We can also check what is behind the columns additives_n and additives, and ingredients_from_palm_oil_n and ingredients_that_may_be_from_palm_oil_n.&nbsp;</p>
<div id="cell-35" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">'additives_n'</span>,<span class="st">'additives'</span>]][<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">additives_n</th>
<th data-quarto-table-cell-role="th">additives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>[ bananas -&gt; en:bananas ] [ vegetable-oil -...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
<td>[ peanuts -&gt; en:peanuts ] [ wheat-flour -&gt; ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
<td>[ organic-hazelnuts -&gt; en:organic-hazelnuts ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>[ organic-polenta -&gt; en:organic-polenta ] [...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that the two columns display two different informations. So we should keep boths columns. However, we will probably have to modify the structure since it looks like a bit messy.</p>
<div id="cell-37" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">'ingredients_from_palm_oil_n'</span>,<span class="st">'ingredients_that_may_be_from_palm_oil_n'</span>]][<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</th>
<th data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It looks like these two columns are equal. Let’s check.</p>
<div id="cell-39" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'ingredients_from_palm_oil_n'</span>] <span class="op">!=</span> data[<span class="st">'ingredients_that_may_be_from_palm_oil_n'</span>], [<span class="st">'ingredients_from_palm_oil_n'</span>,<span class="st">'ingredients_that_may_be_from_palm_oil_n'</span>]].dropna()[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</th>
<th data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>0.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">177</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">205</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">209</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">214</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These columns are different so we can keep it both.</p>
<p>Let’s see one row without missing values to check if everything seems OK.</p>
<div id="cell-42" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data.loc[data.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="op">==</span><span class="dv">0</span>][<span class="dv">0</span>:<span class="dv">1</span>] <span class="co"># I will often use this code to remember how my data are displayed. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">creator</th>
<th data-quarto-table-cell-role="th">created_t</th>
<th data-quarto-table-cell-role="th">created_datetime</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">proteins_100g</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sodium_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0000000004559</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>usda-ndb-import</td>
<td>1489069957</td>
<td>2017-03-09T14:32:37Z</td>
<td>...</td>
<td>17.86</td>
<td>0.635</td>
<td>0.25</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>1 rows × 29 columns</p>
</div>
</div>
</div>
<p>At first glance, everything seems OK except for the columns: - (1) created_t and last_modified_t: the date format is not very intuitive and the same information is disclose in the columns created_datetime and last_modified_datetime. Then I suggest to delete these columns. - (2) serving_size: it could be easier to extract a single column to only have the quantity in grams - (3) additives: since the structure does not look very simple, we should probably modify it</p>
<ol type="1">
<li></li>
</ol>
<div id="cell-45" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data.drop([<span class="st">'created_t'</span>,<span class="st">'last_modified_t'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section" class="level5">
<h5 class="anchored" data-anchor-id="section">(2)</h5>
<div id="cell-47" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'serving_size'</span>].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0                NaN
1       28 g (1 ONZ)
2    28 g (0.25 cup)
3    28 g (0.25 cup)
4    35 g (0.25 cup)
5     52 g (0.5 cup)
6    45 g (0.25 cup)
7     64 g (0.5 cup)
8        40 g (40 g)
9      14 g (1 Tbsp)
Name: serving_size, dtype: object</code></pre>
</div>
</div>
<p>I want to have a column which indicate the gramms. It could be easier for the analysis to display this column this way.</p>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'serving_size'</span>] <span class="op">=</span> data[<span class="st">'serving_size'</span>].<span class="bu">str</span>.split(<span class="st">'g'</span>, expand<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>] <span class="co"># Actually, it would have been more logical to use replace here. </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'serving_size'</span>].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>0    NaN
1    28 
2    28 
3    28 
4    35 
5    52 
6    45 
7    64 
8    40 
9    14 
Name: serving_size, dtype: object</code></pre>
</div>
</div>
<ol start="3" type="1">
<li></li>
</ol>
<div id="cell-51" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0                                                  NaN
1     [ bananas -&gt; en:bananas  ]  [ vegetable-oil -...
2     [ peanuts -&gt; en:peanuts  ]  [ wheat-flour -&gt; ...
3     [ organic-hazelnuts -&gt; en:organic-hazelnuts  ...
4     [ organic-polenta -&gt; en:organic-polenta  ]  [...
5     [ rolled-oats -&gt; en:rolled-oats  ]  [ oats -&gt;...
6     [ organic-long-grain-white-rice -&gt; en:organic...
7     [ org-oats -&gt; en:org-oats  ]  [ oats -&gt; en:oa...
8     [ organic-chocolate-liquor -&gt; en:organic-choc...
9     [ organic-expeller-pressed -&gt; en:organic-expe...
Name: additives, dtype: object</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data.loc[<span class="dv">1</span>,<span class="st">'additives'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>' [ bananas -&gt; en:bananas  ]  [ vegetable-oil -&gt; en:vegetable-oil  ]  [ oil -&gt; en:oil  ]  [ coconut-oil -&gt; en:coconut-oil  ]  [ oil -&gt; en:oil  ]  [ corn-oil-and-or-palm-oil-sugar -&gt; en:corn-oil-and-or-palm-oil-sugar  ]  [ oil-and-or-palm-oil-sugar -&gt; en:oil-and-or-palm-oil-sugar  ]  [ and-or-palm-oil-sugar -&gt; en:and-or-palm-oil-sugar  ]  [ or-palm-oil-sugar -&gt; en:or-palm-oil-sugar  ]  [ palm-oil-sugar -&gt; en:palm-oil-sugar  ]  [ oil-sugar -&gt; en:oil-sugar  ]  [ sugar -&gt; en:sugar  ]  [ natural-banana-flavor -&gt; en:natural-banana-flavor  ]  [ banana-flavor -&gt; en:banana-flavor  ]  [ flavor -&gt; en:flavor  ] '</code></pre>
</div>
</div>
<p>It seems that we have an original name and a translation in english. I think that keeping the original is enough.</p>
<div id="cell-54" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">'\['</span>,<span class="st">''</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">'\]'</span>,<span class="st">','</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">'-&gt;'</span>,<span class="st">''</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">'[\w]+:[\w-]+'</span>,<span class="st">''</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">'    ,'</span>,<span class="st">','</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>] <span class="op">=</span> data[<span class="st">'additives'</span>].<span class="bu">str</span>.replace(<span class="st">',   '</span>,<span class="st">', '</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'additives'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0                                                       NaN
1           bananas, vegetable-oil, oil, coconut-oil, oi...
2           peanuts, wheat-flour, flour, sugar, rice-flo...
3           organic-hazelnuts, hazelnuts, organic-cashew...
4                                organic-polenta, polenta, 
5           rolled-oats, oats, grape-concentrate, concen...
6           organic-long-grain-white-rice, long-grain-wh...
7           org-oats, oats, org-hemp-granola, hemp-grano...
8           organic-chocolate-liquor, chocolate-liquor, ...
9           organic-expeller-pressed, expeller-pressed, ...
10              organic-adzuki-beans, adzuki-beans, beans, 
11          organic-refined-durum-semolina-wheat-flour, ...
12          roasted-peanuts, peanuts, peanuts, peanut-or...
13          organic-golden-flax-seeds, golden-flax-seeds...
14          organic-dry-roasted-pumpkin-seeds, dry-roast...
                                ...                        
356012                                                  NaN
356013                                                  NaN
356014                                                  NaN
356015                                                  NaN
356016                                                  NaN
356017      the-vert, the, arome-naturel-bergamote-avec-...
356018                                                  NaN
356019      viande-d-oie, viande-d, viande, graisse-de-c...
356020                                                  NaN
356021                                                  NaN
356022      organic-peppermint, peppermint, organic-lemo...
356023                                                  NaN
356024                                                  NaN
356025                                                  NaN
356026      citric-acid     exists  -- ok  , maltodextri...
Name: additives, Length: 356027, dtype: object</code></pre>
</div>
</div>
</section>
</section>
<section id="dealing-with-duplicates" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-duplicates">Dealing with duplicates</h2>
<p>Now that the columns are more or less cleaned, we have to check for duplicates. We first delete duplicated rows. Only two rows were exactly the same.</p>
<div id="cell-57" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(356027, 27)</code></pre>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(356026, 27)</code></pre>
</div>
</div>
</section>
<section id="duplicated-values-corrected" class="level2">
<h2 class="anchored" data-anchor-id="duplicated-values-corrected">Duplicated values (corrected)</h2>
<div id="cell-60" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'code'</span>].is_unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>False</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>data.duplicated(subset<span class="op">=</span>[<span class="st">'product_name'</span>,<span class="st">'brands_tags'</span>,<span class="st">'countries_en'</span>,<span class="st">'additives_n'</span>, <span class="st">'additives'</span>, <span class="st">'fat_100g'</span>,<span class="st">'proteins_100g'</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'carbohydrates_100g'</span>,<span class="st">'sugars_100g'</span>,<span class="st">'carbohydrates_100g'</span>,<span class="st">'energy_100g'</span>,<span class="st">'fiber_100g'</span>,<span class="st">'sodium_100g'</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'nutrition_grade_fr'</span>]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>18281</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data.drop_duplicates(subset<span class="op">=</span>[<span class="st">'product_name'</span>,<span class="st">'brands_tags'</span>,<span class="st">'countries_en'</span>,<span class="st">'additives_n'</span>, <span class="st">'additives'</span>, <span class="st">'fat_100g'</span>,<span class="st">'proteins_100g'</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'carbohydrates_100g'</span>,<span class="st">'sugars_100g'</span>,<span class="st">'carbohydrates_100g'</span>,<span class="st">'energy_100g'</span>,<span class="st">'fiber_100g'</span>,<span class="st">'sodium_100g'</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'nutrition_grade_fr'</span>], inplace<span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>(337745, 27)</code></pre>
</div>
</div>
</section>
</section>
<section id="correction-incorrect-values" class="level1">
<h1>Correction: Incorrect values</h1>
<div id="cell-65" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">additives_n</td>
<td>279400.0</td>
<td>1.883336</td>
<td>2.506148e+00</td>
<td>0.00</td>
<td>0.00000</td>
<td>1.00000</td>
<td>3.00000</td>
<td>3.000000e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</td>
<td>279400.0</td>
<td>0.023733</td>
<td>1.540627e-01</td>
<td>0.00</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.00000</td>
<td>2.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</td>
<td>279400.0</td>
<td>0.060175</td>
<td>2.817863e-01</td>
<td>0.00</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.00000</td>
<td>6.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">energy_100g</td>
<td>291003.0</td>
<td>1125.392223</td>
<td>9.359866e+02</td>
<td>0.00</td>
<td>385.00000</td>
<td>1092.00000</td>
<td>1674.00000</td>
<td>2.311990e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat_100g</td>
<td>275165.0</td>
<td>56948.287011</td>
<td>2.986620e+07</td>
<td>0.00</td>
<td>0.10000</td>
<td>5.36000</td>
<td>20.00000</td>
<td>1.566667e+10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">saturated-fat_100g</td>
<td>260344.0</td>
<td>5.093285</td>
<td>7.966458e+00</td>
<td>0.00</td>
<td>0.00000</td>
<td>1.79000</td>
<td>7.14000</td>
<td>5.500000e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carbohydrates_100g</td>
<td>274890.0</td>
<td>57024.071743</td>
<td>2.988114e+07</td>
<td>0.00</td>
<td>5.70000</td>
<td>20.00000</td>
<td>57.58000</td>
<td>1.566667e+10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugars_100g</td>
<td>275400.0</td>
<td>15.654440</td>
<td>2.194866e+01</td>
<td>-17.86</td>
<td>1.20000</td>
<td>5.41000</td>
<td>23.33000</td>
<td>3.520000e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fiber_100g</td>
<td>217771.0</td>
<td>389486.118953</td>
<td>1.817560e+08</td>
<td>-6.70</td>
<td>0.00000</td>
<td>1.50000</td>
<td>3.60000</td>
<td>8.481815e+10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">proteins_100g</td>
<td>289803.0</td>
<td>54066.891315</td>
<td>2.910215e+07</td>
<td>-800.00</td>
<td>0.80000</td>
<td>4.90000</td>
<td>10.00000</td>
<td>1.566667e+10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">salt_100g</td>
<td>285400.0</td>
<td>1.948576</td>
<td>1.214554e+02</td>
<td>0.00</td>
<td>0.06096</td>
<td>0.56388</td>
<td>1.36144</td>
<td>6.431280e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sodium_100g</td>
<td>285356.0</td>
<td>0.767272</td>
<td>4.782076e+01</td>
<td>0.00</td>
<td>0.02400</td>
<td>0.22200</td>
<td>0.53600</td>
<td>2.532000e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nutrition-score-fr_100g</td>
<td>251751.0</td>
<td>9.179725</td>
<td>8.996432e+00</td>
<td>-15.00</td>
<td>1.00000</td>
<td>10.00000</td>
<td>16.00000</td>
<td>4.000000e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nutrition-score-uk_100g</td>
<td>251751.0</td>
<td>8.992632</td>
<td>9.149331e+00</td>
<td>-15.00</td>
<td>1.00000</td>
<td>9.00000</td>
<td>16.00000</td>
<td>4.000000e+01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>First of all, we can delete the values greater than 100 and lower than 0 for all the columns “_100g”.</p>
<div id="cell-67" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'sugars_100g'</span>]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'fiber_100g'</span>]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'proteins_100g'</span>]<span class="op">&lt;</span><span class="dv">0</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'fat_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'saturated-fat_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'carbohydrates_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'sugars_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'fiber_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'proteins_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'salt_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'sodium_100g'</span>]<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">==</span> <span class="va">False</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot the columns to see the distribution of the data.</p>
<div id="cell-69" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span>  plt</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> data.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>]).columns</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> cols <span class="cf">if</span> c.endswith(<span class="st">'_100g'</span>)]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>,ncols<span class="op">=</span><span class="dv">6</span>,figsize<span class="op">=</span>(<span class="dv">18</span>,<span class="dv">10</span>))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(cols,axes.ravel()):</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    ax.boxplot(data[data[col].notnull()][col],whis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)   </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It seems that we still have outliers for the variable “energy_100g”. The unit of this column is kJ. If a value contains only fat (fat has the biggest ratio kJ/g), we will have 3700 kJ (since 1 g of fat = 37 kJ). So the maximum value for the variable “energy_100g” should be around 3700.</p>
<div id="cell-71" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[(data[<span class="st">'energy_100g'</span>]<span class="op">&gt;</span><span class="dv">3700</span>) <span class="op">==</span> <span class="va">False</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-72" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">additives_n</td>
<td>278578.0</td>
<td>1.887881</td>
<td>2.507591</td>
<td>0.0</td>
<td>0.0000</td>
<td>1.000000</td>
<td>3.00000</td>
<td>30.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</td>
<td>278578.0</td>
<td>0.023785</td>
<td>0.154229</td>
<td>0.0</td>
<td>0.0000</td>
<td>0.000000</td>
<td>0.00000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</td>
<td>278578.0</td>
<td>0.060292</td>
<td>0.282050</td>
<td>0.0</td>
<td>0.0000</td>
<td>0.000000</td>
<td>0.00000</td>
<td>6.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">energy_100g</td>
<td>290040.0</td>
<td>1116.545818</td>
<td>781.878912</td>
<td>0.0</td>
<td>385.0000</td>
<td>1088.000000</td>
<td>1674.00000</td>
<td>3700.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat_100g</td>
<td>274302.0</td>
<td>12.576261</td>
<td>16.892244</td>
<td>0.0</td>
<td>0.1000</td>
<td>5.300000</td>
<td>20.00000</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">saturated-fat_100g</td>
<td>259516.0</td>
<td>5.033026</td>
<td>7.676326</td>
<td>0.0</td>
<td>0.0000</td>
<td>1.790000</td>
<td>7.14000</td>
<td>100.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carbohydrates_100g</td>
<td>274049.0</td>
<td>31.634179</td>
<td>28.926628</td>
<td>0.0</td>
<td>5.8000</td>
<td>20.000000</td>
<td>57.69000</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugars_100g</td>
<td>274692.0</td>
<td>15.662005</td>
<td>20.902320</td>
<td>0.0</td>
<td>1.2500</td>
<td>5.450000</td>
<td>23.33000</td>
<td>100.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fiber_100g</td>
<td>217220.0</td>
<td>2.855617</td>
<td>4.674337</td>
<td>0.0</td>
<td>0.0000</td>
<td>1.500000</td>
<td>3.60000</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">proteins_100g</td>
<td>288874.0</td>
<td>7.193215</td>
<td>8.250806</td>
<td>0.0</td>
<td>0.8000</td>
<td>5.000000</td>
<td>10.00000</td>
<td>100.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">salt_100g</td>
<td>284476.0</td>
<td>1.544124</td>
<td>6.080513</td>
<td>0.0</td>
<td>0.0635</td>
<td>0.568960</td>
<td>1.36144</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sodium_100g</td>
<td>284432.0</td>
<td>0.608016</td>
<td>2.394069</td>
<td>0.0</td>
<td>0.0250</td>
<td>0.224409</td>
<td>0.53600</td>
<td>39.370079</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nutrition-score-fr_100g</td>
<td>251081.0</td>
<td>9.162167</td>
<td>8.996656</td>
<td>-15.0</td>
<td>1.0000</td>
<td>10.000000</td>
<td>16.00000</td>
<td>40.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nutrition-score-uk_100g</td>
<td>251081.0</td>
<td>8.966995</td>
<td>9.144365</td>
<td>-15.0</td>
<td>1.0000</td>
<td>9.000000</td>
<td>16.00000</td>
<td>37.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="manipulating-the-data" class="level1">
<h1>2. Manipulating the data</h1>
<p>My 3 questions are the following: - (1) What are the countries that produce the most “unhealthy” foods in term of fat and sugar? VS the most healthy? - (2) What does a food with a high nutrient score look like in terms of nutrients? VS a small one? - (3) How are energy, fat, saturated fat, sugar and salt related to the nutrition grade ?</p>
<ol type="1">
<li></li>
</ol>
<p>For this question, I would like to have 4 lists: - the top 10 countries that produce products with the most fat - the top 10 countries that produce products with the most sugar - the top 10 countries that produce products with the least fat - the top 10 countries that produce products with the least sugar</p>
<p>Then I want to plot the results and to see if there are countries on both lists (fat and sugar).</p>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">##### NOT USEFULL ANYMORE #####</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Let's have a look at the main statistics about these rows.</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data[['fat_100g','sugars_100g']].describe()</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see that some products have extreme values. For example, a product has 3520g of sugars per 100g. It should be a mistake.</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to delete all the rows that have more than 100g in fat_100g, sugars_100g and fat_100g + sugars_100g. (We could think that deleting the rows for fat_100g + sugars_100g is enough but it is not because of NaN values). </span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># len(data)</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># data = data[((data['fat_100g']+data['sugars_100g'])&gt;100) == False]</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># data = data[((data['fat_100g'])&gt;100) == False]</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># data = data[((data['sugars_100g'])&gt;100) == False]</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># len(data)</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># I also want to delete the rows with negative values.</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># data = data[(data['fat_100g']&lt;0) == False]</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># data = data[(data['sugars_100g']&lt;0) == False]</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># len(data)</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;data[['fat_100g','sugars_100g']].describe()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">10</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> data.groupby(<span class="st">'countries_en'</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> q1.mean()[[<span class="st">'fat_100g'</span>,<span class="st">'sugars_100g'</span>]]</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fat_100g</th>
<th data-quarto-table-cell-role="th">sugars_100g</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">countries_en</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>15.0</td>
<td>7.0000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Albania,Denmark,Italy</td>
<td>0.8</td>
<td>1.0000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania,France</td>
<td>11.0</td>
<td>16.0000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Albania,Italy</td>
<td>7.6</td>
<td>12.1875</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">भारत</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ព្រះរាជាណាចក្រកម្ពុជា</td>
<td>0.0</td>
<td>1.3400</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">中华人民共和国</td>
<td>12.0</td>
<td>12.0000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">日本</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">香港</td>
<td>0.0</td>
<td>13.6000</td>
</tr>
</tbody>
</table>

<p>779 rows × 2 columns</p>
</div>
</div>
</div>
<p>The first problem is that we have sometimes multiples countries in 1 row. How many rows does it represent?</p>
<div id="cell-80" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'countries_en'</span>].<span class="bu">str</span>.contains(<span class="st">','</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>6383</code></pre>
</div>
</div>
<p>And how many non-missing values has this column?</p>
<div id="cell-82" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'countries_en'</span>].count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>336546</code></pre>
</div>
</div>
<p>If this ratio is small, we could simply delete these rows from our dataframe. Let’s compute it.</p>
<div id="cell-84" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The ratio is equal to:'</span> ,  <span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>data[<span class="st">'countries_en'</span>].<span class="bu">str</span>.contains(<span class="st">','</span>).<span class="bu">sum</span>()<span class="op">/</span>data[<span class="st">'countries_en'</span>].count(),<span class="dv">3</span>) , <span class="st">'%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The ratio is equal to: 1.897 %</code></pre>
</div>
</div>
<p>The ratio is very low so we delete the corresponding rows for the analysis. (To be honnest, I also tried to separate each countries and duplicate the row for each one, but I did not find an easy way to achieve that. Do you have any advices?)</p>
<div id="cell-86" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>datatest <span class="op">=</span> data.copy()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>datatest <span class="op">=</span> datatest[data[<span class="st">'countries_en'</span>].<span class="bu">str</span>.contains(<span class="st">','</span>)<span class="op">==</span><span class="va">False</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify that we do not have anymore this problem.</p>
<div id="cell-88" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.contains(<span class="st">','</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0</code></pre>
</div>
</div>
<p>I translate some country names:</p>
<div id="cell-90" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'香港'</span>,<span class="st">'Hong Kong'</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'ព្រះរាជាណាចក្រកម្ពុជា'</span>,<span class="st">'Cambodia'</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'भारत'</span>,<span class="st">'India'</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Other-turquie'</span>,<span class="st">'Turkey'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Republique-de-chine'</span>,<span class="st">'China'</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Other-japon'</span>,<span class="st">'Japan'</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'السعودية'</span>,<span class="st">'Saudi Arabia'</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'fr:Quebec'</span>,<span class="st">'Canada'</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'French Guiana'</span>,<span class="st">'France'</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Réunion'</span>,<span class="st">'France'</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Guadeloupe'</span>,<span class="st">'France'</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>datatest[<span class="st">'countries_en'</span>] <span class="op">=</span> datatest[<span class="st">'countries_en'</span>].<span class="bu">str</span>.replace(<span class="st">'Belgie'</span>,<span class="st">'Belgium '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-91" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>datatest.drop(datatest[(datatest[<span class="st">'countries_en'</span>] <span class="op">==</span><span class="st">'World'</span>)<span class="op">==</span><span class="va">True</span>].index, inplace<span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>datatest.drop(datatest[(datatest[<span class="st">'countries_en'</span>] <span class="op">==</span><span class="st">'European Union'</span>)<span class="op">==</span><span class="va">True</span>].index, inplace<span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply a filter that take only the countries with more than 10 products. Otherwise, some countries will be in the top because of a very small number of products.</p>
<div id="cell-93" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> datatest.groupby(<span class="st">'countries_en'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> q1.count()[(q1.count()[<span class="st">'fat_100g'</span>]<span class="op">&gt;</span><span class="dv">10</span>) <span class="op">|</span> (q1.count()[<span class="st">'sugars_100g'</span>]<span class="op">&gt;</span><span class="dv">10</span>) ]</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>q1.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>Index(['Argentina', 'Australia', 'Austria', 'Belgium', 'Belgium ', 'Brazil',
       'Bulgaria', 'Canada', 'Chile', 'China', 'Colombia', 'Czech Republic',
       'Denmark', 'France', 'Germany', 'Greece', 'Hong Kong', 'Hungary',
       'India', 'Ireland', 'Italy', 'Japan', 'Luxembourg', 'Madagascar',
       'Mexico', 'Netherlands', 'New Zealand', 'Norway', 'Poland', 'Portugal',
       'Romania', 'Russia', 'Saint Pierre and Miquelon', 'Saudi Arabia',
       'Senegal', 'Serbia', 'South Africa', 'Spain', 'Sweden', 'Switzerland',
       'Taiwan', 'Thailand', 'Tunisia', 'Turkey', 'United Kingdom',
       'United States'],
      dtype='object', name='countries_en')</code></pre>
</div>
</div>
<div id="cell-94" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>datatest <span class="op">=</span> datatest[datatest[<span class="st">'countries_en'</span>].isin(q1.index)]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>q2 <span class="op">=</span> datatest.groupby(<span class="st">'countries_en'</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>q2 <span class="op">=</span> q2.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-95" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>top10_fat_worst <span class="op">=</span> q2[[<span class="st">'fat_100g'</span>]].sort_values(<span class="st">'fat_100g'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="dv">0</span>:<span class="dv">10</span>].iloc[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>top10_fat_best <span class="op">=</span> q2[[<span class="st">'fat_100g'</span>]].sort_values(<span class="st">'fat_100g'</span>, ascending<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>:<span class="dv">10</span>].iloc[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>top10_sugars_worst <span class="op">=</span> q2[[<span class="st">'sugars_100g'</span>]].sort_values(<span class="st">'sugars_100g'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="dv">0</span>:<span class="dv">10</span>].iloc[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>top10_sugars_best <span class="op">=</span> q2[[<span class="st">'sugars_100g'</span>]].sort_values(<span class="st">'sugars_100g'</span>, ascending<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>:<span class="dv">10</span>].iloc[::<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-96" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>plt.barh(top10_fat_best.index,top10_fat_best[<span class="st">'fat_100g'</span>], color<span class="op">=</span><span class="st">'lightskyblue'</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Best countries'</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'fat per 100g'</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">25</span>])</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>plt.barh(top10_fat_worst.index,top10_fat_worst[<span class="st">'fat_100g'</span>], color<span class="op">=</span><span class="st">'salmon'</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'fat per 100g'</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Worst countries'</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Best and worst countries in terms of "fat products"'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="va">None</span>, bottom<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>, top<span class="op">=</span><span class="va">None</span>, wspace<span class="op">=</span><span class="fl">0.7</span>, hspace<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-97" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.barh(top10_sugars_best.index,top10_sugars_best[<span class="st">'sugars_100g'</span>], color<span class="op">=</span><span class="st">'lightskyblue'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Best countries'</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'sugars per 100g'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">60</span>])</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>plt.barh(top10_sugars_worst.index,top10_sugars_worst[<span class="st">'sugars_100g'</span>], color<span class="op">=</span><span class="st">'salmon'</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'sugars per 100g'</span>)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Worst countries'</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Best and worst countries in terms of "sugar products"'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="va">None</span>, bottom<span class="op">=</span><span class="va">None</span>, right<span class="op">=</span><span class="va">None</span>, top<span class="op">=</span><span class="va">None</span>, wspace<span class="op">=</span><span class="fl">0.4</span>, hspace<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-98" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(top10_sugars_best.index) <span class="op">&amp;</span> <span class="bu">set</span>(top10_fat_best.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>{'Belgium ', 'Thailand'}</code></pre>
</div>
</div>
<p>We can see that Belgium and Thailand are in both the best countries in terms of fat and sugar.</p>
<div id="cell-100" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(top10_sugars_worst.index) <span class="op">&amp;</span> <span class="bu">set</span>(top10_fat_worst.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>{'Bulgaria', 'Czech Republic', 'Madagascar', 'Senegal', 'Tunisia'}</code></pre>
</div>
</div>
<p>We can see that Bulgaria, Czech Republic, Madagascar, Senegal and Tunisia are in both the worst countries in terms of fat and sugar.</p>
<ol start="2" type="1">
<li></li>
</ol>
<p>For this question, I take the top 100 best and worse ingredients in term of nutrition score. Then I do the average of these ingredients. And finally I do the breakdown of the nutrients.</p>
<div id="cell-104" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>top_100_best <span class="op">=</span> data.sort_values(<span class="st">'nutrition-score-fr_100g'</span>)[<span class="dv">0</span>:<span class="dv">100</span>].mean()[[<span class="st">'fat_100g'</span>,<span class="st">'sugars_100g'</span>,<span class="st">'proteins_100g'</span>]]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>top_100_best <span class="op">=</span> top_100_best <span class="op">/</span> (top_100_best[<span class="dv">0</span>]<span class="op">+</span>top_100_best[<span class="dv">1</span>]<span class="op">+</span>top_100_best[<span class="dv">2</span>])</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>top_100_best</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>fat_100g         0.083829
sugars_100g      0.156272
proteins_100g    0.759899
dtype: float64</code></pre>
</div>
</div>
<div id="cell-105" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>top_100_worse <span class="op">=</span> data.sort_values(<span class="st">'nutrition-score-fr_100g'</span>,ascending<span class="op">=</span><span class="va">False</span>)[<span class="dv">0</span>:<span class="dv">100</span>].mean()[[<span class="st">'fat_100g'</span>,<span class="st">'sugars_100g'</span>,<span class="st">'proteins_100g'</span>]]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>top_100_worse <span class="op">=</span> top_100_worse <span class="op">/</span> (top_100_worse[<span class="dv">0</span>]<span class="op">+</span>top_100_worse[<span class="dv">1</span>]<span class="op">+</span>top_100_worse[<span class="dv">2</span>])</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>top_100_worse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>fat_100g         0.307187
sugars_100g      0.605964
proteins_100g    0.086849
dtype: float64</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>best <span class="op">=</span> pd.DataFrame(top_100_best).T</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>worse <span class="op">=</span> pd.DataFrame(top_100_worse).T</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>best <span class="op">=</span> best.append(worse)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>best</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fat_100g</th>
<th data-quarto-table-cell-role="th">sugars_100g</th>
<th data-quarto-table-cell-role="th">proteins_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.083829</td>
<td>0.156272</td>
<td>0.759899</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0.307187</td>
<td>0.605964</td>
<td>0.086849</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="st">'Best'</span>,<span class="st">'Worst'</span>]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>))</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>plt.barh(x,best.fat_100g,edgecolor<span class="op">=</span><span class="st">'black'</span>,color<span class="op">=</span><span class="st">'lightblue'</span> , label<span class="op">=</span><span class="st">'fat'</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>plt.barh(x,best.sugars_100g, left<span class="op">=</span>best.fat_100g, color<span class="op">=</span><span class="st">'lightpink'</span>,edgecolor<span class="op">=</span><span class="st">'black'</span>,label<span class="op">=</span><span class="st">'sugars'</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>plt.barh(x,best.proteins_100g, left<span class="op">=</span>best.fat_100g <span class="op">+</span>best.sugars_100g ,edgecolor<span class="op">=</span><span class="st">'black'</span>, color<span class="op">=</span><span class="st">'lightgreen'</span>,label<span class="op">=</span><span class="st">'proteins'</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'</span><span class="sc">% o</span><span class="st">f nutrients'</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Best and worse ingredients'</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Breakdown of the nutrients per class of ingredients'</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.3</span>, <span class="dv">1</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the best and worst ingredients clearly have a different breakdown in terms of nutrinents. The best ingredients have more proteinns, less sugar and less fat.</p>
<ol start="3" type="1">
<li></li>
</ol>
<p>For this question, I want to display a graph with the nutrition grades in the x axis and the quantity of energy, fat, satured fat, sugar and salt in the y axis.</p>
<div id="cell-111" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>energy <span class="op">=</span> data[[<span class="st">'energy_100g'</span>,<span class="st">'nutrition_grade_fr'</span>]]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>energy <span class="op">=</span> energy.sort_values(<span class="st">'nutrition_grade_fr'</span>).dropna().groupby(<span class="st">'nutrition_grade_fr'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-112" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fat <span class="op">=</span> data[[<span class="st">'fat_100g'</span>,<span class="st">'nutrition_grade_fr'</span>]]</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>fat <span class="op">=</span> fat.sort_values(<span class="st">'nutrition_grade_fr'</span>).dropna().groupby(<span class="st">'nutrition_grade_fr'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-113" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>saturated_fat <span class="op">=</span> data[[<span class="st">'saturated-fat_100g'</span>,<span class="st">'nutrition_grade_fr'</span>]]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>saturated_fat <span class="op">=</span> saturated_fat.sort_values(<span class="st">'nutrition_grade_fr'</span>).dropna().groupby(<span class="st">'nutrition_grade_fr'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-114" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>salt <span class="op">=</span> data[[<span class="st">'salt_100g'</span>,<span class="st">'nutrition_grade_fr'</span>]]</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>salt <span class="op">=</span> salt.sort_values(<span class="st">'nutrition_grade_fr'</span>).dropna().groupby(<span class="st">'nutrition_grade_fr'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-115" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>sugar <span class="op">=</span> data[[<span class="st">'sugars_100g'</span>,<span class="st">'nutrition_grade_fr'</span>]]</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>sugar <span class="op">=</span> sugar.sort_values(<span class="st">'nutrition_grade_fr'</span>).dropna().groupby(<span class="st">'nutrition_grade_fr'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-116" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>aggregated <span class="op">=</span> pd.merge(energy,  fat, on<span class="op">=</span><span class="st">'nutrition_grade_fr'</span>).merge(saturated_fat,on<span class="op">=</span><span class="st">'nutrition_grade_fr'</span>).merge(salt,on<span class="op">=</span><span class="st">'nutrition_grade_fr'</span>).merge(sugar,on<span class="op">=</span><span class="st">'nutrition_grade_fr'</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>aggregated.reset_index(level<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>aggregated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nutrition_grade_fr</th>
<th data-quarto-table-cell-role="th">energy_100g</th>
<th data-quarto-table-cell-role="th">fat_100g</th>
<th data-quarto-table-cell-role="th">saturated-fat_100g</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sugars_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>a</td>
<td>729.603727</td>
<td>2.845037</td>
<td>0.444379</td>
<td>0.329303</td>
<td>3.507345</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>b</td>
<td>519.885317</td>
<td>3.909431</td>
<td>0.836318</td>
<td>0.516587</td>
<td>5.183697</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>c</td>
<td>985.000431</td>
<td>9.719998</td>
<td>2.053514</td>
<td>1.687485</td>
<td>11.240168</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>d</td>
<td>1459.681200</td>
<td>17.555623</td>
<td>5.847792</td>
<td>1.623642</td>
<td>21.040916</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>e</td>
<td>1775.809331</td>
<td>26.162110</td>
<td>13.367367</td>
<td>1.446310</td>
<td>26.180903</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-117" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated.nutrition_grade_fr, aggregated.fat_100g)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated.nutrition_grade_fr, aggregated[<span class="st">'saturated-fat_100g'</span>])</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated.nutrition_grade_fr, aggregated.salt_100g)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated.nutrition_grade_fr, aggregated.sugars_100g)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average number of grams depending of the nutrition grade'</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.5</span>, <span class="dv">1</span>))</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Nutrition grade'</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'g per 100g'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-66-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-118" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated.nutrition_grade_fr, aggregated.energy_100g)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average number of grams depending of the nutrition grade'</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="dv">1</span>))</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Nutrition grade'</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'g per 100g'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-67-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We could normalize each value in order to plot all of the categories in one graph. One idea could be to create an index with the maximum value equal to 100% for each category.</p>
<div id="cell-120" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>aggregated2 <span class="op">=</span> aggregated </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>aggregated2[<span class="st">'energy_100g'</span>] <span class="op">=</span> aggregated2[<span class="st">'energy_100g'</span>]<span class="op">/</span>aggregated2[<span class="st">'energy_100g'</span>].<span class="bu">max</span>()</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>aggregated2[<span class="st">'fat_100g'</span>] <span class="op">=</span> aggregated2[<span class="st">'fat_100g'</span>]<span class="op">/</span>aggregated2[<span class="st">'fat_100g'</span>].<span class="bu">max</span>()</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>aggregated2[<span class="st">'saturated-fat_100g'</span>] <span class="op">=</span> aggregated2[<span class="st">'saturated-fat_100g'</span>]<span class="op">/</span>aggregated2[<span class="st">'saturated-fat_100g'</span>].<span class="bu">max</span>()</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>aggregated2[<span class="st">'salt_100g'</span>] <span class="op">=</span> aggregated2[<span class="st">'salt_100g'</span>]<span class="op">/</span>aggregated2[<span class="st">'salt_100g'</span>].<span class="bu">max</span>()</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>aggregated2[<span class="st">'sugars_100g'</span>] <span class="op">=</span> aggregated2[<span class="st">'sugars_100g'</span>]<span class="op">/</span>aggregated2[<span class="st">'sugars_100g'</span>].<span class="bu">max</span>()</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>aggregated2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nutrition_grade_fr</th>
<th data-quarto-table-cell-role="th">energy_100g</th>
<th data-quarto-table-cell-role="th">fat_100g</th>
<th data-quarto-table-cell-role="th">saturated-fat_100g</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sugars_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>a</td>
<td>0.410857</td>
<td>0.108746</td>
<td>0.033244</td>
<td>0.195144</td>
<td>0.133966</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>b</td>
<td>0.292760</td>
<td>0.149431</td>
<td>0.062564</td>
<td>0.306128</td>
<td>0.197995</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>c</td>
<td>0.554677</td>
<td>0.371530</td>
<td>0.153621</td>
<td>1.000000</td>
<td>0.429327</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>d</td>
<td>0.821981</td>
<td>0.671032</td>
<td>0.437468</td>
<td>0.962167</td>
<td>0.803674</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>e</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.857080</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-121" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated2.nutrition_grade_fr, aggregated2.fat_100g)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated2.nutrition_grade_fr, aggregated2[<span class="st">'saturated-fat_100g'</span>])</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated2.nutrition_grade_fr, aggregated2.salt_100g)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated2.nutrition_grade_fr, aggregated2.sugars_100g)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>plt.plot(aggregated2.nutrition_grade_fr, aggregated2.energy_100g)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Evolution of the number of grams depending of the nutrition grade'</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.5</span>, <span class="dv">1</span>))</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Nutrition grade'</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Index'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that for each chosen category, the number of grams increase when the nutrition decrease. The results were expected since I have chosen categories such as sugars and fat.</p>
</section>
<section id="text-data" class="level1">
<h1>3. Text data</h1>
<p>Goal: find the five most common ingredients.</p>
<p>The question is not explicit wether we should consider the raw ingredients or not. I made the choice not to include them in the analysis. By raw ingredients, I mean what is inside the brackets. For example, if I look at the first line, I will only include vegetable oil, and not coconut or corn oil.</p>
<p>I first explore the data to see what changes should be made.</p>
<div id="cell-127" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'ingredients_text'</span>].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>0                                                  NaN
1    Bananas, vegetable oil (coconut oil, corn oil ...
2    Peanuts, wheat flour, sugar, rice flour, tapio...
3    Organic hazelnuts, organic cashews, organic wa...
4                                      Organic polenta
Name: ingredients_text, dtype: object</code></pre>
</div>
</div>
<p>We should put everything in lower case.</p>
<div id="cell-129" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> data[<span class="st">'ingredients_text'</span>].<span class="bu">str</span>.lower()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-130" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>lst[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>'bananas, vegetable oil (coconut oil, corn oil and/or palm oil) sugar, natural banana flavor.'</code></pre>
</div>
</div>
<p>We can see that there are raw ingredients in brackets. I should delete what is inside the ().</p>
<div id="cell-132" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'\(.*?\)'</span>,<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-133" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>lst[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>'organic hazelnuts, organic cashews, organic walnuts almonds, organic sunflower oil, sea salt.'</code></pre>
</div>
</div>
<p>We should also delete “organic”, “org”, “Organic” and “Org” since it does not change the ingredient itself.</p>
<div id="cell-135" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'Organic'</span>,<span class="st">''</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'Org'</span>,<span class="st">''</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'organic'</span>,<span class="st">''</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'org'</span>,<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should also delete special characters at the end of the row.</p>
<div id="cell-137" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'.'</span>,<span class="st">''</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'_'</span>,<span class="st">''</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\'</span><span class="st">'</span>,<span class="st">''</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">':'</span>,<span class="st">''</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'-'</span>,<span class="st">''</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'\*'</span>,<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could finally delete the space to be sure that all ingredients are formatted the same way.</p>
<div id="cell-139" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">',\s+'</span>,<span class="st">','</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'\s+,'</span>,<span class="st">','</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the column is more or less cleaned, the remaining problem is the separated commas. We have to separated each ingredients from the commas.</p>
<div id="cell-141" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>list_ingredients <span class="op">=</span> lst.dropna().<span class="bu">str</span>.split(<span class="st">','</span>,expand<span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-142" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>list_ingredients.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">113</th>
<th data-quarto-table-cell-role="th">114</th>
<th data-quarto-table-cell-role="th">115</th>
<th data-quarto-table-cell-role="th">116</th>
<th data-quarto-table-cell-role="th">117</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>bananas</td>
<td>vegetable oil sugar</td>
<td>natural banana flavor</td>
<td>None</td>
<td>None</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>peanuts</td>
<td>wheat flour</td>
<td>sugar</td>
<td>rice flour</td>
<td>tapioca starch</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>hazelnuts</td>
<td>cashews</td>
<td>walnuts almonds</td>
<td>sunflower oil</td>
<td>sea salt</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>

<p>3 rows × 118 columns</p>
</div>
</div>
</div>
<p>I want to put every columns into a single one in order to count the number of ingredients.</p>
<div id="cell-144" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>list_ingredients <span class="op">=</span> list_ingredients.stack().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-145" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="op">=</span> pd.DataFrame(list_ingredients.value_counts())</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>ranking.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">salt</td>
<td>65121</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugar</td>
<td>57315</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">water</td>
<td>51081</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sel</td>
<td>35013</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sucre</td>
<td>28276</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">garlic</td>
<td>9341</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th"></td>
<td>9082</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">soy lecithin</td>
<td>8815</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">xanthan gum</td>
<td>8395</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">maltodextrin</td>
<td>8171</td>
</tr>
</tbody>
</table>

<p>20 rows × 1 columns</p>
</div>
</div>
</div>
<ol type="1">
<li>The first thing we see is that words are in different languages. So we have to translate the most important words until translation has no effect on the top 5.</li>
<li>‘natural flavor’ and ‘natural flavors’ should be the same. We will simply replace ‘natural flavors’ by ‘natural flavor’.</li>
<li>We can also notice that there are 9139 ’ ’. This is due to the fact that we replaced what was inside the brackets. For example, the following row has no direct raw ingredients. Our code will simply delete this row.</li>
</ol>
<p>Comment: - Many arbitrary choices are made. For example, I decided not to include ‘sea salt’ in the category ‘salt’. - Many other changes could be made. However, only the top 5 ingredients are asked. These changes would normally not change the composition and the order of the top 5.</p>
<div id="cell-147" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'ingredients_text'</span>][<span class="dv">14207</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>'(panko breadcrumbs [bleached wheat flour, yeast, sugar, salt], kosher salt [salt, yellow prussiate of soda {anti-caking agent}], white pepper).'</code></pre>
</div>
</div>
<ol type="1">
<li></li>
</ol>
<div id="cell-149" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'sel'</span>,<span class="st">'salt'</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'sal'</span>,<span class="st">'salt'</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'sucre'</span>,<span class="st">'sugar'</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'eau'</span>,<span class="st">'water'</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'arôme naturel'</span>,<span class="st">'natural flavor'</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'arômes naturels'</span>,<span class="st">'natural flavor'</span>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'acidifiant  acide citrique'</span>,<span class="st">'citric acid'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li></li>
</ol>
<div id="cell-151" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> lst.<span class="bu">str</span>.replace(<span class="st">'natural flavors'</span>,<span class="st">'natural flavor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-152" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>list_ingredients <span class="op">=</span> lst.dropna().<span class="bu">str</span>.split(<span class="st">','</span>,expand<span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>list_ingredients <span class="op">=</span> list_ingredients.stack().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>ranking <span class="op">=</span> pd.DataFrame(list_ingredients.value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-153" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>ranking.columns <span class="op">=</span> [<span class="st">'Top 5 ingredients'</span>]</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>ranking.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Top 5 ingredients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">saltt</td>
<td>100134</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugar</td>
<td>85591</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">water</td>
<td>75346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">natural flavor</td>
<td>29939</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">citric acid</td>
<td>28655</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="time-series-analysis" class="level1">
<h1>4. Time-series analysis</h1>
<p>Goal: - (1) mean time difference between ‘created_datetime’ and ‘last_modified_datetime’ - (2) analyze the total number of items created each month over the full timeline of the data</p>
<ol type="1">
<li></li>
</ol>
<div id="cell-157" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>data.loc[<span class="dv">0</span>,[<span class="st">'created_datetime'</span>,<span class="st">'last_modified_datetime'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>created_datetime          2016-09-17T09:17:46Z
last_modified_datetime    2016-09-17T09:18:13Z
Name: 0, dtype: object</code></pre>
</div>
</div>
<div id="cell-158" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(data.loc[<span class="dv">0</span>,<span class="st">'created_datetime'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>str</code></pre>
</div>
</div>
<p>We want a timestamp format instead of the string format.</p>
<div id="cell-160" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When I first tried to convert the data, I had an error and I discovered that some values were not datetime. I had to find and delete all the rows that are not usefull for the analysis.</p>
<div id="cell-162" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>data.created_datetime[data.created_datetime.<span class="bu">str</span>.contains(<span class="st">'^(?!\d</span><span class="sc">{4}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">T\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">Z)'</span>, na<span class="op">=</span><span class="va">False</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>193944                                       Dia,Sogeres
193960                                           Super U
193993                                         Carrefour
194003                                            Auchan
194055    Banque alimentaire,Carrefour,Leclerc,E.Leclerc
                               ...                      
194104                                Banque alimentaire
194111                                           Leclerc
194114                                    Auchan,Super U
194255                                    Auchan,Super U
194311                                     Simply-Market
Name: created_datetime, Length: 13, dtype: object</code></pre>
</div>
</div>
<div id="cell-163" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data.created_datetime.<span class="bu">str</span>.contains(<span class="st">'\d</span><span class="sc">{4}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">T\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">Z'</span>, na<span class="op">=</span><span class="va">False</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-164" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'created_datetime'</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">'created_datetime'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-165" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data.last_modified_datetime.<span class="bu">str</span>.contains(<span class="st">'\d</span><span class="sc">{4}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">T\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">:\d</span><span class="sc">{2}</span><span class="st">Z'</span>, na<span class="op">=</span><span class="va">False</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-166" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'last_modified_datetime'</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">'last_modified_datetime'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-167" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'difference_datetime'</span>] <span class="op">=</span> <span class="bu">abs</span>(data.created_datetime<span class="op">-</span>data.last_modified_datetime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-168" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">creator</th>
<th data-quarto-table-cell-role="th">created_datetime</th>
<th data-quarto-table-cell-role="th">last_modified_datetime</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sodium_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
<th data-quarto-table-cell-role="th">difference_datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000000003087</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>openfoodfacts-contributors</td>
<td>2016-09-17 09:17:46+00:00</td>
<td>2016-09-17 09:18:13+00:00</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>00:00:27</td>
</tr>
</tbody>
</table>

<p>1 rows × 28 columns</p>
</div>
</div>
</div>
<div id="cell-169" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mean_difference_datetime <span class="op">=</span> data[<span class="st">'difference_datetime'</span>].mean()</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>mean_difference_datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>Timedelta('111 days 18:33:43.887901')</code></pre>
</div>
</div>
<ol start="2" type="1">
<li></li>
</ol>
<div id="cell-171" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>count_m <span class="op">=</span> data.created_datetime.dt.month_name()</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> count_m.groupby(count_m).size()</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>grouped.sort_values(ascending <span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>created_datetime
March       182260
February     26554
April        19044
May          15720
August       15087
             ...  
July         12607
January      10502
October       8966
November      8811
December      8624
Name: created_datetime, Length: 12, dtype: int64</code></pre>
</div>
</div>
<div id="cell-172" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">8</span>))</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Months'</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of items created'</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of items created per months'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> [<span class="st">'January'</span>,<span class="st">'February'</span>,<span class="st">'March'</span>,<span class="st">'April'</span>,<span class="st">'May'</span>,<span class="st">'June'</span>,<span class="st">'July'</span>,<span class="st">'August'</span>,<span class="st">'September'</span>,<span class="st">'October'</span>,<span class="st">'November'</span>,<span class="st">'December'</span>]</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>plt.bar(months,grouped.reindex(months))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-99-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="you-told-us-not-to-use-too-many-pie-charts-but-i-think-it-is-great-in-this-case.-what-do-you-think" class="level5">
<h5 class="anchored" data-anchor-id="you-told-us-not-to-use-too-many-pie-charts-but-i-think-it-is-great-in-this-case.-what-do-you-think">You told us not to use too many pie charts but I think it is great in this case. What do you think?</h5>
<div id="cell-174" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>colormap<span class="op">=</span> [<span class="st">'lightpink'</span>,<span class="st">'violet'</span> ,<span class="st">'slateblue'</span> ,<span class="st">'lightsteelblue'</span> ,<span class="st">'paleturquoise'</span> ,<span class="st">'lightgreen'</span> ,<span class="st">'gold'</span> ,<span class="st">'orange'</span> ,</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'chocolate'</span> ,<span class="st">'tomato'</span> ,<span class="st">'rosybrown'</span> ,<span class="st">'grey'</span> ]</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of items created per months'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>plt.pie(grouped.reindex(months), labels<span class="op">=</span>months, explode<span class="op">=</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>),colors<span class="op">=</span>colormap)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-100-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="build-a-database" class="level1">
<h1>5. Build a database</h1>
<p>List of tasks: - restrict your data to 1000 entries and 5 columns of your choice - create a connection to a sqlite3 database - create one or multiple tables, at least one of the tables should have a PRIMARY KEY - fill the database with your data - run at least one query to demonstrate that it works correctly</p>
<div id="cell-177" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-178" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> data.loc[<span class="dv">0</span>:<span class="dv">999</span>,[<span class="st">'code'</span>,<span class="st">'url'</span>,<span class="st">'created_t'</span>,<span class="st">'countries_en'</span>,<span class="st">'fat_100g'</span>]]</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>test.loc[<span class="st">'id_pk'</span>] <span class="op">=</span> pd.Series(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">1001</span>))</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>test.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">created_t</th>
<th data-quarto-table-cell-role="th">countries_en</th>
<th data-quarto-table-cell-role="th">fat_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000000003087</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>NaN</td>
<td>France</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0000000004530</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>NaN</td>
<td>United States</td>
<td>28.57</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0000000004559</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>NaN</td>
<td>United States</td>
<td>17.86</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I first tried to use ‘code’ as a Primary Key. However, whem the dataframe is converted into a database, the 0 are not well converted (since it is considered as an Integer). Maybe I should have put a string format for the conversion. What do you think about it? Then I decided to create a special column as a primary key. I find it easier like this.</p>
<div id="cell-180" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>datab <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">'TEST'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-181" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span> <span class="st">"CREATE TABLE Test (id_pk INTEGER PRIMARY KEY, created_t INTEGER ,  code INTEGER, url TEXT, countries_en TEXT, fat_100g FLOAT);"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-182" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> datab.cursor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-183" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>cursor.execute(query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>&lt;sqlite3.Cursor at 0x17b4f0570&gt;</code></pre>
</div>
</div>
<div id="cell-184" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>test.to_sql(name<span class="op">=</span><span class="st">'Test'</span>, con<span class="op">=</span>datab, if_exists<span class="op">=</span><span class="st">'append'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-185" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"SELECT * FROM Test;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>&lt;sqlite3.Cursor at 0x17b4f0570&gt;</code></pre>
</div>
</div>
<div id="cell-186" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> cursor.fetchall()</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(results)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example of a query:</p>
<div id="cell-188" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_query(query):</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.read_sql_query(query,datab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-189" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>query<span class="op">=</span> <span class="st">''' SELECT countries_en AS Countries, AVG(fat_100g) as 'Average fat per 100g' FROM Test </span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY countries_en ORDER BY AVG(fat_100g) DESC ;</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-190" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>run_query(query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Countries</th>
<th data-quarto-table-cell-role="th">Average fat per 100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Belgium,France,Netherlands,United Kingdom</td>
<td>17.050000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>United States</td>
<td>14.995224</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>United Kingdom</td>
<td>14.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>France,United Kingdom</td>
<td>13.692857</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>France</td>
<td>13.312069</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Guadeloupe</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>Dominican Republic</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>Bangladesh</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>Australia</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>None</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>22 rows × 2 columns</p>
</div>
</div>
</div>
<p>Everything seems to work perfectly.</p>
</section>
<section id="finding-correlations-corrected" class="level1">
<h1>6. Finding correlations (corrected)</h1>
<p>Goals: - (1) identify the variables which most affect the nutritional score - (2) provide some insight into which factors cause both a low or a high nutritional score</p>
<ol type="1">
<li>In order to identify what variable most affect the nutritional score, we need to find the ones that have a correlation closer to 1 in absolute.</li>
</ol>
<div id="cell-195" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>data.loc[data.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)<span class="op">==</span><span class="dv">0</span>][<span class="dv">0</span>:<span class="dv">1</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">creator</th>
<th data-quarto-table-cell-role="th">created_datetime</th>
<th data-quarto-table-cell-role="th">last_modified_datetime</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sodium_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
<th data-quarto-table-cell-role="th">difference_datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0000000004559</td>
<td>http://world-en.openfoodfacts.org/product/0000...</td>
<td>usda-ndb-import</td>
<td>2017-03-09 14:32:37+00:00</td>
<td>2017-03-09 14:32:37+00:00</td>
<td>...</td>
<td>0.635</td>
<td>0.25</td>
<td>0.0</td>
<td>0.0</td>
<td>0 days</td>
</tr>
</tbody>
</table>

<p>1 rows × 28 columns</p>
</div>
</div>
</div>
<p>The variables that I can use for the correlation are: - ‘additives_n’, - ‘ingredients_from_palm_oil_n’, - ‘ingredients_that_may_be_from_palm_oil_n’, - ‘energy_100g’, - ‘fat_100g’, - ‘saturated-fat_100g’, - ‘carbohydrates_100g’, - ‘sugars_100g’, - ‘fiber_100g’, - ‘proteins_100g’, - ‘salt_100g’, - ‘sodium_100g’, - ‘nutrition-score-fr_100g’, - ‘nutrition-score-uk_100g’, - ‘difference_datetime’</p>
<p>In order to use difference_datetime, we have to change the format into a total of seconds. It would most probably have no correlation but who knows?</p>
<div id="cell-198" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'difference_datetime'</span>] <span class="op">=</span> data[<span class="st">'difference_datetime'</span>].dt.total_seconds()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use the method .corr to have the correlation matrix.</p>
<div id="cell-200" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>data.corr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">additives_n</th>
<th data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</th>
<th data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</th>
<th data-quarto-table-cell-role="th">energy_100g</th>
<th data-quarto-table-cell-role="th">fat_100g</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">salt_100g</th>
<th data-quarto-table-cell-role="th">sodium_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
<th data-quarto-table-cell-role="th">difference_datetime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">additives_n</td>
<td>1.000000</td>
<td>0.131039</td>
<td>0.297396</td>
<td>0.003482</td>
<td>-0.103318</td>
<td>...</td>
<td>-0.015726</td>
<td>-0.015729</td>
<td>0.166314</td>
<td>0.164708</td>
<td>-0.033052</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</td>
<td>0.131039</td>
<td>1.000000</td>
<td>0.182165</td>
<td>0.114803</td>
<td>0.067717</td>
<td>...</td>
<td>-0.004833</td>
<td>-0.004819</td>
<td>0.131132</td>
<td>0.134814</td>
<td>0.089705</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</td>
<td>0.297396</td>
<td>0.182165</td>
<td>1.000000</td>
<td>0.030687</td>
<td>0.020933</td>
<td>...</td>
<td>-0.019890</td>
<td>-0.019893</td>
<td>0.061556</td>
<td>0.063944</td>
<td>0.094433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">energy_100g</td>
<td>0.003482</td>
<td>0.114803</td>
<td>0.030687</td>
<td>1.000000</td>
<td>0.772522</td>
<td>...</td>
<td>-0.077832</td>
<td>-0.077860</td>
<td>0.623124</td>
<td>0.660094</td>
<td>-0.009541</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat_100g</td>
<td>-0.103318</td>
<td>0.067717</td>
<td>0.020933</td>
<td>0.772522</td>
<td>1.000000</td>
<td>...</td>
<td>-0.045582</td>
<td>-0.045599</td>
<td>0.565134</td>
<td>0.602282</td>
<td>0.005961</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">salt_100g</td>
<td>-0.015726</td>
<td>-0.004833</td>
<td>-0.019890</td>
<td>-0.077832</td>
<td>-0.045582</td>
<td>...</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.122403</td>
<td>0.128739</td>
<td>-0.015433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sodium_100g</td>
<td>-0.015729</td>
<td>-0.004819</td>
<td>-0.019893</td>
<td>-0.077860</td>
<td>-0.045599</td>
<td>...</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.122404</td>
<td>0.128740</td>
<td>-0.015430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nutrition-score-fr_100g</td>
<td>0.166314</td>
<td>0.131132</td>
<td>0.061556</td>
<td>0.623124</td>
<td>0.565134</td>
<td>...</td>
<td>0.122403</td>
<td>0.122404</td>
<td>1.000000</td>
<td>0.978836</td>
<td>-0.037340</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nutrition-score-uk_100g</td>
<td>0.164708</td>
<td>0.134814</td>
<td>0.063944</td>
<td>0.660094</td>
<td>0.602282</td>
<td>...</td>
<td>0.128739</td>
<td>0.128740</td>
<td>0.978836</td>
<td>1.000000</td>
<td>-0.045776</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">difference_datetime</td>
<td>-0.033052</td>
<td>0.089705</td>
<td>0.094433</td>
<td>-0.009541</td>
<td>0.005961</td>
<td>...</td>
<td>-0.015433</td>
<td>-0.015430</td>
<td>-0.037340</td>
<td>-0.045776</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>15 rows × 15 columns</p>
</div>
</div>
</div>
<div id="cell-201" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">15</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>data.corr()[[<span class="st">'nutrition-score-fr_100g'</span>]].sort_values(<span class="st">'nutrition-score-fr_100g'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nutrition-score-fr_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">nutrition-score-fr_100g</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nutrition-score-uk_100g</td>
<td>0.978836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">saturated-fat_100g</td>
<td>0.632853</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">energy_100g</td>
<td>0.623124</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat_100g</td>
<td>0.565134</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugars_100g</td>
<td>0.464061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carbohydrates_100g</td>
<td>0.256162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">additives_n</td>
<td>0.166314</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</td>
<td>0.131132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sodium_100g</td>
<td>0.122404</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">salt_100g</td>
<td>0.122403</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">proteins_100g</td>
<td>0.101319</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</td>
<td>0.061556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">difference_datetime</td>
<td>-0.037340</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fiber_100g</td>
<td>-0.147743</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-202" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>data.corr()[[<span class="st">'nutrition-score-uk_100g'</span>]].sort_values(<span class="st">'nutrition-score-uk_100g'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nutrition-score-uk_100g</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">nutrition-score-uk_100g</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">nutrition-score-fr_100g</td>
<td>0.978836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">energy_100g</td>
<td>0.660094</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">saturated-fat_100g</td>
<td>0.657371</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fat_100g</td>
<td>0.602282</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sugars_100g</td>
<td>0.451992</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carbohydrates_100g</td>
<td>0.260655</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">additives_n</td>
<td>0.164708</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_from_palm_oil_n</td>
<td>0.134814</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">proteins_100g</td>
<td>0.133726</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sodium_100g</td>
<td>0.128740</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">salt_100g</td>
<td>0.128739</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ingredients_that_may_be_from_palm_oil_n</td>
<td>0.063944</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">difference_datetime</td>
<td>-0.045776</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fiber_100g</td>
<td>-0.137499</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ol type="1">
<li><p>The variables that most affect the nutrition score are the ones with a correlation close to 1 in absolute. That is to say, saturated-fat_100g, fat_100g, energy_100g and sugars_100g. In our case, all variables that impact the most the nutrition score have a positive correlation.</p></li>
<li><p>The variables linked positively to the nutrition scores are the ones in answer 1: saturated-fat_100g, fat_100g, energy_100g and sugars_100g. The variables linked negatively are fiber_100g, difference_datetime. However, the correlation are really close to 0. So the relation is really insignificant.</p></li>
</ol>
<p>We could also display a graphic to see that.</p>
<div id="cell-206" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>label_c <span class="op">=</span>[<span class="st">'additives_n'</span>,<span class="st">'ingredients_from_palm_oil_n'</span>, <span class="st">'ingredients_that_may_be_from_palm_oil_n'</span>, <span class="st">'energy_100g'</span>, <span class="st">'fat_100g'</span>, <span class="st">'saturated-fat_100g'</span>, <span class="st">'carbohydrates_100g'</span>, <span class="st">'sugars_100g'</span>, <span class="st">'fiber_100g'</span>, <span class="st">'proteins_100g'</span>, <span class="st">'salt_100g'</span>, <span class="st">'sodium_100g'</span>, <span class="st">'nutrition-score-fr_100g'</span>,<span class="st">'nutrition-score-uk_100g'</span>, <span class="st">'difference_datetime'</span>]</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">17</span>, <span class="dv">13</span>))</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>plt.matshow(data.corr(), fignum<span class="op">=</span>f.number)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(label_c)), label_c, fontsize<span class="op">=</span><span class="dv">14</span>, rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(label_c)), label_c, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> plt.colorbar()</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>cb.ax.tick_params(labelsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlation Matrix'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, y<span class="op">=</span><span class="fl">1.4</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-118-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I still have a huge amount of datapoints, so I use an alpha very small.</p>
<div id="cell-208" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> data.select_dtypes(include<span class="op">=</span>[<span class="st">'float'</span>,<span class="st">'int'</span>]).columns</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">4</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">18</span>,<span class="dv">4</span><span class="op">*</span><span class="dv">4</span>))</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(num_cols,axes.ravel()):</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> data[data[col].notnull()]</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    ax.scatter(temp[col],temp[<span class="st">'nutrition-score-fr_100g'</span>],alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">3</span>,<span class="dv">3</span>].axis(<span class="st">'off'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_4_files/figure-html/cell-119-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can in fact see a positive trend between the nutrition score and the columnns energy_100g, fat_100g, saturated-fat_100g and sugars_100g.</p>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1"></h3>
</section>
</section>
<a class="quarto-notebook-link" id="nblink-1" href="..\..\Documents\ML\Course_2\09_Course_Project\Projet2_to_R-preview.html#cell-0">Source: 1. Importing and cleaning the data</a></div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2023, Grégoire Urvoy</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>