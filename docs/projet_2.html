<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Gregoire Urvoy â€“ projet_2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Gregoire Urvoy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./home.html"> 
<span class="menu-text">Home page</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-visualizations" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Visualizations</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-visualizations">    
        <li>
    <a class="dropdown-item" href="./visualization_using_Tableau.html">
 <span class="dropdown-text">Visualization using Tableau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./visualization_using_R.html">
 <span class="dropdown-text">Visualization using R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-academic-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Academic projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-academic-projects">    
        <li>
    <a class="dropdown-item" href="./projet_1.html">
 <span class="dropdown-text">Analysis of ESG factors in investment decisionmaking (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_2.html">
 <span class="dropdown-text">Estimating market capitalisation of companies using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_3.html">
 <span class="dropdown-text">House prices predictions using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_5.html">
 <span class="dropdown-text">Images classifier using deep learning and machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_4.html">
 <span class="dropdown-text">Open food facts dataset: simple analysis (2021)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-work-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Work project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-work-project">    
        <li>
    <a class="dropdown-item" href="./w_projet_1.html">
 <span class="dropdown-text">Proposal for a Maturity Continuum Model for Open Research Data (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./w_projet_2.html">
 <span class="dropdown-text">Performance analysis of marathon runners using Strava data (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-football-stories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Football stories</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-football-stories">    
        <li>
    <a class="dropdown-item" href="./premiere_league.html">
 <span class="dropdown-text">Premier league - Simply the best</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./manchester.html">
 <span class="dropdown-text">Manchester - Blue or Red? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./t_maps.html">
 <span class="dropdown-text">How to plot maps with R?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./t_animated.html">
 <span class="dropdown-text">How to animate your plots with R? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/gr%C3%A9goire-urvoy-456347a8/"> <i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#estimating-market-capitalisation-of-companies-using-machine-learning-models" id="toc-estimating-market-capitalisation-of-companies-using-machine-learning-models" class="nav-link active" data-scroll-target="#estimating-market-capitalisation-of-companies-using-machine-learning-models">Estimating market capitalisation of companies using Machine Learning models</a></li>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">1. Data Collection</a>
  <ul class="collapse">
  <li><a href="#import-packages" id="toc-import-packages" class="nav-link" data-scroll-target="#import-packages">Import packages</a></li>
  <li><a href="#ticker-list" id="toc-ticker-list" class="nav-link" data-scroll-target="#ticker-list">Ticker list</a></li>
  <li><a href="#bs" id="toc-bs" class="nav-link" data-scroll-target="#bs">BS</a></li>
  <li><a href="#cash-flow" id="toc-cash-flow" class="nav-link" data-scroll-target="#cash-flow">Cash Flow</a></li>
  <li><a href="#esg" id="toc-esg" class="nav-link" data-scroll-target="#esg">ESG</a></li>
  <li><a href="#income-statement" id="toc-income-statement" class="nav-link" data-scroll-target="#income-statement">Income statement</a></li>
  <li><a href="#statistics" id="toc-statistics" class="nav-link" data-scroll-target="#statistics">Statistics</a></li>
  <li><a href="#profile" id="toc-profile" class="nav-link" data-scroll-target="#profile">Profile</a></li>
  </ul></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2. Data Preparation</a>
  <ul class="collapse">
  <li><a href="#a-data-cleaning" id="toc-a-data-cleaning" class="nav-link" data-scroll-target="#a-data-cleaning">a) Data Cleaning</a></li>
  <li><a href="#b-variable-pre-selection" id="toc-b-variable-pre-selection" class="nav-link" data-scroll-target="#b-variable-pre-selection">b) Variable pre-selection:</a></li>
  <li><a href="#c-missing-values" id="toc-c-missing-values" class="nav-link" data-scroll-target="#c-missing-values">c) Missing values</a></li>
  <li><a href="#d-features-engineering" id="toc-d-features-engineering" class="nav-link" data-scroll-target="#d-features-engineering">d) Features engineering:</a></li>
  <li><a href="#e-features-encoding" id="toc-e-features-encoding" class="nav-link" data-scroll-target="#e-features-encoding">e) Features encoding</a></li>
  <li><a href="#f-correlation-matrix" id="toc-f-correlation-matrix" class="nav-link" data-scroll-target="#f-correlation-matrix">f) Correlation matrix</a></li>
  <li><a href="#g-data-split" id="toc-g-data-split" class="nav-link" data-scroll-target="#g-data-split">g) Data split</a></li>
  <li><a href="#h-outliers" id="toc-h-outliers" class="nav-link" data-scroll-target="#h-outliers">h) Outliers</a></li>
  <li><a href="#i-check-for-inconsistencies" id="toc-i-check-for-inconsistencies" class="nav-link" data-scroll-target="#i-check-for-inconsistencies">i) Check for inconsistencies</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">3. Exploratory Data Analysis (EDA)</a>
  <ul class="collapse">
  <li><a href="#a-sector" id="toc-a-sector" class="nav-link" data-scroll-target="#a-sector">a) Sector</a></li>
  <li><a href="#b-other-features" id="toc-b-other-features" class="nav-link" data-scroll-target="#b-other-features">b) Other features</a></li>
  <li><a href="#c-classification-and-binary-variables" id="toc-c-classification-and-binary-variables" class="nav-link" data-scroll-target="#c-classification-and-binary-variables">c) Classification and binary variables</a></li>
  </ul></li>
  <li><a href="#machine-learning-models" id="toc-machine-learning-models" class="nav-link" data-scroll-target="#machine-learning-models">4. Machine learning models</a>
  <ul class="collapse">
  <li><a href="#a-baseline" id="toc-a-baseline" class="nav-link" data-scroll-target="#a-baseline">a) Baseline</a></li>
  <li><a href="#b-model-fitting-with-the-original-datset" id="toc-b-model-fitting-with-the-original-datset" class="nav-link" data-scroll-target="#b-model-fitting-with-the-original-datset">b) Model fitting with the original datset</a></li>
  <li><a href="#c-model-fitting-with-a-subset---selectkbest" id="toc-c-model-fitting-with-a-subset---selectkbest" class="nav-link" data-scroll-target="#c-model-fitting-with-a-subset---selectkbest">c) Model fitting with a subset - SelectKBest</a></li>
  <li><a href="#d-model-fitting-with-a-subset---pca" id="toc-d-model-fitting-with-a-subset---pca" class="nav-link" data-scroll-target="#d-model-fitting-with-a-subset---pca">d) Model fitting with a subset - PCA</a></li>
  </ul></li>
  <li><a href="#final-comparison-and-conclusion" id="toc-final-comparison-and-conclusion" class="nav-link" data-scroll-target="#final-comparison-and-conclusion">5. Final comparison and conclusion</a></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="..\..\Documents\ML\Capstone\FinalProject\1_data_collection-preview.html"><i class="bi bi-journal-code"></i>1. Data Collection</a></li><li><a href="..\..\Documents\ML\Capstone\FinalProject\2_data_preparation-preview.html"><i class="bi bi-journal-code"></i>2. Data Preparation</a></li><li><a href="..\..\Documents\ML\Capstone\FinalProject\3_EDA-preview.html"><i class="bi bi-journal-code"></i>3. Exploratory Data Analysis (EDA)</a></li><li><a href="..\..\Documents\ML\Capstone\FinalProject\4_ML_models-preview.html"><i class="bi bi-journal-code"></i>4. Machine learning models</a></li><li><a href="..\..\Documents\ML\Capstone\FinalProject\5_results-preview.html"><i class="bi bi-journal-code"></i>5. Final comparison and conclusion</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="estimating-market-capitalisation-of-companies-using-machine-learning-models" class="level1">
<h1>Estimating market capitalisation of companies using Machine Learning models</h1>
<blockquote class="blockquote">
One of the main challenges of asset management in finance is to develop models that can predict stock prices, or in other words, the market capitalization of a company (numbers of stocks x stock prices). Market capitalisation can be seen as the overall value of the company. Usually, investors use a method called DCF (Discounted Cash Flow) to predict the value of the company. In a few words, this method consists in predicting the future revenues of the company and discount it to get the present value of the company. This method is very demanding and need many assumptions concerning the company, the different rates you want to use, etc.
</blockquote>
<p>The goal of my project is to try to develop a machine learning model to <strong>estimate the current market capitalisation using only the latest statistics of the company</strong>.</p>
</section>
<section id="data-collection" class="level1 quarto-embed-nb-cell">
<h1>1. Data Collection</h1>
<p>I collected the dataset by webscrapping. The source of the data is the website yahoo finance (https://finance.yahoo.com/). Yahoo finance is one the main website that retrieves financial data.</p>
<p>Data are extracted for the year 2020 (snapshot).</p>
<p>My datapoints are 3000 important US companies (such as Apple, Amazon, Google, etc.). The features can be divided into 6 parts: * (1) Balance sheet * (2) Cash flow statement * (3) Income statement * (4) ESG data * (5) Profile of the company * (6) Basic statistics of the company</p>
<section id="import-packages" class="level2">
<h2 class="anchored" data-anchor-id="import-packages">Import packages</h2>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> webdriver_manager.chrome <span class="im">import</span> ChromeDriverManager</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ticker-list" class="level2">
<h2 class="anchored" data-anchor-id="ticker-list">Ticker list</h2>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ticker <span class="op">=</span> pd.read_csv(<span class="vs">r'TCK.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ticker <span class="op">=</span> ticker[<span class="st">'Ticker'</span>].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ticker[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example: https://finance.yahoo.com/quote/AAPL/balance-sheet?p=AAPL</p>
</section>
<section id="bs" class="level2">
<h2 class="anchored" data-anchor-id="bs">BS</h2>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of features to extract</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>list_BS <span class="op">=</span> [<span class="st">'Total Assets'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Assets'</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash, Cash Equivalents &amp; Short Term Investments'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash And Cash Equivalents'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash'</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash Equivalents'</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Short Term Investments'</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'Receivables'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'Accounts receivable'</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gross Accounts Receivable'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Allowance For Doubtful Accounts Receivable'</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Receivables'</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Inventory'</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Current Assets'</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total non-current assets'</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net PPE'</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gross PPE'</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'Properties'</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'Land And Improvements'</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Machinery Furniture Equipment'</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'Leases'</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'Accumulated Depreciation'</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'Goodwill And Other Intangible Assets'</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'Goodwill'</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Intangible Assets'</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'Investments And Advances'</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'Investment in Financial Assets'</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'Available for Sale Securities'</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Non Current Assets'</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Liabilities Net Minority Interest'</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Liabilities'</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'Payables And Accrued Expenses'</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'Payables'</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'Accounts Payable'</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Accrued Expenses'</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Debt And Capital Lease Obligation'</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Debt'</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'Commercial Paper'</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Current Borrowings'</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Deferred Liabilities'</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'Current Deferred Revenue'</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Current Liabilities'</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Non Current Liabilities Net Minority Interest'</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'Long Term Debt And Capital Lease Obligation'</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'Long Term Debt'</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'Non Current Deferred Liabilities'</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'Non Current Deferred Taxes Liabilities'</span>,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a> <span class="st">'Non Current Deferred Revenue'</span>,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tradeand Other Payables Non Current'</span>,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Non Current Liabilities'</span>,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Equity Gross Minority Interest'</span>,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a> <span class="st">"Stockholders' Equity"</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a> <span class="st">'Capital Stock'</span>,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a> <span class="st">'Common Stock'</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a> <span class="st">'Retained Earnings'</span>,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gains Losses Not Affecting Retained Earnings'</span>,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Capitalization'</span>,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a> <span class="st">'Common Stock Equity'</span>,</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Tangible Assets'</span>,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a> <span class="st">'Working Capital'</span>,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a> <span class="st">'Invested Capital'</span>,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tangible Book Value'</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Debt'</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Debt'</span>,</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a> <span class="st">'Share Issued'</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a> <span class="st">'Ordinary Shares Number'</span>]</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>list_BS_asdf <span class="op">=</span> pd.DataFrame(list_BS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty dataframe</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>list_BS,columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">1</span>):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># I had to create a temporary dataframe to store the values. Otherwise, impossible to merge 3000 companies with different features. </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        Temporary_BS <span class="op">=</span> pd.DataFrame(index<span class="op">=</span><span class="bu">range</span>(<span class="dv">150</span>),columns<span class="op">=</span><span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change the URL </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/balance-sheet?p='</span> <span class="op">+</span> ticker[i]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        driver.get(is_link)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Click on the expand button</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        link1 <span class="op">=</span> driver.find_element_by_xpath(<span class="st">'//*[@id="Col1-1-Financials-Proxy"]/section/div[2]/button/div'</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        link1.click()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get features</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        features_BS <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(tbc)'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get values</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        features_BS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To manage the ads </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> features_BS_bis[<span class="dv">0</span>].text <span class="op">!=</span> <span class="st">'Total Assets'</span>:</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            features_BS_bis <span class="op">=</span> features_BS_bis[<span class="dv">1</span>:]</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">5</span> :</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">3</span>):</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">3</span> <span class="kw">or</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">2</span>):</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">1</span> <span class="kw">or</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">2</span>  :</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">1</span>):</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">1</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                    Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values   </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">5</span> :</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">3</span>):</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">3</span> <span class="kw">or</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">2</span>):</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>            Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>            BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">1</span> <span class="kw">or</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">2</span>  :</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS),<span class="dv">1</span>):</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">1</span>)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_BS[j].text</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_BS_bis)):</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>                Temporary_BS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_BS_bis[t].text</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>            Temporary_BS <span class="op">=</span> Temporary_BS.merge(list_BS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            Temporary_BS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            BS.loc[:,ticker[i]] <span class="op">=</span> Temporary_BS.loc[<span class="bu">sorted</span>(Temporary_BS.index.to_list(), key<span class="op">=</span>BS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    driver.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>BS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#BS.to_csv(r'BS.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cash-flow" class="level2">
<h2 class="anchored" data-anchor-id="cash-flow">Cash Flow</h2>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>list_CF <span class="op">=</span> [<span class="st">'Operating Cash Flow'</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash Flow from Continuing Operating Activities'</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income from Continuing Operations'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Depreciation Amortization Depletion'</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Depreciation &amp; amortization'</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Deferred Tax'</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'Deferred Income Tax'</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'Stock based compensation'</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other non-cash items'</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in working capital'</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Receivables'</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Changes in Account Receivables'</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Inventory'</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Payables And Accrued Expense'</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Payable'</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Account Payable'</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Other Current Assets'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Other Current Liabilities'</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'Change in Other Working Capital'</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'Investing Cash Flow'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash Flow from Continuing Investing Activities'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net PPE Purchase And Sale'</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'Purchase of PPE'</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Intangibles Purchase And Sale'</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'Purchase of Intangibles'</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Business Purchase And Sale'</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'Purchase of Business'</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Investment Purchase And Sale'</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'Purchase of Investment'</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'Sale of Investment'</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Other Investing Changes'</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'Financing Cash Flow'</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash Flow from Continuing Financing Activities'</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Issuance Payments of Debt'</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Long Term Debt Issuance'</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'Long Term Debt Issuance'</span>,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'Long Term Debt Payments'</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Short Term Debt Issuance'</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'Short Term Debt Payments'</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Common Stock Issuance'</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'Common Stock Issuance'</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'Common Stock Payments'</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cash Dividends Paid'</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'Common Stock Dividend Paid'</span>,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Other Financing Charges'</span>,</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'End Cash Position'</span>,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'Changes in Cash'</span>,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'Beginning Cash Position'</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a> <span class="st">'Income Tax Paid Supplemental Data'</span>,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a> <span class="st">'Interest Paid Supplemental Data'</span>,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'Capital Expenditure'</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a> <span class="st">'Issuance of Capital Stock'</span>,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a> <span class="st">'Issuance of Debt'</span>,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a> <span class="st">'Repayment of Debt'</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a> <span class="st">'Repurchase of Capital Stock'</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a> <span class="st">'Free Cash Flow'</span>]</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>list_CF_asdf <span class="op">=</span> pd.DataFrame(list_CF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>CF <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>list_CF,columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">1</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        Temporary_CF <span class="op">=</span> pd.DataFrame(index<span class="op">=</span><span class="bu">range</span>(<span class="dv">150</span>),columns<span class="op">=</span><span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/cash-flow?p='</span> <span class="op">+</span> ticker[i]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        driver.get(is_link)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        link1 <span class="op">=</span> driver.find_element_by_xpath(<span class="st">'//*[@id="Col1-1-Financials-Proxy"]/section/div[2]/button/div'</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        link1.click()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        features_CF <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg Bgc($lv1BgColor) fi-row:h_Bgc($hoverBgColor) D(tbc)'</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        features_CF_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> features_CF_bis[<span class="dv">0</span>].text <span class="op">!=</span> <span class="st">'Operating Cash Flow'</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            features_CF_bis <span class="op">=</span> features_CF_bis[<span class="dv">1</span>:]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">3</span>):</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> (<span class="dv">2</span> <span class="kw">or</span> <span class="dv">3</span>):</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">2</span>):</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> (<span class="dv">1</span> <span class="kw">or</span> <span class="dv">0</span>):</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">1</span>):</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                    n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">1</span>)</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                    Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">3</span>):</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>            Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> (<span class="dv">2</span> <span class="kw">or</span> <span class="dv">3</span>):</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">2</span>):</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>            Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>            Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>            CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> (<span class="dv">1</span> <span class="kw">or</span> <span class="dv">0</span>):</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF),<span class="dv">1</span>):</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">1</span>)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[n,<span class="dv">1</span>] <span class="op">=</span> features_CF[j].text</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_CF_bis)):</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>                Temporary_CF.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_CF_bis[t].text</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>            Temporary_CF <span class="op">=</span> Temporary_CF.merge(list_CF_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>            Temporary_CF.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>            CF.loc[:,ticker[i]] <span class="op">=</span> Temporary_CF.loc[<span class="bu">sorted</span>(Temporary_CF.index.to_list(), key<span class="op">=</span>CF.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>    driver.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>CF</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#CF.to_csv(r'CF.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="esg" class="level2">
<h2 class="anchored" data-anchor-id="esg">ESG</h2>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ESG <span class="op">=</span>  pd.DataFrame(index<span class="op">=</span><span class="bu">range</span>(<span class="dv">5</span>),columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(ticker)):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/sustainability?p='</span> <span class="op">+</span> ticker[i]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    driver.get(is_link)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        ESG.iloc[<span class="dv">0</span>,i] <span class="op">=</span> soup.find(<span class="st">'div'</span>,class_<span class="op">=</span><span class="st">'Fz(36px) Fw(600) D(ib) Mend(5px)'</span>).text</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        ESG.iloc[<span class="dv">1</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'div'</span>,class_<span class="op">=</span><span class="st">'D(ib) Fz(23px) smartphone_Fz(22px) Fw(600)'</span>)[<span class="dv">0</span>].text</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        ESG.iloc[<span class="dv">2</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'div'</span>,class_<span class="op">=</span><span class="st">'D(ib) Fz(23px) smartphone_Fz(22px) Fw(600)'</span>)[<span class="dv">1</span>].text</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        ESG.iloc[<span class="dv">3</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'div'</span>,class_<span class="op">=</span><span class="st">'D(ib) Fz(23px) smartphone_Fz(22px) Fw(600)'</span>)[<span class="dv">2</span>].text</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        ESG.iloc[<span class="dv">4</span>,i] <span class="op">=</span> soup.find(<span class="st">'div'</span>,class_<span class="op">=</span><span class="st">'D(ib) Fz(36px) Fw(500)'</span>).text</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        ESG <span class="op">=</span> ESG.rename(columns<span class="op">=</span>{i: ticker[i]})</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        driver.close()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        driver.close()</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>ESG <span class="op">=</span> ESG.rename( index<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'ESG'</span>,<span class="dv">1</span>: <span class="st">'E'</span>,<span class="dv">2</span>: <span class="st">'S'</span>,<span class="dv">3</span>: <span class="st">'G'</span>,<span class="dv">4</span>: <span class="st">'Controverse'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ESG.to_csv(r"ESG.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="income-statement" class="level2">
<h2 class="anchored" data-anchor-id="income-statement">Income statement</h2>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>list_IS <span class="op">=</span> [<span class="st">'Total Revenue'</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'Operating Revenue'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cost of Revenue'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Gross Profit'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Operating Expense'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Selling General and Administrative'</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'Research &amp; Development'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'Operating Income'</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Non Operating Interest Income Expense'</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'Interest Income Non Operating'</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Interest Expense Non Operating'</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Income Expense'</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Other Non Operating Income Expenses'</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Pretax Income'</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tax Provision'</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income Common Stockholders'</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income'</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income Including Non-Controlling Interests'</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income Continuous Operations'</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'Diluted NI Available to Com Stockholders'</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Basic EPS'</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'Diluted EPS'</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'Basic Average Shares'</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'Diluted Average Shares'</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Operating Income as Reported'</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total Expenses'</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income from Continuing &amp; Discontinued Operation'</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'Normalized Income'</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'Interest Income'</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'Interest Expense'</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Interest Income'</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'EBIT'</span>,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'EBITDA'</span>,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'Reconciled Cost of Revenue'</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'Reconciled Depreciation'</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'Net Income from Continuing Operation Net Minority Interest'</span>,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'Normalized EBITDA'</span>,</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tax Rate for Calcs'</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'Tax Effect of Unusual Items'</span>]</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>list_IS_asdf <span class="op">=</span> pd.DataFrame(list_IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>IS <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>list_IS,columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(ticker)):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        Temporary_IS <span class="op">=</span> pd.DataFrame(index<span class="op">=</span><span class="bu">range</span>(<span class="dv">150</span>),columns<span class="op">=</span><span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/financials?p='</span> <span class="op">+</span> ticker[i]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        driver.get(is_link)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        link1 <span class="op">=</span> driver.find_element_by_xpath(<span class="st">'//*[@id="Col1-1-Financials-Proxy"]/section/div[2]/button/div'</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        link1.click()</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        features_IS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> features_IS_bis[<span class="dv">0</span>].text <span class="op">!=</span> <span class="st">'Total Revenue'</span>:</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>            features_IS_bis <span class="op">=</span> features_IS_bis[<span class="dv">1</span>:]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                features_IS <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg Bgc($lv1BgColor) fi-row:h_Bgc($hoverBgColor) D(tbc)'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                features_IS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS),<span class="dv">2</span>):</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                    m<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                    Temporary_IS.iloc[m,<span class="dv">1</span>] <span class="op">=</span> features_IS[j].text</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS_bis)):</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                    Temporary_IS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_IS_bis[t].text</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                Temporary_IS <span class="op">=</span> Temporary_IS.merge(list_IS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                IS.loc[:,ticker[i]] <span class="op">=</span> Temporary_IS.loc[<span class="bu">sorted</span>(Temporary_IS.index.to_list(), key<span class="op">=</span>IS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>                features_IS <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg Bgc($lv1BgColor) fi-row:h_Bgc($hoverBgColor) D(tbc)'</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>                features_IS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS),<span class="dv">3</span>):</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                    m<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>                    Temporary_IS.iloc[m,<span class="dv">1</span>] <span class="op">=</span> features_IS[j].text</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS_bis)):</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>                    Temporary_IS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_IS_bis[t].text</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>                Temporary_IS <span class="op">=</span> Temporary_IS.merge(list_IS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>                IS.loc[:,ticker[i]] <span class="op">=</span> Temporary_IS.loc[<span class="bu">sorted</span>(Temporary_IS.index.to_list(), key<span class="op">=</span>IS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>            features_IS <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg Bgc($lv1BgColor) fi-row:h_Bgc($hoverBgColor) D(tbc)'</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>            features_IS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS),<span class="dv">2</span>):</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>                m<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.iloc[m,<span class="dv">1</span>] <span class="op">=</span> features_IS[j].text</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS_bis)):</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_IS_bis[t].text</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>            Temporary_IS <span class="op">=</span> Temporary_IS.merge(list_IS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>            Temporary_IS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>            IS.loc[:,ticker[i]] <span class="op">=</span> Temporary_IS.loc[<span class="bu">sorted</span>(Temporary_IS.index.to_list(), key<span class="op">=</span>IS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b)'</span>)) <span class="op">+</span>  <span class="bu">len</span>(soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg D(ib) Fw(b) Bgc($lv1BgColor)'</span>)) <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>            features_IS <span class="op">=</span> soup.find_all(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'Ta(c) Py(6px) Bxz(bb) BdB Bdc($seperatorColor) Miw(120px) Miw(140px)--pnclg Bgc($lv1BgColor) fi-row:h_Bgc($hoverBgColor) D(tbc)'</span>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>            features_IS_bis <span class="op">=</span> soup.find_all(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'Va(m)'</span>)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS),<span class="dv">3</span>):</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>                m<span class="op">=</span><span class="bu">int</span>(j<span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.iloc[m,<span class="dv">1</span>] <span class="op">=</span> features_IS[j].text</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_IS_bis)):</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>                Temporary_IS.iloc[t,<span class="dv">0</span>] <span class="op">=</span> features_IS_bis[t].text</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>            Temporary_IS <span class="op">=</span> Temporary_IS.merge(list_IS_asdf,how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>            Temporary_IS.set_index(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>            IS.loc[:,ticker[i]] <span class="op">=</span> Temporary_IS.loc[<span class="bu">sorted</span>(Temporary_IS.index.to_list(), key<span class="op">=</span>IS.index.to_list().index),:][<span class="dv">1</span>].values</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    driver.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#IS.to_csv(r'IS.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="statistics" class="level2">
<h2 class="anchored" data-anchor-id="statistics">Statistics</h2>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>list_i<span class="op">=</span>[]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>i<span class="op">=</span><span class="dv">0</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/key-statistics?p='</span> <span class="op">+</span> ticker[i]  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>driver.get(is_link)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)    </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>features_stats <span class="op">=</span> soup.find_all(<span class="st">'td'</span>,class_<span class="op">=</span><span class="st">'Pos(st)'</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_stats)):</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    list_i.append(features_stats[t].text )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Stats <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>list_i, columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(ticker)):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/key-statistics?p='</span> <span class="op">+</span> ticker[i]       </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        driver.get(is_link)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        features_stats <span class="op">=</span> soup.find_all(<span class="st">'td'</span>,class_<span class="op">=</span><span class="st">'Fw(500) Ta(end) Pstart(10px) Miw(60px)'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(features_stats)):</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i] <span class="op">=</span> features_stats[j].text</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    driver.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stats.to_csv(r'Stats.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="profile" class="level2">
<h2 class="anchored" data-anchor-id="profile">Profile</h2>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Profile <span class="op">=</span>  pd.DataFrame(index<span class="op">=</span><span class="bu">range</span>(<span class="dv">3</span>),columns<span class="op">=</span>ticker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(ticker)):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    driver <span class="op">=</span> webdriver.Chrome(ChromeDriverManager().install())</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    is_link <span class="op">=</span> <span class="st">'https://finance.yahoo.com/quote/'</span> <span class="op">+</span> ticker[i] <span class="op">+</span><span class="st">'/profile?p='</span> <span class="op">+</span> ticker[i]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    driver.get(is_link)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> driver.execute_script(<span class="st">'return document.body.innerHTML;'</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(html,<span class="st">'lxml'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">0</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'span'</span>,class_<span class="op">=</span><span class="st">'Fw(600)'</span>)[<span class="dv">0</span>].text</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'span'</span>,class_<span class="op">=</span><span class="st">'Fw(600)'</span>)[<span class="dv">2</span>].text</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">3</span>,i] <span class="op">=</span> soup.find_all(<span class="st">'td'</span>,class_<span class="op">=</span><span class="st">'Ta(end)'</span>)[<span class="dv">0</span>].text</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        Profile<span class="op">=</span> Profile.rename(columns<span class="op">=</span>{i: ticker[i]})</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    driver.close()</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>Profile <span class="op">=</span> Profile.rename( index<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'Sector'</span>,<span class="dv">1</span>: <span class="st">'Employee'</span>,<span class="dv">2</span>: <span class="st">'Salary'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Profile.to_csv(r'Profile.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<a class="quarto-notebook-link" id="nblink-1" href="..\..\Documents\ML\Capstone\FinalProject\1_data_collection-preview.html#cell-0">Source: 1. Data Collection</a></section>
<section id="data-preparation" class="level1 quarto-embed-nb-cell">
<h1>2. Data Preparation</h1>
<ul>
<li><ol type="a">
<li>Data cleaning and manipulation</li>
</ol></li>
<li><ol start="2" type="a">
<li>Variables pre-selection</li>
</ol></li>
<li><ol start="3" type="a">
<li>Missing values</li>
</ol></li>
<li><ol start="4" type="a">
<li>Features engineering</li>
</ol></li>
<li><ol start="5" type="a">
<li>Features encoding</li>
</ol></li>
<li><ol start="6" type="a">
<li>Correlation matrix</li>
</ol></li>
<li><ol start="7" type="a">
<li>Data split</li>
</ol></li>
<li><ol start="8" type="a">
<li>Outliers</li>
</ol></li>
<li><ol type="i">
<li>Check for inconsistencies</li>
</ol></li>
</ul>
<section id="a-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="a-data-cleaning">a) Data Cleaning</h2>
<p>During the proposal, I found easier and less messy to clean my data datasets by datasets.</p>
<ul>
<li><h3 id="features-variables" class="anchored">Features variables:</h3></li>
</ul>
<section id="balance-sheet" class="level4">
<h4 class="anchored" data-anchor-id="balance-sheet">Balance sheet</h4>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas as pd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> pd.read_csv(<span class="st">'BS.csv'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>BS.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>BS.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I also replace commas and â€˜-â€™ symbol by nothing. It is very important to distinguish the case where â€˜-â€™ is used to indicate â€˜no value availableâ€™ and the case where â€˜-â€™ is simply a negative value. In order to do that, I use the following regex expression [-]$.</p>
<p>I need to replace the nan values by nothing.</p>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> BS.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply the function created above to my dataframe.</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> BS.columns:</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    BS[column] <span class="op">=</span> convert_to_numeric(BS[column].astype(<span class="bu">str</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> BS.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the balance sheet dataframe:</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>BS.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total Assets</td>
<td>323888000.0</td>
<td>301311000.0</td>
<td>321195000.0</td>
<td>553905000.0</td>
<td>319616000.0</td>
<td>319616000.0</td>
<td>159316000.0</td>
<td>1333425000.0</td>
<td>1333425000.0</td>
<td>52148000.0</td>
<td>...</td>
<td>581204000.0</td>
<td>585615.0</td>
<td>8343900.0</td>
<td>353556.0</td>
<td>3043897.0</td>
<td></td>
<td>2598518.0</td>
<td>6092074.0</td>
<td></td>
<td>825463.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Current Assets</td>
<td>143713000.0</td>
<td>181915000.0</td>
<td>132733000.0</td>
<td></td>
<td>174296000.0</td>
<td>174296000.0</td>
<td>75670000.0</td>
<td>317647000.0</td>
<td>317647000.0</td>
<td>26717000.0</td>
<td>...</td>
<td>292258000.0</td>
<td>249323.0</td>
<td>2118800.0</td>
<td>314196.0</td>
<td>607821.0</td>
<td></td>
<td>708367.0</td>
<td></td>
<td></td>
<td>509031.0</td>
</tr>
</tbody>
</table>

<p>2 rows Ã— 3000 columns</p>
</div>
</div>
</div>
</section>
<section id="income-statement-1" class="level4">
<h4 class="anchored" data-anchor-id="income-statement-1">Income statement</h4>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Profile <span class="op">=</span> pd.read_csv(<span class="st">'Profile.csv'</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Profile.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Profile.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I need to delete commas for the Employee variable and be sure that this variable contains only numerical character. In order to do that, I use the following regex expression [^0-9].</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace ',' and check numerical character</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Profile.shape[<span class="dv">1</span>]):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">1</span>,i].replace(<span class="st">','</span>,<span class="st">''</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> <span class="bu">str</span>(Profile.iloc[<span class="dv">1</span>,i])</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> re.sub(<span class="st">'[^0-9]'</span>,<span class="st">''</span>,Profile.iloc[<span class="dv">1</span>,i])        </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> <span class="st">''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I need to replace the nan values by nothing.</p>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> BS.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import re</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply the function created above to my dataframe.</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> BS.columns:</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    BS[column] <span class="op">=</span> convert_to_numeric(BS[column].astype(<span class="bu">str</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>BS <span class="op">=</span> BS.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the balance sheet dataframe:</p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>BS.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total Assets</td>
<td>323888000.0</td>
<td>301311000.0</td>
<td>321195000.0</td>
<td>553905000.0</td>
<td>319616000.0</td>
<td>319616000.0</td>
<td>159316000.0</td>
<td>1333425000.0</td>
<td>1333425000.0</td>
<td>52148000.0</td>
<td>...</td>
<td>581204000.0</td>
<td>585615.0</td>
<td>8343900.0</td>
<td>353556.0</td>
<td>3043897.0</td>
<td></td>
<td>2598518.0</td>
<td>6092074.0</td>
<td></td>
<td>825463.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Current Assets</td>
<td>143713000.0</td>
<td>181915000.0</td>
<td>132733000.0</td>
<td></td>
<td>174296000.0</td>
<td>174296000.0</td>
<td>75670000.0</td>
<td>317647000.0</td>
<td>317647000.0</td>
<td>26717000.0</td>
<td>...</td>
<td>292258000.0</td>
<td>249323.0</td>
<td>2118800.0</td>
<td>314196.0</td>
<td>607821.0</td>
<td></td>
<td>708367.0</td>
<td></td>
<td></td>
<td>509031.0</td>
</tr>
</tbody>
</table>

<p>2 rows Ã— 3000 columns</p>
</div>
</div>
</div>
</section>
<section id="income-statement-2" class="level4">
<h4 class="anchored" data-anchor-id="income-statement-2">Income statement</h4>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Profile <span class="op">=</span> pd.read_csv(<span class="st">'Profile.csv'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>Profile.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Profile.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I need to delete commas for the Employee variable and be sure that this variable contains only numerical character. In order to do that, I use the following regex expression [^0-9].</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace ',' and check numerical character</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Profile.shape[<span class="dv">1</span>]):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">1</span>,i].replace(<span class="st">','</span>,<span class="st">''</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> <span class="bu">str</span>(Profile.iloc[<span class="dv">1</span>,i])</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> re.sub(<span class="st">'[^0-9]'</span>,<span class="st">''</span>,Profile.iloc[<span class="dv">1</span>,i])        </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">1</span>,i] <span class="op">=</span> <span class="st">''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, I have to replace â€˜Mâ€™ and â€˜kâ€™ by their numeric conversions (x1â€™000â€™000 and x1â€™000).</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Profile <span class="op">=</span> Profile.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric conversion </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Profile.shape[<span class="dv">1</span>]):</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">''</span> <span class="kw">in</span> Profile.iloc[<span class="dv">2</span>,i]:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'M'</span> <span class="kw">in</span> Profile.iloc[<span class="dv">2</span>,i]:</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">2</span>,i].replace(<span class="st">'M'</span>,<span class="st">''</span>) </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> <span class="bu">float</span>(Profile.iloc[<span class="dv">2</span>,i])</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">2</span>,i]<span class="op">*</span><span class="dv">1000000</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'k'</span> <span class="kw">in</span> Profile.iloc[<span class="dv">2</span>,i]:</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">2</span>,i].replace(<span class="st">'k'</span>,<span class="st">''</span>) </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> <span class="bu">float</span>(Profile.iloc[<span class="dv">2</span>,i])</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        Profile.iloc[<span class="dv">2</span>,i] <span class="op">=</span> Profile.iloc[<span class="dv">2</span>,i]<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the profile dataframe:</p>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Profile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sector</td>
<td>Technology</td>
<td>Technology</td>
<td>Consumer Cyclical</td>
<td></td>
<td>Communication Services</td>
<td>Communication Services</td>
<td>Communication Services</td>
<td>Communication Services</td>
<td>Communication Services</td>
<td>Consumer Cyclical</td>
<td>...</td>
<td>Industrials</td>
<td>Consumer Defensive</td>
<td>Industrials</td>
<td>Healthcare</td>
<td>Consumer Cyclical</td>
<td>Lawyer: How Jen Shah's 'Real Housewives' money...</td>
<td>Industrials</td>
<td>Ficial Services</td>
<td>Ficial Services</td>
<td>Healthcare</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Employee</td>
<td>147000</td>
<td>163000</td>
<td>1298000</td>
<td></td>
<td>135301</td>
<td>135301</td>
<td>58604</td>
<td>85858</td>
<td>85858</td>
<td>70757</td>
<td>...</td>
<td>21725</td>
<td>1451</td>
<td>112394</td>
<td>223</td>
<td>3924</td>
<td></td>
<td>4362</td>
<td>1038</td>
<td></td>
<td>1325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Salary</td>
<td>1.477e+07</td>
<td>1.36e+07</td>
<td>1.68e+06</td>
<td></td>
<td>4.01e+06</td>
<td>4.01e+06</td>
<td>2.342e+07</td>
<td>7.1e+06</td>
<td>7.1e+06</td>
<td>23760</td>
<td>...</td>
<td></td>
<td>906030</td>
<td>1.02e+06</td>
<td>954110</td>
<td></td>
<td>0.00</td>
<td>982410</td>
<td>1.86e+06</td>
<td>969520</td>
<td>1.36e+06</td>
</tr>
</tbody>
</table>

<p>3 rows Ã— 3000 columns</p>
</div>
</div>
</div>
</section>
<section id="statistics-1" class="level4">
<h4 class="anchored" data-anchor-id="statistics-1">Statistics</h4>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Stats <span class="op">=</span> pd.read_csv(<span class="st">'Stats.csv'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>Stats.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>Stats.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I check the features in order to do a first subset features selection:</p>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>Stats.AAPL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
Market Cap (intraday) 5                                  2.12T
Enterprise Value 3                                       2.15T
Trailing P/E                                             34.23
Forward P/E 1                                            26.85
PEG Ratio (5 yr expected) 1                               1.84
Price/Sales (ttm)                                         7.20
Price/Book (mrq)                                         32.07
Enterprise Value/Revenue 3                                7.31
Enterprise Value/EBITDA 6                                25.23
Beta (5Y Monthly)                                         1.22
52-Week Change 3                                           NaN
S&amp;P500 52-Week Change 3                                    NaN
52 Week High 3                                          145.09
52 Week Low 3                                            64.75
50-Day Moving Average 3                                 123.31
200-Day Moving Average 3                                123.35
Avg Vol (3 month) 3                                    109.22M
Avg Vol (10 day) 3                                      89.94M
Shares Outstanding 5                                    16.79B
Float                                                   16.77B
% Held by Insiders 1                                     0.08%
% Held by Institutions 1                                59.79%
Shares Short (Mar 14, 2021) 4                          107.01M
Short Ratio (Mar 14, 2021) 4                              0.89
Short % of Float (Mar 14, 2021) 4                        0.64%
Short % of Shares Outstanding (Mar 14, 2021) 4           0.64%
Shares Short (prior month Feb 11, 2021) 4               88.33M
Forward Annual Dividend Rate 4                            0.82
Forward Annual Dividend Yield 4                          0.65%
Trailing Annual Dividend Rate 3                           0.81
Trailing Annual Dividend Yield 3                         0.64%
5 Year Average Dividend Yield 4                           1.39
Payout Ratio 4                                          21.77%
Dividend Date 3                                   Feb 10, 2021
Ex-Dividend Date 4                                Feb 04, 2021
Last Split Factor 2                                        4:1
Last Split Date 3                                 Aug 30, 2020
Fiscal Year Ends                                  Sep 25, 2020
Most Recent Quarter (mrq)                         Dec 25, 2020
Profit Margin                                           21.74%
Operating Margin (ttm)                                  25.25%
Return on Assets (ttm)                                  13.36%
Return on Equity (ttm)                                  82.09%
Revenue (ttm)                                          294.14B
Revenue Per Share (ttm)                                  17.13
Quarterly Revenue Growth (yoy)                          21.40%
Gross Profit (ttm)                                     104.96B
EBITDA                                                  85.16B
Net Income Avi to Common (ttm)                          63.93B
Diluted EPS (ttm)                                         3.69
Quarterly Earnings Growth (yoy)                         29.30%
Total Cash (mrq)                                        76.83B
Total Cash Per Share (mrq)                                4.58
Total Debt (mrq)                                       112.04B
Total Debt/Equity (mrq)                                 169.19
Current Ratio (mrq)                                       1.16
Book Value Per Share (mrq)                                3.94
Operating Cash Flow (ttm)                               88.92B
Levered Free Cash Flow (ttm)                            66.89B
Name: AAPL, dtype: object</code></pre>
</div>
</div>
<p>I am interested in the following features:</p>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset of features</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Stats <span class="op">=</span> Stats.loc[[<span class="st">'Trailing P/E '</span> ,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'PEG Ratio (5 yr expected) 1'</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Quarterly Revenue Growth (yoy)'</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Diluted EPS (ttm)'</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Quarterly Earnings Growth (yoy)'</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Payout Ratio 4'</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Trailing Annual Dividend Yield 3'</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Beta (5Y Monthly) '</span>],:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I rename corectly the variables.</p>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename features</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Stats.rename({<span class="st">'Trailing P/E '</span>:<span class="st">'Trailing P/E'</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'PEG Ratio (5 yr expected) 1'</span>:<span class="st">'PEG Ratio'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Payout Ratio 4'</span>:<span class="st">'Payout Ratio'</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Trailing Annual Dividend Yield 3'</span>:<span class="st">'Trailing Annual Dividend Yield'</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Beta (5Y Monthly) '</span>:<span class="st">'Beta'</span>},inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>Stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Trailing P/E</td>
<td>34.23</td>
<td>36.96</td>
<td>77.07</td>
<td>267.81</td>
<td>37.69</td>
<td>37.96</td>
<td>30.35</td>
<td>33.60</td>
<td>33.66</td>
<td>1,080.66</td>
<td>...</td>
<td>8.92</td>
<td>19.60</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>14.47</td>
<td>10.87</td>
<td>97.60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PEG Ratio</td>
<td>1.84</td>
<td>1.87</td>
<td>1.71</td>
<td>NaN</td>
<td>1.72</td>
<td>1.73</td>
<td>1.15</td>
<td>48.59</td>
<td>58.93</td>
<td>4.82</td>
<td>...</td>
<td>NaN</td>
<td>12.17</td>
<td>NaN</td>
<td>-0.16</td>
<td>NaN</td>
<td>NaN</td>
<td>1.76</td>
<td>NaN</td>
<td>NaN</td>
<td>2.49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Quarterly Revenue Growth (yoy)</td>
<td>21.40%</td>
<td>16.70%</td>
<td>43.60%</td>
<td>NaN</td>
<td>23.50%</td>
<td>23.50%</td>
<td>33.20%</td>
<td>26.40%</td>
<td>26.40%</td>
<td>45.50%</td>
<td>...</td>
<td>-9.90%</td>
<td>-30.50%</td>
<td>-12.20%</td>
<td>-41.30%</td>
<td>-85.90%</td>
<td>NaN</td>
<td>22.70%</td>
<td>6.70%</td>
<td>16.80%</td>
<td>23.10%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Diluted EPS (ttm)</td>
<td>3.69</td>
<td>6.71</td>
<td>41.83</td>
<td>NaN</td>
<td>58.61</td>
<td>58.61</td>
<td>10.09</td>
<td>2.52</td>
<td>2.52</td>
<td>0.64</td>
<td>...</td>
<td>1.48</td>
<td>0.75</td>
<td>-0.2940</td>
<td>-2.50</td>
<td>-4.41</td>
<td>NaN</td>
<td>-0.34</td>
<td>3.22</td>
<td>1,103.90</td>
<td>0.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Quarterly Earnings Growth (yoy)</td>
<td>29.30%</td>
<td>32.70%</td>
<td>121.00%</td>
<td>NaN</td>
<td>42.70%</td>
<td>42.70%</td>
<td>52.70%</td>
<td>174.80%</td>
<td>174.80%</td>
<td>157.10%</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>119.70%</td>
<td>33.10%</td>
<td>187.90%</td>
<td>-92.90%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Payout Ratio</td>
<td>21.77%</td>
<td>31.15%</td>
<td>0.00%</td>
<td>NaN</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>6.70%</td>
<td>0.00%</td>
<td>...</td>
<td>NaN</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>NaN</td>
<td>NaN</td>
<td>6.21%</td>
<td>NaN</td>
<td>115.63%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Trailing Annual Dividend Yield</td>
<td>0.64%</td>
<td>0.86%</td>
<td>NaN</td>
<td>0.12%</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.25%</td>
<td>0.25%</td>
<td>NaN</td>
<td>...</td>
<td>2.07%</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.96%</td>
<td>0.43%</td>
<td>1.75%</td>
<td>1.16%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Beta</td>
<td>1.22</td>
<td>0.79</td>
<td>1.12</td>
<td>NaN</td>
<td>1.00</td>
<td>1.00</td>
<td>1.29</td>
<td>0.50</td>
<td>0.50</td>
<td>2.01</td>
<td>...</td>
<td>1.20</td>
<td>2.41</td>
<td>2.01</td>
<td>1.35</td>
<td>-0.91</td>
<td>NaN</td>
<td>1.77</td>
<td>0.93</td>
<td>0.43</td>
<td>0.53</td>
</tr>
</tbody>
</table>

<p>8 rows Ã— 3000 columns</p>
</div>
</div>
</div>
<p>I have to transform the â€˜%â€™ by its numeric conversion (/100).</p>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>Stats <span class="op">=</span> Stats.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric conversion</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Stats.shape[<span class="dv">0</span>]):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Stats.shape[<span class="dv">1</span>]):</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'%'</span> <span class="kw">in</span> Stats.iloc[j,i]:</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i] <span class="op">=</span> Stats.iloc[j,i].replace(<span class="st">','</span>,<span class="st">''</span>) </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i] <span class="op">=</span> Stats.iloc[j,i].replace(<span class="st">'%'</span>,<span class="st">''</span>) </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i] <span class="op">=</span> <span class="bu">float</span>(Stats.iloc[j,i])</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i] <span class="op">=</span> Stats.iloc[j,i]<span class="op">/</span><span class="dv">100</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'âˆž'</span> <span class="kw">in</span> Stats.iloc[j,i]:</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>            Stats.iloc[j,i]<span class="op">=</span><span class="st">''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I also replace commas and â€˜-â€™.</p>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> Stats.columns:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    Stats[column] <span class="op">=</span> convert_to_numeric(Stats[column].astype(<span class="bu">str</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>Stats <span class="op">=</span> Stats.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the basic statistics dataframe:</p>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>Stats.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Trailing P/E</td>
<td>34.23</td>
<td>36.96</td>
<td>77.07</td>
<td>267.81</td>
<td>37.69</td>
<td>37.96</td>
<td>30.35</td>
<td>33.6</td>
<td>33.66</td>
<td>1080.66</td>
<td>...</td>
<td>8.92</td>
<td>19.6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>14.47</td>
<td>10.87</td>
<td>97.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PEG Ratio</td>
<td>1.84</td>
<td>1.87</td>
<td>1.71</td>
<td></td>
<td>1.72</td>
<td>1.73</td>
<td>1.15</td>
<td>48.59</td>
<td>58.93</td>
<td>4.82</td>
<td>...</td>
<td></td>
<td>12.17</td>
<td></td>
<td>-0.16</td>
<td></td>
<td></td>
<td>1.76</td>
<td></td>
<td></td>
<td>2.49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Quarterly Revenue Growth (yoy)</td>
<td>0.214</td>
<td>0.16699999999999998</td>
<td>0.436</td>
<td></td>
<td>0.235</td>
<td>0.235</td>
<td>0.332</td>
<td>0.264</td>
<td>0.264</td>
<td>0.455</td>
<td>...</td>
<td>-0.099</td>
<td>-0.305</td>
<td>-0.122</td>
<td>-0.413</td>
<td>-0.8590000000000001</td>
<td></td>
<td>0.227</td>
<td>0.067</td>
<td>0.168</td>
<td>0.231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Diluted EPS (ttm)</td>
<td>3.69</td>
<td>6.71</td>
<td>41.83</td>
<td></td>
<td>58.61</td>
<td>58.61</td>
<td>10.09</td>
<td>2.52</td>
<td>2.52</td>
<td>0.64</td>
<td>...</td>
<td>1.48</td>
<td>0.75</td>
<td>-0.294</td>
<td>-2.5</td>
<td>-4.41</td>
<td></td>
<td>-0.34</td>
<td>3.22</td>
<td>1103.9</td>
<td>0.32</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Quarterly Earnings Growth (yoy)</td>
<td>0.293</td>
<td>0.327</td>
<td>1.21</td>
<td></td>
<td>0.4270000000000001</td>
<td>0.4270000000000001</td>
<td>0.527</td>
<td>1.7480000000000002</td>
<td>1.7480000000000002</td>
<td>1.571</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1.197</td>
<td>0.331</td>
<td>1.879</td>
<td>-0.929</td>
</tr>
</tbody>
</table>

<p>5 rows Ã— 3000 columns</p>
</div>
</div>
</div>
</section>
<section id="esg-1" class="level4">
<h4 class="anchored" data-anchor-id="esg-1">ESG</h4>
<div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>ESG <span class="op">=</span> pd.read_csv(<span class="st">'ESG.csv'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ESG.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>ESG.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NaN values to ''</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>ESG <span class="op">=</span> ESG.astype(<span class="bu">str</span>).replace(to_replace<span class="op">=</span><span class="st">'nan'</span>, value<span class="op">=</span><span class="st">''</span>,regex<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the ESG dataframe:</p>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ESG.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">AMZN</th>
<th data-quarto-table-cell-role="th">USB-PA</th>
<th data-quarto-table-cell-role="th">GOOGL</th>
<th data-quarto-table-cell-role="th">GOOG</th>
<th data-quarto-table-cell-role="th">FB</th>
<th data-quarto-table-cell-role="th">TCTZF</th>
<th data-quarto-table-cell-role="th">TCEHY</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">NSHBY</th>
<th data-quarto-table-cell-role="th">STKL</th>
<th data-quarto-table-cell-role="th">FGROF</th>
<th data-quarto-table-cell-role="th">HRTX</th>
<th data-quarto-table-cell-role="th">MSC</th>
<th data-quarto-table-cell-role="th">MTZXF</th>
<th data-quarto-table-cell-role="th">CODI</th>
<th data-quarto-table-cell-role="th">CASH</th>
<th data-quarto-table-cell-role="th">FINN</th>
<th data-quarto-table-cell-role="th">LMNX</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ESG</td>
<td>17.0</td>
<td>15.0</td>
<td>27.0</td>
<td></td>
<td>22.0</td>
<td></td>
<td>32.0</td>
<td>25.0</td>
<td></td>
<td>31.0</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>37</td>
<td></td>
<td></td>
<td>38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">E</td>
<td>0.1</td>
<td>0.5</td>
<td>5.1</td>
<td></td>
<td>0.5</td>
<td></td>
<td>1.4</td>
<td>2.6</td>
<td></td>
<td>3.0</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>11</td>
<td></td>
<td></td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">S</td>
<td>7.7</td>
<td>9.4</td>
<td>12.5</td>
<td></td>
<td>9.9</td>
<td></td>
<td>17.9</td>
<td>13.2</td>
<td></td>
<td>17.3</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>16</td>
<td></td>
<td></td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">G</td>
<td>8.9</td>
<td>4.9</td>
<td>9.8</td>
<td></td>
<td>11.9</td>
<td></td>
<td>12.3</td>
<td>9.1</td>
<td></td>
<td>11.0</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>9</td>
<td></td>
<td></td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Controverse</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td></td>
<td>4.0</td>
<td></td>
<td>4.0</td>
<td>2.0</td>
<td></td>
<td>3.0</td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2</td>
<td></td>
<td></td>
<td>2</td>
</tr>
</tbody>
</table>

<p>5 rows Ã— 3000 columns</p>
</div>
</div>
</div>
</section>
<section id="concatenate" class="level4">
<h4 class="anchored" data-anchor-id="concatenate">Concatenate</h4>
<p>Now that my dataframes are more or less cleaned, I concatenate the 6 dataframes. Then, I transpose the dataframe to have the datapoints in the index and the features in the columns.</p>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate and transpore </span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>frames <span class="op">=</span> [BS,IS ,CF,Profile,Stats,ESG]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat(frames)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s have a first look of the concatenated dataframe:</p>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th">Total Assets</th>
<th data-quarto-table-cell-role="th">Current Assets</th>
<th data-quarto-table-cell-role="th">Cash, Cash Equivalents &amp; Short Term Investments</th>
<th data-quarto-table-cell-role="th">Cash And Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Cash</th>
<th data-quarto-table-cell-role="th">Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Other Short Term Investments</th>
<th data-quarto-table-cell-role="th">Receivables</th>
<th data-quarto-table-cell-role="th">Accounts receivable</th>
<th data-quarto-table-cell-role="th">Gross Accounts Receivable</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Diluted EPS (ttm)</th>
<th data-quarto-table-cell-role="th">Quarterly Earnings Growth (yoy)</th>
<th data-quarto-table-cell-role="th">Payout Ratio</th>
<th data-quarto-table-cell-role="th">Trailing Annual Dividend Yield</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">ESG</th>
<th data-quarto-table-cell-role="th">E</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">G</th>
<th data-quarto-table-cell-role="th">Controverse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>323888000.0</td>
<td>143713000.0</td>
<td>90943000.0</td>
<td>38016000.0</td>
<td>17773000.0</td>
<td>20243000.0</td>
<td>52927000.0</td>
<td>37445000.0</td>
<td>16120000.0</td>
<td></td>
<td>...</td>
<td>3.69</td>
<td>0.293</td>
<td>0.2177</td>
<td>0.0064</td>
<td>1.22</td>
<td>17.0</td>
<td>0.1</td>
<td>7.7</td>
<td>8.9</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>301311000.0</td>
<td>181915000.0</td>
<td>136527000.0</td>
<td>13576000.0</td>
<td></td>
<td></td>
<td>122951000.0</td>
<td>32011000.0</td>
<td>32011000.0</td>
<td>32799000.0</td>
<td>...</td>
<td>6.71</td>
<td>0.327</td>
<td>0.3115</td>
<td>0.0086</td>
<td>0.79</td>
<td>15.0</td>
<td>0.5</td>
<td>9.4</td>
<td>4.9</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>321195000.0</td>
<td>132733000.0</td>
<td>84396000.0</td>
<td>42122000.0</td>
<td></td>
<td></td>
<td>42274000.0</td>
<td>24542000.0</td>
<td>24542000.0</td>
<td>25542000.0</td>
<td>...</td>
<td>41.83</td>
<td>1.21</td>
<td>0.0</td>
<td></td>
<td>1.12</td>
<td>27.0</td>
<td>5.1</td>
<td>12.5</td>
<td>9.8</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">USB-PA</td>
<td>553905000.0</td>
<td></td>
<td></td>
<td>62580000.0</td>
<td></td>
<td></td>
<td>136438000.0</td>
<td>13706000.0</td>
<td></td>
<td></td>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td>0.0012</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>319616000.0</td>
<td>174296000.0</td>
<td>136694000.0</td>
<td>26465000.0</td>
<td></td>
<td></td>
<td>110229000.0</td>
<td>31384000.0</td>
<td>30930000.0</td>
<td>31683000.0</td>
<td>...</td>
<td>58.61</td>
<td>0.4270000000000001</td>
<td>0.0</td>
<td></td>
<td>1.0</td>
<td>22.0</td>
<td>0.5</td>
<td>9.9</td>
<td>11.9</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>5 rows Ã— 177 columns</p>
</div>
</div>
</div>
</section>
<section id="duplicated-values" class="level4">
<h4 class="anchored" data-anchor-id="duplicated-values">Duplicated values</h4>
<p>I have to delete duplicated values.</p>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy as np</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-67" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df.replace(<span class="st">''</span>,np.nan,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I compute how many duplicated rows I have:</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>109</code></pre>
</div>
</div>
<p>I have 109 duplicated rows. Letâ€™s have a look at these duplicated rows:</p>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated()].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th">Total Assets</th>
<th data-quarto-table-cell-role="th">Current Assets</th>
<th data-quarto-table-cell-role="th">Cash, Cash Equivalents &amp; Short Term Investments</th>
<th data-quarto-table-cell-role="th">Cash And Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Cash</th>
<th data-quarto-table-cell-role="th">Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Other Short Term Investments</th>
<th data-quarto-table-cell-role="th">Receivables</th>
<th data-quarto-table-cell-role="th">Accounts receivable</th>
<th data-quarto-table-cell-role="th">Gross Accounts Receivable</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Diluted EPS (ttm)</th>
<th data-quarto-table-cell-role="th">Quarterly Earnings Growth (yoy)</th>
<th data-quarto-table-cell-role="th">Payout Ratio</th>
<th data-quarto-table-cell-role="th">Trailing Annual Dividend Yield</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">ESG</th>
<th data-quarto-table-cell-role="th">E</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">G</th>
<th data-quarto-table-cell-role="th">Controverse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">PVTA</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RBS-PL</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HORI</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NWSKF</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AEH</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AED</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AEB</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MWATF</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SLYQF</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TLPH</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>10 rows Ã— 177 columns</p>
</div>
</div>
</div>
<p>We can see that the duplicated rows are mainly NaN rows.</p>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicated rows </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>df.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We still have a duplicated value with Google, BRK and Tencent. I remove these rows:</p>
<div id="cell-75" class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'GOOG'</span>,axis<span class="op">=</span><span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'BRK-B'</span>,axis<span class="op">=</span><span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'TCEHY'</span>,axis<span class="op">=</span><span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I verify that I have no deplicated values anymore:</p>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df.duplicated().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0</code></pre>
</div>
</div>
<p>We can have a look at a random company:</p>
<div id="cell-79" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample datapoint</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">608</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
Total Assets                                                20696000.0
Current Assets                                               5050800.0
Cash, Cash Equivalents &amp; Short Term Investments              1416700.0
Cash And Cash Equivalents                                    1416700.0
Cash                                                               NaN
Cash Equivalents                                                   NaN
Other Short Term Investments                                       NaN
Receivables                                                        NaN
Accounts receivable                                                NaN
Gross Accounts Receivable                                          NaN
Allowance For Doubtful Accounts Receivable                         NaN
Other Receivables                                                  NaN
Inventory                                                    3427000.0
Other Current Assets                                          207100.0
Total non-current assets                                    15645200.0
Net PPE                                                     10440400.0
Gross PPE                                                   15205400.0
Properties                                                         0.0
Land And Improvements                                         238700.0
Machinery Furniture Equipment                                4229400.0
Leases                                                       2631700.0
Accumulated Depreciation                                    -4765000.0
Goodwill And Other Intangible Assets                         5084400.0
Goodwill                                                     1984400.0
Other Intangible Assets                                      3100000.0
Investments And Advances                                           NaN
Investment in Financial Assets                                     NaN
Available for Sale Securities                                      NaN
Other Non Current Assets                                       97200.0
Total Liabilities Net Minority Interest                     13410700.0
                                                          ...         
Cash Dividends Paid                                                NaN
Common Stock Dividend Paid                                         NaN
Net Other Financing Charges                                   -16900.0
End Cash Position                                            1463600.0
Changes in Cash                                               876700.0
Beginning Cash Position                                       586000.0
Income Tax Paid Supplemental Data                             357700.0
Interest Paid Supplemental Data                               152900.0
Capital Expenditure                                          -898800.0
Issuance of Capital Stock                                          NaN
Issuance of Debt                                              750000.0
Repayment of Debt                                           -1300000.0
Repurchase of Capital Stock                                  -400000.0
Free Cash Flow                                               1817500.0
Sector                                              Consumer Defensive
Employee                                                         60217
Salary                                                        1.63e+06
Trailing P/E                                                     20.82
PEG Ratio                                                         1.74
Quarterly Revenue Growth (yoy)                     0.07200000000000001
Diluted EPS (ttm)                                                 5.65
Quarterly Earnings Growth (yoy)                                  3.088
Payout Ratio                                                       0.0
Trailing Annual Dividend Yield                                     NaN
Beta                                                              0.88
ESG                                                                 18
E                                                                    3
S                                                                    9
G                                                                    6
Controverse                                                          2
Name: DLTR, Length: 177, dtype: object</code></pre>
</div>
</div>
<p>The companyâ€™s ticker is DLTR. The company is therefore â€˜Dollar Treeâ€™. We can see its sector â€˜Consumer Defensiveâ€™. The consumer defensive sector includes companies that manufacture food, beverages, household and personal products, packaging, or tobacco. Dollar Tree is a large company with 60â€™217 employees.</p>
</section>
<section id="store-dataframe" class="level4">
<h4 class="anchored">Store dataframe:</h4>
<p>I can finally store the cleaned dataframe:</p>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#df.to_csv(r'df.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><h3 id="target-variable" class="anchored" data-anchor-id="store-dataframe">Target variable:</h3></li>
</ul>
<div id="cell-85" class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data, reset and rename index</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> pd.read_excel(<span class="vs">r'Target.xlsx'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>target.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>target.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>target.columns <span class="op">=</span> [<span class="st">'MC'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the target variable:</p>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>target.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MC</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>2113621852160</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>1878540681216</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>1624868257792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">USB-PA</td>
<td>1578203611136</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>1498601226240</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I divide by 1â€™000 to get the result in thousands of dollars. Therefore, it will remain consistent with the features variables metrics.</p>
<div id="cell-89" class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric conversion </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> target<span class="op">/</span><span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I select only the subset of companies that have been selected before.</p>
<div id="cell-91" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> target.loc[df.index,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-92" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>target.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>2.113622e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>1.878541e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>1.624868e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">USB-PA</td>
<td>1.578204e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>1.498601e+09</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="b-variable-pre-selection" class="level2">
<h2 class="anchored" data-anchor-id="b-variable-pre-selection">b) Variable pre-selection:</h2>
<p>During the first proposal, we saw that I had webscrapped too many features. Thefore, I first select only the variabbles I am really interested in.</p>
<div id="cell-95" class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset selection</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>BalanceSheet_variables <span class="op">=</span>[<span class="st">'Total Assets'</span>, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Current Assets'</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Cash And Cash Equivalents'</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Receivables'</span>, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Inventory'</span>,  </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total non-current assets'</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net PPE'</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Properties'</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Land And Improvements'</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Accumulated Depreciation'</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Goodwill And Other Intangible Assets'</span>, </span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total Liabilities Net Minority Interest'</span>,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Current Liabilities'</span>,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Current Debt And Capital Lease Obligation'</span>,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Current Debt'</span>,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total Equity Gross Minority Interest'</span>,</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Stockholders' Equity"</span>,</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Capital Stock'</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Common Stock'</span>,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Retained Earnings'</span>, </span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total Capitalization'</span>,</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Tangible Assets'</span>,</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Working Capital'</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Invested Capital'</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Tangible Book Value'</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total Debt'</span>,</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Debt'</span>, </span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Share Issued'</span>,</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Ordinary Shares Number'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-96" class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset selection</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>IncomeStatement_variables<span class="op">=</span> [<span class="st">'Total Revenue'</span>, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Operating Revenue'</span>, </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Cost of Revenue'</span>, </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Gross Profit'</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Operating Expense'</span>, </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Selling General and Administrative'</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Research &amp; Development'</span>, </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Operating Income'</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Pretax Income'</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Tax Provision'</span>, </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Income'</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Income Including Non-Controlling Interests'</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Income Continuous Operations'</span>,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Diluted NI Available to Com Stockholders'</span>, </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Total Expenses'</span>,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Net Income from Continuing &amp; Discontinued Operation'</span>,</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Interest Income'</span>,</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>             <span class="st">'EBIT'</span>,</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>             <span class="st">'EBITDA'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-97" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset selection</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>CashFlow_variables <span class="op">=</span> [<span class="st">'Capital Expenditure'</span>, </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Cash Dividends Paid'</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Cash Flow from Continuing Financing Activities'</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Cash Flow from Continuing Investing Activities'</span>,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Cash Flow from Continuing Operating Activities'</span>, </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Depreciation &amp; amortization'</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Financing Cash Flow'</span>, </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Free Cash Flow'</span>,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Investing Cash Flow'</span>, </span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Issuance of Capital Stock'</span>, </span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Issuance of Debt'</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Operating Cash Flow'</span>,  </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Purchase of Business'</span>,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Purchase of Intangibles'</span>, </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Purchase of Investment'</span>, </span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Purchase of PPE'</span>,</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Stock based compensation'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-98" class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>selection <span class="op">=</span> BalanceSheet_variables <span class="op">+</span> IncomeStatement_variables <span class="op">+</span> CashFlow_variables</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([df.loc[:,selection], df.iloc[:,<span class="op">-</span><span class="dv">16</span>:]],axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-99" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2888, 81)</code></pre>
</div>
</div>
<p>The new dataframe includes 2888 companies and 81 features.</p>
</section>
<section id="c-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="c-missing-values">c) Missing values</h2>
<p>I also do a second selection based on the number of missing values per columns:</p>
<p>I delete the columns and rows in several steps:</p>
<ul>
<li>First, I delete the features that have more than 1000 missing values.</li>
</ul>
<div id="cell-105" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>clean1 <span class="op">=</span> df[df.columns[df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">&lt;</span> <span class="dv">1000</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Second, I delete the companies with more than 30 missing values.</li>
</ul>
<div id="cell-107" class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>clean2 <span class="op">=</span> clean1[clean1.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&lt;</span><span class="dv">30</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Then, I delete the features with more than 450 missing values.</li>
</ul>
<div id="cell-109" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>clean3 <span class="op">=</span> clean2[clean2.columns[clean2.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">&lt;</span> <span class="dv">450</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Finally, I delete the companies with more than 10 missing values.</li>
</ul>
<div id="cell-111" class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>clean4 <span class="op">=</span> clean3[clean3.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&lt;</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-112" class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> clean4.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-113" class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2369, 42)</code></pre>
</div>
</div>
<p>This is the list of my 42 remaining variables:</p>
<div id="cell-115" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index(['Total Assets', 'Cash And Cash Equivalents', 'Net PPE',
       'Goodwill And Other Intangible Assets',
       'Total Liabilities Net Minority Interest',
       'Total Equity Gross Minority Interest', 'Stockholders' Equity',
       'Capital Stock', 'Common Stock', 'Retained Earnings',
       'Total Capitalization', 'Net Tangible Assets', 'Invested Capital',
       'Tangible Book Value', 'Total Debt', 'Share Issued',
       'Ordinary Shares Number', 'Total Revenue', 'Operating Revenue',
       'Operating Expense', 'Selling General and Administrative',
       'Operating Income', 'Pretax Income', 'Tax Provision', 'Net Income',
       'Net Income Including Non-Controlling Interests',
       'Net Income Continuous Operations',
       'Diluted NI Available to Com Stockholders', 'Total Expenses',
       'Net Income from Continuing &amp; Discontinued Operation', 'EBIT', 'EBITDA',
       'Financing Cash Flow', 'Free Cash Flow', 'Investing Cash Flow',
       'Sector', 'Employee', 'Salary', 'Quarterly Revenue Growth (yoy)',
       'Diluted EPS (ttm)', 'Payout Ratio', 'Beta'],
      dtype='object', name='Index')</code></pre>
</div>
</div>
<p>I apply the selection to the target variable:</p>
<div id="cell-117" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> target.loc[df.index,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I want to fill the missing values by the median of the variable grouped by Sector. Therefore, I need to clean this variable first.</p>
<p>I check the different values from the Sector variable:</p>
<div id="cell-120" class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sector'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Industrials               360
Ficial Services           348
Consumer Cyclical         282
Technology                281
Healthcare                250
Basic Materials           156
Consumer Defensive        155
Real Estate               152
Communication Services    134
Energy                    121
Utilities                  98
1.0                         9
Name: Sector, dtype: int64</code></pre>
</div>
</div>
<p>I can first replace â€˜Ficial Servicesâ€™ by â€˜Financial Servicesâ€™.</p>
<div id="cell-122" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">'Sector'</span>] <span class="op">==</span><span class="st">'Ficial Services'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Financial Services'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I replace the incorrect sectors by a missing value.</p>
<div id="cell-124" class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>list_sector <span class="op">=</span> [<span class="st">'Financial Services'</span>, <span class="st">'Industrials'</span>,<span class="st">'Technology'</span>, <span class="st">'Consumer Cyclical'</span>, <span class="st">'Healthcare'</span>,<span class="st">'Basic Materials'</span>,<span class="st">'Consumer Defensive'</span>, <span class="st">'Real Estate'</span>, <span class="st">'Communication Services'</span> ,<span class="st">'Energy'</span>,<span class="st">'Utilities'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-125" class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="op">~</span>df[<span class="st">'Sector'</span>].isin(list_sector),<span class="st">'Sector'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the list of the companies where the sector is unknown.</p>
<div id="cell-127" class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'Sector'</span>].isnull()][<span class="st">'Sector'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>JGSMY     NaN
BSX       NaN
CEO       NaN
GD        NaN
MGDDY     NaN
EBAYL     NaN
KKR-PA    NaN
CPPCY     NaN
CHA       NaN
SGTPY     NaN
CHU       NaN
ACGL      NaN
NTXFY     NaN
CRL       NaN
SAM       NaN
VNO-PK    NaN
ASH       NaN
PAEKY     NaN
VGGOF     NaN
NINOY     NaN
WTM       NaN
SBFFF     NaN
CCOHF     NaN
MNHFY     NaN
WELPP     NaN
FEEXF     NaN
BAFYY     NaN
HOVNP     NaN
FUN       NaN
SKYW      NaN
MTTRY     NaN
NPSHY     NaN
Name: Sector, dtype: object</code></pre>
</div>
</div>
<p>Since I use the sector to fill the missing values, it is important to find the correct sector for each company. So I searched the sector company by company. And I replace the missing value by the companyâ€™s sector.</p>
<div id="cell-129" class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill the sector variable manually </span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'ACGL'</span>,<span class="st">'Sector'</span>] <span class="op">=</span>  <span class="st">'Financial Services'</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'ASH'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Basic Materials'</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'BAFYY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Industrials'</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'BSX'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Healthcare'</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CCOHF'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Utilities'</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CEO'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CHA'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Communication Services'</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CHU'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Communication Services'</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CPPCY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Consumer Cyclical'</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'CRL'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Healthcare'</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'EBAYL'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Consumer Cyclical'</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'FEEXF'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'FUN'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Consumer Defensive'</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'GD'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Industrials'</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'HOVNP'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Real Estate'</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'JGSMY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Industrials'</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'KKR-PA'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Financial Services'</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'MGDDY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Industrials'</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'MNHFY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Industrials'</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'MTTRY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span>  <span class="st">'Consumer Defensive'</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'NINOY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Technology'</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'NPSHY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Basic Materials'</span></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'NTXFY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Financial Services'</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'PAEKY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'SAM'</span>,<span class="st">'Sector'</span>] <span class="op">=</span>  <span class="st">'Consumer Defensive'</span></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'SBFFF'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'SGTPY'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'SKYW'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Technology'</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'VGGOF'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Technology'</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'VNO-PK'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Real Estate'</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'WELPP'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Energy'</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">'WTM'</span>,<span class="st">'Sector'</span>] <span class="op">=</span> <span class="st">'Financial Services'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-130" class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'Sector'</span>].isnull()][<span class="st">'Sector'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Series([], Name: Sector, dtype: object)</code></pre>
</div>
</div>
<p>Now I can fill the missing values.</p>
<p>Letâ€™s first check how many missing values I have per column:</p>
<div id="cell-133" class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of missing values</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
Total Assets                                             0
Cash And Cash Equivalents                                7
Net PPE                                                 87
Goodwill And Other Intangible Assets                   223
Total Liabilities Net Minority Interest                  0
Total Equity Gross Minority Interest                     0
Stockholders' Equity                                     0
Capital Stock                                           41
Common Stock                                            41
Retained Earnings                                      165
Total Capitalization                                     2
Net Tangible Assets                                      0
Invested Capital                                         2
Tangible Book Value                                      0
Total Debt                                              37
Share Issued                                             8
Ordinary Shares Number                                   8
Total Revenue                                            2
Operating Revenue                                      311
Operating Expense                                      323
Selling General and Administrative                     307
Operating Income                                       309
Pretax Income                                            0
Tax Provision                                           73
Net Income                                               0
Net Income Including Non-Controlling Interests           0
Net Income Continuous Operations                         0
Diluted NI Available to Com Stockholders                61
Total Expenses                                         257
Net Income from Continuing &amp; Discontinued Operation      0
EBIT                                                   227
EBITDA                                                 309
Financing Cash Flow                                    333
Free Cash Flow                                         332
Investing Cash Flow                                    336
Sector                                                   0
Employee                                               202
Salary                                                 364
Quarterly Revenue Growth (yoy)                          63
Diluted EPS (ttm)                                       51
Payout Ratio                                           335
Beta                                                    44
dtype: int64</code></pre>
</div>
</div>
<p>We can also see it as a ratio:</p>
<div id="cell-135" class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in %</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)<span class="op">/</span>df.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
Total Assets                                           0.000000
Cash And Cash Equivalents                              0.002955
Net PPE                                                0.036724
Goodwill And Other Intangible Assets                   0.094133
Total Liabilities Net Minority Interest                0.000000
Total Equity Gross Minority Interest                   0.000000
Stockholders' Equity                                   0.000000
Capital Stock                                          0.017307
Common Stock                                           0.017307
Retained Earnings                                      0.069650
Total Capitalization                                   0.000844
Net Tangible Assets                                    0.000000
Invested Capital                                       0.000844
Tangible Book Value                                    0.000000
Total Debt                                             0.015618
Share Issued                                           0.003377
Ordinary Shares Number                                 0.003377
Total Revenue                                          0.000844
Operating Revenue                                      0.131279
Operating Expense                                      0.136344
Selling General and Administrative                     0.129591
Operating Income                                       0.130435
Pretax Income                                          0.000000
Tax Provision                                          0.030815
Net Income                                             0.000000
Net Income Including Non-Controlling Interests         0.000000
Net Income Continuous Operations                       0.000000
Diluted NI Available to Com Stockholders               0.025749
Total Expenses                                         0.108485
Net Income from Continuing &amp; Discontinued Operation    0.000000
EBIT                                                   0.095821
EBITDA                                                 0.130435
Financing Cash Flow                                    0.140566
Free Cash Flow                                         0.140144
Investing Cash Flow                                    0.141832
Sector                                                 0.000000
Employee                                               0.085268
Salary                                                 0.153651
Quarterly Revenue Growth (yoy)                         0.026593
Diluted EPS (ttm)                                      0.021528
Payout Ratio                                           0.141410
Beta                                                   0.018573
dtype: float64</code></pre>
</div>
</div>
<p>We can compute the average:</p>
<div id="cell-137" class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing values mean</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>np.mean(df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)<span class="op">/</span>df.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.04884520291865163</code></pre>
</div>
</div>
<p>So I have about 4.88% of missing values per column in average.</p>
<p>Then, I replace the missing values by the median of the variable grouped by sector.</p>
<div id="cell-140" class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the dataframe to numeric values in order to apply the transformation</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>categorical <span class="op">=</span> pd.DataFrame()</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>categorical[<span class="st">'Sector'</span>] <span class="op">=</span> df[<span class="st">'Sector'</span>]</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'Sector'</span>,axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.<span class="bu">apply</span>(pd.to_numeric)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sector'</span>]<span class="op">=</span> categorical[<span class="st">'Sector'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-141" class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NA by sector median</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.fillna(df.groupby(<span class="st">'Sector'</span>).transform(<span class="st">'median'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-142" class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-143" class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th">Total Assets</th>
<th data-quarto-table-cell-role="th">Cash And Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Net PPE</th>
<th data-quarto-table-cell-role="th">Goodwill And Other Intangible Assets</th>
<th data-quarto-table-cell-role="th">Total Liabilities Net Minority Interest</th>
<th data-quarto-table-cell-role="th">Total Equity Gross Minority Interest</th>
<th data-quarto-table-cell-role="th">Stockholders' Equity</th>
<th data-quarto-table-cell-role="th">Capital Stock</th>
<th data-quarto-table-cell-role="th">Common Stock</th>
<th data-quarto-table-cell-role="th">Retained Earnings</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Financing Cash Flow</th>
<th data-quarto-table-cell-role="th">Free Cash Flow</th>
<th data-quarto-table-cell-role="th">Investing Cash Flow</th>
<th data-quarto-table-cell-role="th">Employee</th>
<th data-quarto-table-cell-role="th">Salary</th>
<th data-quarto-table-cell-role="th">Quarterly Revenue Growth (yoy)</th>
<th data-quarto-table-cell-role="th">Diluted EPS (ttm)</th>
<th data-quarto-table-cell-role="th">Payout Ratio</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">Sector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>3.238880e+08</td>
<td>38016000.0</td>
<td>3.676600e+07</td>
<td>1115000.0</td>
<td>258549000.0</td>
<td>6.533900e+07</td>
<td>6.533900e+07</td>
<td>50779000.0</td>
<td>50779000.0</td>
<td>1.496600e+07</td>
<td>...</td>
<td>-93662000.0</td>
<td>80219000.0</td>
<td>795000.0</td>
<td>147000.0</td>
<td>14770000.0</td>
<td>0.214</td>
<td>3.69</td>
<td>0.2177</td>
<td>1.22</td>
<td>Technology</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>3.013110e+08</td>
<td>13576000.0</td>
<td>5.290400e+07</td>
<td>50389000.0</td>
<td>183007000.0</td>
<td>1.183040e+08</td>
<td>1.183040e+08</td>
<td>80552000.0</td>
<td>80552000.0</td>
<td>3.456600e+07</td>
<td>...</td>
<td>-50830000.0</td>
<td>50436000.0</td>
<td>-11451000.0</td>
<td>163000.0</td>
<td>13600000.0</td>
<td>0.167</td>
<td>6.71</td>
<td>0.3115</td>
<td>0.79</td>
<td>Technology</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>3.211950e+08</td>
<td>42122000.0</td>
<td>1.506670e+08</td>
<td>19998000.0</td>
<td>227791000.0</td>
<td>9.340400e+07</td>
<td>9.340400e+07</td>
<td>5000.0</td>
<td>5000.0</td>
<td>5.255100e+07</td>
<td>...</td>
<td>-1104000.0</td>
<td>25924000.0</td>
<td>-59611000.0</td>
<td>1298000.0</td>
<td>1680000.0</td>
<td>0.436</td>
<td>41.83</td>
<td>0.0000</td>
<td>1.12</td>
<td>Consumer Cyclical</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>3.196160e+08</td>
<td>26465000.0</td>
<td>9.696000e+07</td>
<td>22620000.0</td>
<td>97072000.0</td>
<td>2.225440e+08</td>
<td>2.225440e+08</td>
<td>58510000.0</td>
<td>58510000.0</td>
<td>1.634010e+08</td>
<td>...</td>
<td>-24408000.0</td>
<td>42843000.0</td>
<td>-32773000.0</td>
<td>135301.0</td>
<td>4010000.0</td>
<td>0.235</td>
<td>58.61</td>
<td>0.0000</td>
<td>1.00</td>
<td>Communication Services</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">FB</td>
<td>1.593160e+08</td>
<td>17576000.0</td>
<td>5.498100e+07</td>
<td>19673000.0</td>
<td>31026000.0</td>
<td>1.282900e+08</td>
<td>1.282900e+08</td>
<td>0.0</td>
<td>0.0</td>
<td>7.734500e+07</td>
<td>...</td>
<td>-10292000.0</td>
<td>23632000.0</td>
<td>-30059000.0</td>
<td>58604.0</td>
<td>23420000.0</td>
<td>0.332</td>
<td>10.09</td>
<td>0.0000</td>
<td>1.29</td>
<td>Communication Services</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TCTZF</td>
<td>1.333425e+09</td>
<td>152798000.0</td>
<td>7.771100e+07</td>
<td>175528000.0</td>
<td>555382000.0</td>
<td>7.780430e+08</td>
<td>7.039840e+08</td>
<td>0.0</td>
<td>0.0</td>
<td>5.384640e+08</td>
<td>...</td>
<td>13647000.0</td>
<td>127520000.0</td>
<td>-181955000.0</td>
<td>85858.0</td>
<td>7100000.0</td>
<td>0.264</td>
<td>2.52</td>
<td>0.0000</td>
<td>0.50</td>
<td>Communication Services</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TSLA</td>
<td>5.214800e+07</td>
<td>19384000.0</td>
<td>2.337500e+07</td>
<td>520000.0</td>
<td>29073000.0</td>
<td>2.307500e+07</td>
<td>2.222500e+07</td>
<td>1000.0</td>
<td>1000.0</td>
<td>-5.399000e+06</td>
<td>...</td>
<td>9973000.0</td>
<td>2701000.0</td>
<td>-3132000.0</td>
<td>70757.0</td>
<td>23760.0</td>
<td>0.455</td>
<td>0.64</td>
<td>0.0000</td>
<td>2.01</td>
<td>Consumer Cyclical</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BABA</td>
<td>1.312985e+09</td>
<td>330503000.0</td>
<td>1.380470e+08</td>
<td>337729000.0</td>
<td>442437000.0</td>
<td>8.705480e+08</td>
<td>7.554010e+08</td>
<td>1000.0</td>
<td>1000.0</td>
<td>4.062870e+08</td>
<td>...</td>
<td>-34485.0</td>
<td>408000.0</td>
<td>-166943.5</td>
<td>252084.0</td>
<td>2140000.0</td>
<td>0.369</td>
<td>8.82</td>
<td>0.0000</td>
<td>0.82</td>
<td>Consumer Cyclical</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BRK-A</td>
<td>8.737290e+08</td>
<td>47990000.0</td>
<td>1.870170e+08</td>
<td>104418000.0</td>
<td>422393000.0</td>
<td>4.513360e+08</td>
<td>4.431640e+08</td>
<td>8000.0</td>
<td>8000.0</td>
<td>4.446260e+08</td>
<td>...</td>
<td>-18344000.0</td>
<td>26761000.0</td>
<td>-37757000.0</td>
<td>360000.0</td>
<td>380330.0</td>
<td>-0.015</td>
<td>26667.81</td>
<td>0.0000</td>
<td>0.90</td>
<td>Financial Services</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TSM</td>
<td>2.760600e+09</td>
<td>660170600.0</td>
<td>1.583318e+09</td>
<td>25768100.0</td>
<td>924836700.0</td>
<td>1.835764e+09</td>
<td>1.834811e+09</td>
<td>259303800.0</td>
<td>259303800.0</td>
<td>1.573840e+09</td>
<td>...</td>
<td>-88615087.0</td>
<td>305885103.0</td>
<td>-505781714.0</td>
<td>7000.0</td>
<td>10270000.0</td>
<td>0.140</td>
<td>3.49</td>
<td>0.5010</td>
<td>1.00</td>
<td>Technology</td>
</tr>
</tbody>
</table>

<p>10 rows Ã— 42 columns</p>
</div>
</div>
</div>
</section>
<section id="d-features-engineering" class="level2">
<h2 class="anchored" data-anchor-id="d-features-engineering">d) Features engineering:</h2>
<ul>
<li><h3 id="features-variables-1" class="anchored">Features variables:</h3></li>
</ul>
<div id="cell-146" class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages </span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy.stats import norm</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import seaborn as sns</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I drop the numerical variable:</p>
<div id="cell-148" class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'Sector'</span>,axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-149" class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2369, 41)</code></pre>
</div>
</div>
<p>I have 2369 remaining datapoints and 41 features.</p>
<p>I plot the distribution of the numerical variables:</p>
<div id="cell-152" class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">14</span>,ncols<span class="op">=</span><span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">80</span>))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,axis <span class="kw">in</span> <span class="bu">zip</span>(np.arange(df.shape[<span class="dv">1</span>]),axes.ravel()):</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    sns.distplot(df.iloc[:,i],fit<span class="op">=</span>norm,ax<span class="op">=</span>axis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-79-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Almost all my variables are skewed (except the Beta variable that is very close to a normal distribution). Thefore, I need to apply a log-transformation. Since I have columns containing null values or negative values, I will need three types of log-transformation: - classic log-transformation for positive features - log(1+x) transformation for positive/null features - log(1+x+min(abs(x))) for positive/null/negative features</p>
<p>I drop the Beta feature since it does not need any transformation.</p>
<div id="cell-155" class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> df[<span class="st">'Beta'</span>]</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'Beta'</span>,axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then I first need to split my data between: - only positive datapoints</p>
<div id="cell-157" class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>df_positive <span class="op">=</span> df[df.columns[(df <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">all</span>()]]</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>log_df_positive <span class="op">=</span> np.log(df_positive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>positive and null datapoints</li>
</ul>
<div id="cell-159" class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>list_difference <span class="op">=</span> [item <span class="cf">for</span> item <span class="kw">in</span> df.columns[(df <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>()] <span class="cf">if</span> item <span class="kw">not</span> <span class="kw">in</span> df.columns[(df <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">all</span>()]]</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>df_null <span class="op">=</span> df[list_difference]</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>log_df_null <span class="op">=</span> np.log1p(df_null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>all other data (negative/null/positive)</li>
</ul>
<div id="cell-161" class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>list_difference <span class="op">=</span> [item <span class="cf">for</span> item <span class="kw">in</span> df.columns <span class="cf">if</span> item <span class="kw">not</span> <span class="kw">in</span> df.columns[(df <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>()]]</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>df_negative <span class="op">=</span> df[list_difference]</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>log_df_negative <span class="op">=</span> df_negative.copy()</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,df_negative.shape[<span class="dv">1</span>]):</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    log_df_negative.iloc[:,i] <span class="op">=</span> np.log1p(df_negative.iloc[:,i] <span class="op">+</span> <span class="bu">abs</span>(df_negative.iloc[:,i].<span class="bu">min</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then I can plot the graphs of the log variables:</p>
<div id="cell-163" class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="op">=</span> pd.concat([log_df_positive, log_df_null, log_df_negative],axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-164" class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot </span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">14</span>,ncols<span class="op">=</span><span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">80</span>))</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,axis <span class="kw">in</span> <span class="bu">zip</span>(np.arange(log_df.shape[<span class="dv">1</span>]),axes.ravel()):</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    sns.distplot(log_df.iloc[:,i],fit<span class="op">=</span>norm,ax<span class="op">=</span>axis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-85-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It already looks much better: the data are kind of symmetric and are much closer to a normal distribution.</p>
<p>I add back the beta variable:</p>
<div id="cell-167" class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Beta'</span>] <span class="op">=</span> beta</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Beta'</span>] <span class="op">=</span> beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a small sample of the log data:</p>
<div id="cell-169" class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>log_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Index</th>
<th data-quarto-table-cell-role="th">Total Assets</th>
<th data-quarto-table-cell-role="th">Cash And Cash Equivalents</th>
<th data-quarto-table-cell-role="th">Net PPE</th>
<th data-quarto-table-cell-role="th">Total Liabilities Net Minority Interest</th>
<th data-quarto-table-cell-role="th">Share Issued</th>
<th data-quarto-table-cell-role="th">Ordinary Shares Number</th>
<th data-quarto-table-cell-role="th">Selling General and Administrative</th>
<th data-quarto-table-cell-role="th">Employee</th>
<th data-quarto-table-cell-role="th">Salary</th>
<th data-quarto-table-cell-role="th">Capital Stock</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Total Expenses</th>
<th data-quarto-table-cell-role="th">Net Income from Continuing &amp; Discontinued Operation</th>
<th data-quarto-table-cell-role="th">EBIT</th>
<th data-quarto-table-cell-role="th">EBITDA</th>
<th data-quarto-table-cell-role="th">Financing Cash Flow</th>
<th data-quarto-table-cell-role="th">Free Cash Flow</th>
<th data-quarto-table-cell-role="th">Investing Cash Flow</th>
<th data-quarto-table-cell-role="th">Quarterly Revenue Growth (yoy)</th>
<th data-quarto-table-cell-role="th">Diluted EPS (ttm)</th>
<th data-quarto-table-cell-role="th">Beta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>19.595908</td>
<td>17.453518</td>
<td>17.420084</td>
<td>19.370596</td>
<td>16.647356</td>
<td>16.647356</td>
<td>16.828591</td>
<td>11.898188</td>
<td>16.508109</td>
<td>17.742993</td>
<td>...</td>
<td>19.209878</td>
<td>20.856170</td>
<td>20.786357</td>
<td>20.127432</td>
<td>23.519003</td>
<td>23.227046</td>
<td>24.351264</td>
<td>0.792087</td>
<td>4.226542</td>
<td>1.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>19.523654</td>
<td>16.423814</td>
<td>17.783990</td>
<td>19.025035</td>
<td>15.839836</td>
<td>15.839836</td>
<td>17.022030</td>
<td>12.001505</td>
<td>16.425580</td>
<td>18.204414</td>
<td>...</td>
<td>18.352506</td>
<td>20.845059</td>
<td>20.772848</td>
<td>20.103245</td>
<td>23.521616</td>
<td>23.224608</td>
<td>24.350938</td>
<td>0.770571</td>
<td>4.269697</td>
<td>0.79</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>19.587559</td>
<td>17.556081</td>
<td>18.830583</td>
<td>19.243939</td>
<td>13.174956</td>
<td>13.128345</td>
<td>17.171571</td>
<td>14.076335</td>
<td>14.334304</td>
<td>8.517393</td>
<td>...</td>
<td>19.711141</td>
<td>20.818159</td>
<td>20.736647</td>
<td>20.057335</td>
<td>23.524640</td>
<td>23.222596</td>
<td>24.349658</td>
<td>0.887891</td>
<td>4.669271</td>
<td>1.12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>19.582631</td>
<td>17.091334</td>
<td>18.389809</td>
<td>18.390964</td>
<td>13.422797</td>
<td>13.422797</td>
<td>17.182737</td>
<td>11.815257</td>
<td>15.204302</td>
<td>17.884708</td>
<td>...</td>
<td>18.768402</td>
<td>20.835236</td>
<td>20.758501</td>
<td>20.078210</td>
<td>23.523224</td>
<td>23.223985</td>
<td>24.350372</td>
<td>0.801553</td>
<td>4.815431</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">FB</td>
<td>18.886400</td>
<td>16.682045</td>
<td>17.822498</td>
<td>17.250336</td>
<td>14.862479</td>
<td>14.862479</td>
<td>16.714457</td>
<td>10.978558</td>
<td>16.969101</td>
<td>0.000000</td>
<td>...</td>
<td>17.796588</td>
<td>20.825241</td>
<td>20.743379</td>
<td>20.034613</td>
<td>23.524082</td>
<td>23.222408</td>
<td>24.350444</td>
<td>0.844150</td>
<td>4.315887</td>
<td>1.29</td>
</tr>
</tbody>
</table>

<p>5 rows Ã— 41 columns</p>
</div>
</div>
</div>
<ul>
<li><h3 id="target-variable-1" class="anchored">Target variable:</h3></li>
</ul>
<p>Letâ€™s have a look on the target variable main descriptive statistics:</p>
<div id="cell-172" class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>target[<span class="st">'MC'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>count    2.369000e+03
mean     2.939738e+07
std      9.246432e+07
min      1.515630e+06
25%      3.590120e+06
50%      8.958590e+06
75%      2.465150e+07
max      2.113622e+09
Name: MC, dtype: float64</code></pre>
</div>
</div>
<p>The market capitalisation goes from 1.515630e+06 to 2.113622e+09 thousands of US dollars. It has a mean greater than the median. Therefore, the market capitalisation distribution should be right skewed.</p>
<div id="cell-174" class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import math</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy import stats</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from matplotlib.pyplot import figure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also plot the distribution:</p>
<div id="cell-176" class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot target</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>plt.hist(target[<span class="st">'MC'</span>], bins<span class="op">=</span><span class="dv">100</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> np.mean(target[<span class="st">'MC'</span>])</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>variance <span class="op">=</span> np.var(target[<span class="st">'MC'</span>])</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> math.sqrt(variance)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(mu <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>sigma, mu <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>sigma, <span class="dv">100</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x, stats.norm.pdf(x, mu, sigma))</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Market capitalisation'</span>)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Market cap distribution'</span>)</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Skewness='</span>, stats.skew(target[<span class="st">'MC'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-90-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Skewness= 13.611971974367075</code></pre>
</div>
</div>
<p>We can see that the distribution is not symmetric and is exclusively positive. Moreover, the distribution has a very important skewness. Therefore, I apply the log transform in order to get a distribution closer to normal.</p>
<div id="cell-178" class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log target</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>plt.hist(np.log(target[<span class="st">'MC'</span>]), bins<span class="op">=</span><span class="dv">100</span>,density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> np.mean(np.log(target[<span class="st">'MC'</span>]))</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>variance <span class="op">=</span> np.var(np.log(target[<span class="st">'MC'</span>]))</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> math.sqrt(variance)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(mu <span class="op">-</span> <span class="dv">3</span><span class="op">*</span>sigma, mu <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>sigma, <span class="dv">100</span>)</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x, stats.norm.pdf(x, mu, sigma))</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Market capitalisation (log)'</span>)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Market cap distribution (in log)'</span>)</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Skewness='</span>, stats.skew(np.log(target[<span class="st">'MC'</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-91-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Skewness= 0.6519188373695136</code></pre>
</div>
</div>
<p>The results are already much better and the skewness coeficient is closer to 0.</p>
<div id="cell-180" class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>log_target <span class="op">=</span> np.log(target[<span class="st">'MC'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><h3 id="creation-of-binary-and-categorical-variables" class="anchored">Creation of binary and categorical variables:</h3></li>
</ul>
<p>We can also create some binary variables and check the potential differences.</p>
<ul>
<li><strong>Assets VS liabilities</strong>: the goal is to see if the company has more assets than liabilities.</li>
</ul>
<div id="cell-184" class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Assets VS Liabilities'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-185" class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>log_df.loc[(log_df[<span class="st">'Total Assets'</span>] <span class="op">&lt;</span> log_df[<span class="st">'Total Liabilities Net Minority Interest'</span>]),<span class="st">'Assets VS Liabilities'</span>] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Cash flow</strong>: the goal is to see if the company has positive cash flows.</li>
</ul>
<div id="cell-187" class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Positive Free Cash Flow'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-188" class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>log_df.loc[df[<span class="st">'Free Cash Flow'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,<span class="st">'Positive Free Cash Flow'</span>] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>EPS</strong>: the goal is to see if the company has a positive Earnings per share.</li>
</ul>
<div id="cell-190" class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Positive EPS'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-191" class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>log_df.loc[df[<span class="st">'Diluted EPS (ttm)'</span>] <span class="op">&gt;</span> <span class="dv">0</span>,<span class="st">'Positive EPS'</span>] <span class="op">=</span> <span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Beta</strong>: the goal is to see if the company has a Beta bigger than 1.</li>
</ul>
<div id="cell-193" class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Beta &gt; 1'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-194" class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>log_df.loc[df[<span class="st">'Beta'</span>] <span class="op">&gt;</span> <span class="dv">1</span>,<span class="st">'Beta &gt; 1'</span>] <span class="op">=</span> <span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Revenue growth</strong>: the goal is to see if the company has a positive revenue growth.</li>
</ul>
<div id="cell-196" class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>log_df[<span class="st">'Positive Revenue Growth'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-197" class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>log_df.loc[df[<span class="st">'Quarterly Revenue Growth (yoy)'</span>] <span class="op">&gt;</span><span class="dv">0</span>,<span class="st">'Positive Revenue Growth'</span>] <span class="op">=</span> <span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Size</strong>: During the first proposal, we came to the point that I could split the data into 3 categories:
<ul>
<li>large cap</li>
<li>mid cap</li>
<li>â€˜smallâ€™ cap</li>
</ul></li>
</ul>
<p>I first create a column â€˜Sizeâ€™ that will take the three following values: â€˜largeâ€™, â€˜midâ€™ and â€˜smallâ€™.</p>
<div id="cell-200" class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>categorical[<span class="st">'Size'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-201" class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create categorical variables</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,df.shape[<span class="dv">0</span>]):</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> target.iloc[i,<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">17000000</span>:</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>        categorical.iloc[i,<span class="dv">1</span>] <span class="op">=</span> <span class="st">'large'</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="dv">5300000</span> <span class="op">&lt;</span> target.iloc[i,<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">17000000</span> :</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>        categorical.iloc[i,<span class="dv">1</span>] <span class="op">=</span> <span class="st">'mid'</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> target.iloc[i,<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">5300000</span>:</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>        categorical.iloc[i,<span class="dv">1</span>] <span class="op">=</span> <span class="st">'small'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check how many values I have in each category:</p>
<div id="cell-203" class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">'index'</span>:[<span class="st">'large'</span>,<span class="st">'mid'</span>,<span class="st">'small'</span>],<span class="st">'Number'</span>:[(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'large'</span>).<span class="bu">sum</span>(),(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'mid'</span>).<span class="bu">sum</span>(),(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'small'</span>).<span class="bu">sum</span>()],<span class="st">'%'</span>:[<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'large'</span>).<span class="bu">sum</span>()<span class="op">/</span>categorical.shape[<span class="dv">0</span>],<span class="dv">2</span>),<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'mid'</span>).<span class="bu">sum</span>()<span class="op">/</span>categorical.shape[<span class="dv">0</span>],<span class="dv">2</span>),<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>(categorical.iloc[:,<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span><span class="st">'small'</span>).<span class="bu">sum</span>()<span class="op">/</span>categorical.shape[<span class="dv">0</span>],<span class="dv">2</span>)]}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-204" class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute proportion in each class</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>size_table<span class="op">=</span> pd.DataFrame(data).set_index(<span class="st">'index'</span>)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>size_table.index.rename(<span class="st">''</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>size_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Number</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">large</td>
<td>782</td>
<td>33.01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mid</td>
<td>786</td>
<td>33.18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">small</td>
<td>801</td>
<td>33.81</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I have approximately the same numbers in each category.</p>
</section>
<section id="e-features-encoding" class="level2">
<h2 class="anchored" data-anchor-id="e-features-encoding">e) Features encoding</h2>
<p>I need to use one hot encoding for the string variable â€˜Sectorâ€™.</p>
<div id="cell-208" class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create binary variables</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>Sector_onehot <span class="op">=</span> pd.get_dummies(categorical[<span class="st">'Sector'</span>], columns<span class="op">=</span>[<span class="st">'Sector'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-209" class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>Sector_onehot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Communication Services</th>
<th data-quarto-table-cell-role="th">Consumer Cyclical</th>
<th data-quarto-table-cell-role="th">Consumer Defensive</th>
<th data-quarto-table-cell-role="th">Energy</th>
<th data-quarto-table-cell-role="th">Financial Services</th>
<th data-quarto-table-cell-role="th">Healthcare</th>
<th data-quarto-table-cell-role="th">Industrials</th>
<th data-quarto-table-cell-role="th">Real Estate</th>
<th data-quarto-table-cell-role="th">Technology</th>
<th data-quarto-table-cell-role="th">Utilities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AMZN</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GOOGL</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">FB</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TCTZF</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TSLA</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BABA</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BRK-A</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TSM</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">V</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">JPM</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">JNJ</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WMT</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">UNH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NVDA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BAC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">DIS</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HD</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LVMHF</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LVMUY</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PG</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NSRGY</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NSRGF</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PYPL</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NXCLF</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RHHBY</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RHHBF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RHHVF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">VUZI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">FARO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CDXS</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RKNEF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">QURE</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AHL-PC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SGHIY</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HTLD</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RILY</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GES</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SMIZF</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SUPN</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GBX</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MEGEF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CBD</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GFF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EFSC</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WDR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SKT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WMK</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SWM</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WARFY</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NSHBY</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">STKL</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FGROF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HRTX</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSC</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CODI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CASH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LMNX</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>2369 rows Ã— 10 columns</p>
</div>
</div>
</div>
<div id="cell-210" class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="op">=</span> pd.concat([log_df, Sector_onehot,categorical],axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="f-correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="f-correlation-matrix">f) Correlation matrix</h2>
<p>We plot the correlation matrix of the features variables:</p>
<div id="cell-213" class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>corrMatrix <span class="op">=</span> df.corr()</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corrMatrix,cmap<span class="op">=</span><span class="st">"RdBu"</span>,center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-110-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As expected, many variables are strongly positively correlated. For example, the four â€˜Incomeâ€™ variable have a correlation close to 1. I drop the variables that seem too correlated:</p>
<div id="cell-215" class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop too correlated variables</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">'Capital Stock'</span>,<span class="st">'Ordinary Shares Number'</span>,<span class="st">'Net Income Including Non-Controlling Interests'</span>,<span class="st">"Stockholders' Equity"</span>,<span class="st">'Diluted NI Available to Com Stockholders'</span>,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Net Income Continuous Operations'</span>,<span class="st">'Net Income from Continuing &amp; Discontinued Operation'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can plot the same correlation matrix:</p>
<div id="cell-217" class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot </span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>corrMatrix <span class="op">=</span> df.corr()</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corrMatrix,cmap<span class="op">=</span><span class="st">"RdBu"</span>,center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-112-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="g-data-split" class="level2">
<h2 class="anchored" data-anchor-id="g-data-split">g) Data split</h2>
<p>Before I fill the missing values and check for potential outliers, I split the dataset since I do not want to remove outliers from the Test Set. I use the train_test_split from sklearn to split my data set into a train, a validation and a test set. The training set will have 80% of the companies, the validation set 10% and the test set also 10%.</p>
<div id="cell-220" class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="op">=</span> log_df.iloc[:,:<span class="op">-</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-221" class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>X_train, X_te, y_train, y_te <span class="op">=</span> train_test_split(log_df, log_target, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>X_valid, X_test, y_valid, y_test <span class="op">=</span> train_test_split(X_te, y_te, test_size<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Train:'</span>, X_train.shape, y_train.shape)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation:'</span>, X_valid.shape, y_valid.shape)</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test:'</span>, X_test.shape, y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train: (1895, 56) (1895,)
Validation: (237, 56) (237,)
Test: (237, 56) (237,)</code></pre>
</div>
</div>
<div id="cell-222" class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in dataframe</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> pd.DataFrame(y_train)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> pd.DataFrame(y_test)</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>y_valid <span class="op">=</span> pd.DataFrame(y_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="h-outliers" class="level2">
<h2 class="anchored" data-anchor-id="h-outliers">h) Outliers</h2>
<div id="cell-224" class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concat dataframes for the outliers</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> pd.DataFrame()</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> pd.concat([y_train, X_train],axis<span class="op">=</span><span class="dv">1</span>,sort<span class="op">=</span><span class="st">'False'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For outliers I can first plot boxplots.</p>
<div id="cell-226" class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">11</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">55</span>))</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(trainset.columns[:<span class="op">-</span><span class="dv">15</span>],axes.ravel()):</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    ax.boxplot(trainset[col])</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-117-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From the boxplots, we can see that we have a few very extreme values. These datapoints are correct but represent very rare cases. For the variables that are close to a normal disitrbution, I decide to remove them using z-scores. For the others, I use a specific threshold.</p>
<ul>
<li>Variables close to normal distribution:</li>
</ul>
<p>I first create a subset of variables close to normal.</p>
<div id="cell-230" class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables close to normal</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>normal_var <span class="op">=</span> [<span class="st">'Total Assets'</span>, </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Cash And Cash Equivalents'</span>, </span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Net PPE'</span>,</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Total Liabilities Net Minority Interest'</span>, </span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Share Issued'</span>,</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Ordinary Shares Number'</span>, </span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Selling General and Administrative'</span>,</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Employee'</span>, </span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Salary'</span>, </span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Capital Stock'</span>, </span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Common Stock'</span>, </span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Total Debt'</span>,</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Goodwill And Other Intangible Assets'</span>,</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Operating Revenue'</span>,</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Beta'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I compute the z score:</p>
<div id="cell-232" class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>zscores <span class="op">=</span> (trainset[normal_var] <span class="op">-</span> trainset[normal_var].mean()) <span class="op">/</span> (trainset[normal_var].std())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I filter when z scores are bigger than 4.</p>
<div id="cell-234" class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>zfilter <span class="op">=</span> np.<span class="bu">abs</span>(zscores) <span class="op">&gt;</span> <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-235" class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>zfilter_any  <span class="op">=</span> zfilter.<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-236" class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> trainset[normal_var].loc[zfilter_any, :]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>outliers.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(44, 15)</code></pre>
</div>
</div>
<p>We need to remove 44 datapoints.</p>
<div id="cell-238" class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop outliers</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> trainset.drop(outliers.index, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s plot again the boxplots.</p>
<div id="cell-240" class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots </span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">4</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(normal_var,axes.ravel()):</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    ax.boxplot(trainset[col])</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-124-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It looks much better now. I do not have outliers anymore.</p>
<ul>
<li>Other variables:</li>
</ul>
<p>I select all the other variables (that are not close to a normal distribution and that need outliers removal):</p>
<div id="cell-244" class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables not close to normal distribution</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>other_var <span class="op">=</span> [<span class="st">'Total Equity Gross Minority Interest'</span>,<span class="st">"Stockholders' Equity"</span>,</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Retained Earnings'</span>, <span class="st">'Total Capitalization'</span>, </span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Invested Capital'</span>, <span class="st">'Total Revenue'</span>, <span class="st">'Operating Expense'</span>, </span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Pretax Income'</span>, <span class="st">'Tax Provision'</span>, <span class="st">'Net Income'</span>,</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Net Income Including Non-Controlling Interests'</span>,</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Net Income Continuous Operations'</span>,</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Diluted NI Available to Com Stockholders'</span>,<span class="st">'Total Expenses'</span>,</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Net Income from Continuing &amp; Discontinued Operation'</span>, <span class="st">'EBIT'</span>, <span class="st">'EBITDA'</span>,</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Free Cash Flow'</span>, </span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Diluted EPS (ttm)'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-245" class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">5</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(other_var,axes.ravel()):</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>    ax.boxplot(trainset[col])</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-126-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see from above that for many columns, there are often only one datapoint close to 0. I remove them.</p>
<p>I delete all the datapoints that are below 1. I choose this arbitrary threshold because we can see on the plots above that it is a good threshold to remove the extreme low values.</p>
<div id="cell-248" class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>ofilter <span class="op">=</span> trainset[other_var] <span class="op">&lt;</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-249" class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>ofilter_any <span class="op">=</span> ofilter.<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-250" class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> trainset[other_var].loc[ofilter_any, :]</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>outliers.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(11, 19)</code></pre>
</div>
</div>
<p>Then, I need to remove 11 datapoints.</p>
<div id="cell-252" class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop outliers</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> trainset.drop(outliers.index, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s see the final boxplots.</p>
<div id="cell-254" class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots without outliers</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">11</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">55</span>))</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(trainset.columns[:<span class="op">-</span><span class="dv">15</span>],axes.ravel()):</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    ax.boxplot(trainset[col])</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-131-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In my opinion, there are no more very extreme values that should be deleted. I will use the huber loss function in order to take into account the values that are still a bit far from the median.</p>
<div id="cell-256" class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> pd.DataFrame(trainset.loc[:,<span class="st">'MC'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-257" class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> pd.DataFrame(trainset.iloc[:,<span class="dv">1</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="i-check-for-inconsistencies" class="level2">
<h2 class="anchored" data-anchor-id="i-check-for-inconsistencies">i) Check for inconsistencies</h2>
<p>We can check that we have: Asset = Equity + Liability.</p>
<div id="cell-260" class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute most important accounting equation for all datapoints</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Assets'</span>] <span class="op">-</span> df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Liabilities Net Minority Interest'</span>]<span class="op">-</span> df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Equity Gross Minority Interest'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>AAPL      0.0
MSFT      0.0
AMZN      0.0
GOOGL     0.0
FB        0.0
TCTZF     0.0
TSLA      0.0
BABA      0.0
BRK-A     0.0
TSM       0.0
V         0.0
JPM       0.0
JNJ       0.0
WMT       0.0
MA        0.0
UNH       0.0
NVDA      0.0
BAC       0.0
DIS       0.0
HD        0.0
LVMHF     0.0
LVMUY     0.0
PG        0.0
NSRGY     0.0
NSRGF     0.0
PYPL      0.0
NXCLF     0.0
RHHBY     0.0
RHHBF     0.0
RHHVF     0.0
         ... 
SSYS      0.0
VUZI      0.0
FARO      0.0
CDXS      0.0
QURE      0.0
AHL-PC    0.0
SGHIY     0.0
HTLD      0.0
RILY      0.0
GES       0.0
SMIZF     0.0
SUPN      0.0
GBX       0.0
MEGEF     0.0
CBD       0.0
GFF       0.0
EFSC      0.0
WDR       0.0
SKT       0.0
WMK       0.0
SWM       0.0
WARFY     0.0
NSHBY     0.0
STKL      0.0
FGROF     0.0
HRTX      0.0
MSC       0.0
CODI      0.0
CASH      0.0
LMNX      0.0
Length: 2293, dtype: float64</code></pre>
</div>
</div>
<p>We sum this column:</p>
<div id="cell-262" class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="bu">round</span>((df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Assets'</span>] <span class="op">-</span> df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Liabilities Net Minority Interest'</span>]<span class="op">-</span> df[df[<span class="st">'Total Equity Gross Minority Interest'</span>]<span class="op">&gt;</span><span class="dv">0</span>][<span class="st">'Total Equity Gross Minority Interest'</span>]).<span class="bu">sum</span>(),<span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-0.0</code></pre>
</div>
</div>
<p>It is indeed close to 0.</p>
<p>I can now store the train, validation and test set.</p>
<div id="cell-265" class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store cleaned datasets</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="co">#X_train.to_csv(r'X_train.csv')</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="co">#y_train.to_csv(r'y_train.csv')</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X_valid.to_csv(r'X_valid.csv')</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="co">#y_valid.to_csv(r'y_valid.csv')</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="co">#X_test.to_csv(r'X_test.csv')</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="co">#y_test.to_csv(r'y_test.csv')</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="co">#categorical.to_csv(r'categorical.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<a class="quarto-notebook-link" id="nblink-2" href="..\..\Documents\ML\Capstone\FinalProject\2_data_preparation-preview.html#cell-0">Source: 2. Data Preparation</a></section>
<section id="exploratory-data-analysis-eda" class="level1 quarto-embed-nb-cell">
<h1>3. Exploratory Data Analysis (EDA)</h1>
<div id="cell-1" class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import dataset, reset and rename index</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> pd.read_csv(<span class="st">'X_train.csv'</span>)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>X_train.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>X_train.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>X_valid <span class="op">=</span> pd.read_csv(<span class="st">'X_valid.csv'</span>)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>X_valid.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>X_valid.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> pd.read_csv(<span class="st">'X_test.csv'</span>)</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>X_test.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>X_test.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> pd.read_csv(<span class="st">'y_train.csv'</span>)</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>y_train.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>y_train.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>y_valid <span class="op">=</span> pd.read_csv(<span class="st">'y_valid.csv'</span>)</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>y_valid.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>y_valid.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> pd.read_csv(<span class="st">'y_test.csv'</span>)</span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>y_test.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>y_test.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>categorical <span class="op">=</span> pd.read_csv(<span class="st">'categorical.csv'</span>)</span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>categorical.set_index(<span class="st">'Unnamed: 0'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>categorical.index.rename(<span class="st">'Index'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I gather the three datasets</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> pd.concat([X_train, X_valid, X_test])</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> pd.concat([y_train, y_valid, y_test])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-sector" class="level2">
<h2 class="anchored" data-anchor-id="a-sector">a) Sector</h2>
<p>We can have a look at the distribution of the different industries.</p>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of companies by sector</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>categorical[<span class="st">'Sector'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Industrials               365
Financial Services        352
Consumer Cyclical         284
Technology                284
Healthcare                252
Consumer Defensive        158
Basic Materials           158
Real Estate               154
Communication Services    136
Energy                    127
Utilities                  99
Name: Sector, dtype: int64</code></pre>
</div>
</div>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> figure</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation of palettes to synchronize colors</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span>{<span class="st">'Energy'</span>:<span class="st">'#cb334d'</span>, <span class="st">'Utilities'</span>:<span class="st">'#e95c47'</span>, <span class="st">'Basic Materials'</span>:<span class="st">'#f98e52'</span>,<span class="st">'Industrials'</span>:<span class="st">'#fdbf6f'</span>,<span class="st">'Consumer Cyclical'</span>:<span class="st">'#fee593'</span>,<span class="st">'Consumer Defensive'</span>:<span class="st">'#ffffbe'</span>,<span class="st">'Healthcare'</span>:<span class="st">'#eaf79e'</span>,<span class="st">'Technology'</span>:<span class="st">'#bfe5a0'</span>, <span class="st">'Communication Services'</span>:<span class="st">'#86cfa5'</span>,<span class="st">'Financial Services'</span>:<span class="st">'#54aead'</span>,<span class="st">'Real Estate'</span>:<span class="st">'#3a7eb8'</span>}</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>palette1 <span class="op">=</span> {<span class="dv">10</span>:<span class="st">'#cb334d'</span>, <span class="dv">11</span>:<span class="st">'#e95c47'</span>, <span class="dv">7</span>:<span class="st">'#f98e52'</span>,<span class="dv">1</span>:<span class="st">'#fdbf6f'</span>,<span class="dv">4</span>:<span class="st">'#fee593'</span>,<span class="dv">6</span>:<span class="st">'#ffffbe'</span>,<span class="dv">5</span>:<span class="st">'#eaf79e'</span>,<span class="dv">3</span>:<span class="st">'#bfe5a0'</span>, <span class="dv">9</span>:<span class="st">'#86cfa5'</span>,<span class="dv">2</span>:<span class="st">'#54aead'</span>,<span class="dv">8</span>:<span class="st">'#3a7eb8'</span>}</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot </span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>x_cor<span class="op">=</span> np.array([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>])</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(x_cor,categorical[<span class="st">'Sector'</span>].value_counts(),palette<span class="op">=</span>palette1)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(categorical[<span class="st">'Sector'</span>].value_counts().index)<span class="op">;</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Number of companies by sector'</span>)</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">''</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the two most important sectors are Industrials and Financial services. After that we find the Technology, Healthcare, Consumers goods sectors.</p>
<p>Finally we can check the difference between the industries:</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span>categorical[<span class="st">'Sector'</span>], y<span class="op">=</span>target[<span class="st">'MC'</span>],palette<span class="op">=</span>palette, order<span class="op">=</span>[<span class="st">'Industrials'</span>,<span class="st">'Financial Services'</span>,<span class="st">'Technology'</span>,<span class="st">'Consumer Cyclical'</span>,<span class="st">'Healthcare'</span>,<span class="st">'Consumer Defensive'</span>,<span class="st">'Basic Materials'</span>,<span class="st">'Real Estate'</span>,<span class="st">'Communication Services'</span>,<span class="st">'Energy'</span>, <span class="st">'Utilities'</span> ])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Every sectors have a market capitalisation median close to 8 billion of US dollars (exp(16)*1000). The communication sector has the largest median in terms of market capitalisation. Surprinsigly, the real estate sector has the lowest market capitalisation median.</p>
<p>I also plot the same features but with the <strong>Sector</strong> as the hue.</p>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a smallest dataframe</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>sector2 <span class="op">=</span> pd.concat([features[[<span class="st">'Total Assets'</span>,<span class="st">'Employee'</span>, <span class="st">'Salary'</span>,<span class="st">'Payout Ratio'</span>,<span class="st">'Beta'</span>]],categorical[<span class="st">'Sector'</span>]],axis<span class="op">=</span><span class="dv">1</span>,sort<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>sector2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Total Assets</th>
<th data-quarto-table-cell-role="th">Employee</th>
<th data-quarto-table-cell-role="th">Salary</th>
<th data-quarto-table-cell-role="th">Payout Ratio</th>
<th data-quarto-table-cell-role="th">Beta</th>
<th data-quarto-table-cell-role="th">Sector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AA</td>
<td>16.514184</td>
<td>9.464983</td>
<td>14.827111</td>
<td>0.000000</td>
<td>2.72</td>
<td>Basic Materials</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AAL</td>
<td>17.942774</td>
<td>11.539567</td>
<td>11.062097</td>
<td>0.203186</td>
<td>1.93</td>
<td>Industrials</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAON</td>
<td>13.014796</td>
<td>7.726654</td>
<td>13.232598</td>
<td>0.227136</td>
<td>0.57</td>
<td>Industrials</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AAP</td>
<td>16.286963</td>
<td>10.596635</td>
<td>14.576316</td>
<td>0.131116</td>
<td>1.36</td>
<td>Consumer Cyclical</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>19.595908</td>
<td>11.898188</td>
<td>16.508109</td>
<td>0.196964</td>
<td>1.22</td>
<td>Technology</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since I have a lot of different sectors, I tried to order a bit the sectors from â€˜Basic goodsâ€™ to â€˜Servicesâ€™.</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>sns.pairplot(data<span class="op">=</span>sector2[[<span class="st">'Total Assets'</span>,<span class="st">'Employee'</span>, <span class="st">'Salary'</span>,<span class="st">'Payout Ratio'</span>,<span class="st">'Beta'</span>,<span class="st">'Sector'</span>]],hue<span class="op">=</span><span class="st">'Sector'</span>,diag_kind<span class="op">=</span><span class="st">"hist"</span>,palette<span class="op">=</span><span class="st">'Spectral'</span>,height<span class="op">=</span><span class="fl">3.5</span>,hue_order<span class="op">=</span>[<span class="st">'Energy'</span>, <span class="st">'Utilities'</span>, <span class="st">'Basic Materials'</span>,<span class="st">'Industrials'</span>,<span class="st">'Consumer Cyclical'</span>,<span class="st">'Consumer Defensive'</span>,<span class="st">'Healthcare'</span>,<span class="st">'Technology'</span>, <span class="st">'Communication Services'</span>,<span class="st">'Financial Services'</span>,<span class="st">'Real Estate'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the Real Estate and Financial Services are more concentrated. They also have a small number of employees. On the other hand, the Energy and Utilities sectors are more spread out. However, I can not see specific clusters.</p>
</section>
<section id="b-other-features" class="level2">
<h2 class="anchored" data-anchor-id="b-other-features">b) Other features</h2>
<p>We can see the most positively and negatively correlated variables:</p>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([features, target[<span class="st">'MC'</span>]],axis<span class="op">=</span><span class="dv">1</span>,sort<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Positive correlation</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>df.corr()[<span class="st">'MC'</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>MC                                         1.000000
Employee                                   0.543026
Share Issued                               0.491213
Goodwill And Other Intangible Assets       0.484643
Ordinary Shares Number                     0.480351
Selling General and Administrative         0.455186
Total Assets                               0.445933
Total Liabilities Net Minority Interest    0.440479
Total Debt                                 0.436274
Total Revenue                              0.417677
Name: MC, dtype: float64</code></pre>
</div>
</div>
<p>These variables are logically positively correlated with the market cap. I would have expected even higher correlations for the variables total assets and total revenue.</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative correlation</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>df.corr()[<span class="st">'MC'</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).tail(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Quarterly Revenue Growth (yoy)   -0.003006
Consumer Cyclical                -0.003878
Utilities                        -0.004873
Financing Cash Flow              -0.005512
Investing Cash Flow              -0.021394
Assets VS Liabilities            -0.022224
Industrials                      -0.068172
Real Estate                      -0.101355
Beta &gt; 1                         -0.197493
Beta                             -0.215937
Name: MC, dtype: float64</code></pre>
</div>
</div>
<p>It is interesting to see that the correlations are much closer to 0 with this bigger sample (during the first proposal, I used a smaller sample - SP500 companies - and the correlation were different).</p>
<p>We can also see plot scatter plots to analysis the relation between the features and the target:</p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">11</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">60</span>))</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(df.columns[:<span class="op">-</span><span class="dv">18</span>],axes.ravel()):</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>    ax.scatter(df[col],df[<span class="st">'MC'</span>], marker<span class="op">=</span><span class="st">"+"</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col<span class="op">+</span><span class="bu">str</span>(<span class="st">' Versus MC'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fig, axs = plt.subplots(ncols=2,nrows=21,figsize=(20,200))</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in range(0,21):</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    sns.regplot(log_numerical_wo.columns.to_list()[i],'Market capitalisation',data=log_numerical_wo,ax=axs[i,0])</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in range(0,21):</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    sns.regplot(log_numerical_wo.columns.to_list()[i+21],'Market capitalisation',data=log_numerical_wo,ax=axs[i,1])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We basically have two types of plots: - a scatter plot that shows a positive and linear correlation (e.g.&nbsp;Total assets) - a scatter plot very concentrated in a very narrow range of values (e.g.&nbsp;Financing cash flow)</p>
<p>We can also see that many variables are still similar. Therefore, I will use PCA to create a second feature space. Then I will have these two different features space and see which one performs better.</p>
</section>
<section id="c-classification-and-binary-variables" class="level2">
<h2 class="anchored" data-anchor-id="c-classification-and-binary-variables">c) Classification and binary variables</h2>
<p>We can check the biggest and smallest companies in terms of market capitalisation:</p>
<p><strong>Largest companies</strong></p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the sector and size variable from the categorical dataset</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sector'</span>] <span class="op">=</span> categorical[<span class="st">'Sector'</span>]</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Size'</span>] <span class="op">=</span> categorical[<span class="st">'Size'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'MC'</span>,ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'Sector'</span>][<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
AAPL                 Technology
MSFT                 Technology
AMZN          Consumer Cyclical
GOOGL    Communication Services
FB       Communication Services
TCTZF    Communication Services
TSLA          Consumer Cyclical
BABA          Consumer Cyclical
BRK-A        Financial Services
TSM                  Technology
Name: Sector, dtype: object</code></pre>
</div>
</div>
<p>So the biggest companies are Apple, Microsoft, Amazon, Google, Facebook, Tencent, Tesla, Alibaba, Berkshire Hathaway and Taiwan Semiconductor Manufacture. They are mainly from the Technology, Communication services and Consumer Cyclical sectors.</p>
<p><strong>Smallest companies</strong></p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'MC'</span>,ascending<span class="op">=</span><span class="va">True</span>)[<span class="st">'Sector'</span>][<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index
LMNX             Healthcare
CASH     Financial Services
CODI            Industrials
MSC       Consumer Cyclical
HRTX             Healthcare
FGROF           Industrials
STKL     Consumer Defensive
NSHBY           Industrials
WARFY           Real Estate
SWM         Basic Materials
Name: Sector, dtype: object</code></pre>
</div>
</div>
<p>So the smallest companies are Luminex Corporation, Meta Financial Group, D/B/A Compass Diversified Holdi, MSC Industrial Direct Company, Heron Therapeutics, FIRSTGROUP, SunOpta, NISSHINBO HOLDINGS INC, WHARF and Schweitzer-Mauduit International. They are from various sectors.</p>
<p>We can plot boxplot and categorize by Size:</p>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">11</span>,ncols<span class="op">=</span><span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">63</span>))</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(df.columns[:<span class="op">-</span><span class="dv">18</span>],axes.ravel()):</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(x<span class="op">=</span>df[<span class="st">'Size'</span>], y<span class="op">=</span>df[col], ax<span class="op">=</span>ax ,order<span class="op">=</span>[<span class="st">'small'</span>,<span class="st">'mid'</span>,<span class="st">'large'</span>])</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col<span class="op">+</span><span class="bu">str</span>(<span class="st">' VS Size'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As expected, we can see differences for some features, in particular for the following features: - share issued - total revenue - total expenses - employee</p>
<p>But nothing very strong unfortunately.</p>
<p>I can also plot different variables and put the size as the hue.</p>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create smaller dataframe</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>small_df <span class="op">=</span> df[[<span class="st">'Total Assets'</span>, <span class="st">'Employee'</span>, <span class="st">'Salary'</span>, <span class="st">'Payout Ratio'</span>,<span class="st">'Beta'</span>,<span class="st">'Size'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>sns.pairplot(data<span class="op">=</span>small_df,hue<span class="op">=</span><span class="st">'Size'</span>,height<span class="op">=</span><span class="fl">3.5</span>,hue_order<span class="op">=</span>[<span class="st">'small'</span>,<span class="st">'mid'</span>,<span class="st">'large'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that large companies (in green) are often in the right part of the plots (for the part below the diagonal of the distributions). This is consistent with the positive correlation between the selected features variables.</p>
<ul>
<li><h3 id="binary-variables" class="anchored">Binary variables</h3></li>
</ul>
<p>Now we can plot boxplots again:</p>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>fig,axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>,ncols<span class="op">=</span><span class="dv">5</span>,figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">5</span>))</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col,ax <span class="kw">in</span> <span class="bu">zip</span>(df.columns[<span class="op">-</span><span class="dv">18</span>:<span class="op">-</span><span class="dv">13</span>],axes.ravel()):</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(x<span class="op">=</span>df[col], y<span class="op">=</span>df[<span class="st">'MC'</span>], ax<span class="op">=</span>ax,palette<span class="op">=</span><span class="st">'Set1'</span> )</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>    ax.set_title(col<span class="op">+</span><span class="bu">str</span>(<span class="st">' Versus Size'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see small intuitive differences: - companies with more liabilities have a lower market cap - companies with positive cash flow have a larger market cap - companies with a positive earnings per share ratio have a larger cap - companies with a beta bigger than 1 (which means companies that are more volatile than the market) have a lower maket cap - companies with positive revenue growth have a slightly larger market cap But nothing seems to be very significant.</p>
</section>
<a class="quarto-notebook-link" id="nblink-3" href="..\..\Documents\ML\Capstone\FinalProject\3_EDA-preview.html#cell-0">Source: 3. Exploratory Data Analysis (EDA)</a></section>
<section id="machine-learning-models" class="level1 quarto-embed-nb-cell">
<h1>4. Machine learning models</h1>
<section id="a-baseline" class="level2">
<h2 class="anchored" data-anchor-id="a-baseline">a) Baseline</h2>
<p>First, letâ€™s create the baseline.</p>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function that computes the Mean Absolute Error</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MAE(y, y_pred):</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(np.<span class="bu">abs</span>(y <span class="op">-</span> y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the Mean Absolute Error of the baseline</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>mae_baseline <span class="op">=</span> MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(np.median(y_train[<span class="st">'MC'</span>])))</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'MAE Baseline: </span><span class="sc">{:.5f}</span><span class="st">'</span>.<span class="bu">format</span>(mae_baseline))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE Baseline: 22590390.26206</code></pre>
</div>
</div>
<p>As expected, the Mean Absolute Error of the baseline is quite important.</p>
<p>As stated during the proposal, I want to create three feature spaces: - the original dataset - a subset of variable selected with SelectKBest - a PCA subset</p>
</section>
<section id="b-model-fitting-with-the-original-datset" class="level2">
<h2 class="anchored" data-anchor-id="b-model-fitting-with-the-original-datset">b) Model fitting with the original datset</h2>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert as float values to use algorithms </span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.astype(<span class="bu">float</span>)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>X_valid <span class="op">=</span> X_valid.astype(<span class="bu">float</span>)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.astype(<span class="bu">float</span>)</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y_train.astype(<span class="bu">float</span>)</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>y_valid <span class="op">=</span> y_valid.astype(<span class="bu">float</span>)</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> y_test.astype(<span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><h3 id="k-nearest-neighbors-knn" class="anchored">K-nearest neighbors (KNN)</h3></li>
</ul>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import packages</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>n_neighbors<span class="op">=</span>[]</span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune the parameters</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">50</span>, step<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a k-NN pipeline</span></span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a>    knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span>n))</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator </span></span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a>    knn_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on the validation set</span></span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_valid))))</span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>    n_neighbors.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>results_knn <span class="op">=</span> pd.DataFrame({<span class="st">'n_neighbors'</span>:n_neighbors,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>results_knn.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_neighbors</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2.175721e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>2.920062e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2.988612e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>2.989151e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9</td>
<td>3.023298e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The best result is obtained with 1 neighbor.</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best number of neighbors </span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator </span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>knn_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>test_score_KNN <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_test))))</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>test_score_KNN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>16627359.503122352</code></pre>
</div>
</div>
<p>With 1 neighbor, we obtained a test score of 16â€™627â€™359, which is fortunately a bit better than the baseline.</p>
<ul>
<li><h3 id="decision-tree-and-random-forest" class="anchored">Decision tree and random forest</h3></li>
</ul>
<p>As a graphical purpose, we can plot the beginning of the tree (depth of 3):</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create decision tree</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> DecisionTreeRegressor(max_depth<span class="op">=</span><span class="dv">3</span>, criterion <span class="op">=</span> <span class="st">'mae'</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the tree</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>dt.fit(X_train, y_train[<span class="st">'MC'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DecisionTreeRegressor(criterion='mae', max_depth=3, max_features=None,
           max_leaf_nodes=None, min_impurity_decrease=0.0,
           min_impurity_split=None, min_samples_leaf=1,
           min_samples_split=2, min_weight_fraction_leaf=0.0,
           presort=False, random_state=0, splitter='best')</code></pre>
</div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> export_graphviz</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Export decision tree with good parameters</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>dot_data <span class="op">=</span> export_graphviz(</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>    dt, out_file<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>X_train.columns,</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>    filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> graphviz</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display decision tree</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>graphviz.Source(dot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-11-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the path that lead to the biggest value is a large invested capital, a large number of employee and an important amount of FCF, which makes sense and remains coherent with the previous analyses.</p>
<p>We can now fit and tune our random forest model:</p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the package</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune the parameters</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>n_trees<span class="op">=</span>[]</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">100</span>, step<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random forest pipeline</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>    rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span>n , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the estimator </span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>    rf_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save validation score on the validation set</span></span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_valid))))</span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>    n_trees.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>results_rf <span class="op">=</span> pd.DataFrame({<span class="st">'n_trees'</span>:n_trees,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>results_rf.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_trees</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>95</td>
<td>2.385272e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>85</td>
<td>2.386110e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>89</td>
<td>2.387669e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>91</td>
<td>2.388805e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>63</td>
<td>2.388990e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The best number of trees is close to 100.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best number of trees</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span><span class="dv">95</span> , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator </span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>rf_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>test_score_RF <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_test))))</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>test_score_RF</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>13813525.218626602</code></pre>
</div>
</div>
<p>We obtain a test score of 13â€™813â€™525 with the random forest.</p>
<ul>
<li><h3 id="ridge-and-lasso-regression" class="anchored">Ridge and lasso regression</h3></li>
</ul>
<p>Now, letâ€™s try with regularization.</p>
<p>As discussed during the proposal, I am going to try the penalty â€˜elasticnetâ€™ since it is mixed between L1 and L2 penalty. Moreover, â€˜elasticnetâ€™ allows features selection, which is not possible with L2 penalty.</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the package</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDRegressor</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune the parameter</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span>[]</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.001</span>, <span class="fl">0.05</span>, step<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random forest pipeline</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>    reg_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'SGDRegressor'</span>, SGDRegressor (alpha<span class="op">=</span>i,max_iter<span class="op">=</span><span class="dv">1000</span>,penalty<span class="op">=</span><span class="st">'elasticnet'</span> ,tol<span class="op">=</span><span class="fl">1e-3</span>, loss<span class="op">=</span><span class="st">'huber'</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator </span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>    reg_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score</span></span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(reg_pipe.predict(X_valid))))</span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a>    alpha.append(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>results_reg <span class="op">=</span> pd.DataFrame({<span class="st">'alpha'</span>:alpha,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>results_reg.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">alpha</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.001</td>
<td>3.174063e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.002</td>
<td>3.179318e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.003</td>
<td>3.216834e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.004</td>
<td>3.251821e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.005</td>
<td>3.265793e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best alpha </span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>reg_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'SGDRegressor'</span>, SGDRegressor (alpha<span class="op">=</span><span class="fl">0.001</span>,max_iter<span class="op">=</span><span class="dv">1000</span>,penalty<span class="op">=</span><span class="st">'elasticnet'</span> ,tol<span class="op">=</span><span class="fl">1e-3</span>, loss<span class="op">=</span><span class="st">'huber'</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator on the original data</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>reg_pipe.fit(X_train, y_train[<span class="st">'MC'</span>])</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>test_score_reg <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(reg_pipe.predict(X_test))))</span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>test_score_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>20221795.601256844</code></pre>
</div>
</div>
<p>We obtain a score of 20â€™221â€™795 with the regularization.</p>
</section>
<section id="c-model-fitting-with-a-subset---selectkbest" class="level2">
<h2 class="anchored" data-anchor-id="c-model-fitting-with-a-subset---selectkbest">c) Model fitting with a subset - SelectKBest</h2>
<p>I now want to apply the same models with a subset of features. To select this subset, I use the package SelectKBest of sklearn.</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectKBest, f_regression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a selector for k=10</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> SelectKBest( f_regression, k<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the selector to the trainset </span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>selector.fit(X_train, y_train[<span class="st">'MC'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>SelectKBest(k=10, score_func=&lt;function f_regression at 0x000002328EA5E158&gt;)</code></pre>
</div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get columns to keep and create new dataframe with those only</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> selector.get_support(indices<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subset dataframes</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>X_train_KB<span class="op">=</span> X_train.iloc[:,cols]</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>X_valid_KB<span class="op">=</span> X_valid.iloc[:,cols]</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>X_test_KB<span class="op">=</span> X_test.iloc[:,cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><h3 id="k-nearest-neighbors-knn-1" class="anchored">K-nearest neighbors (KNN)</h3></li>
</ul>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune parameter</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>n_neighbors<span class="op">=</span>[]</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">50</span>, step<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a k-NN pipeline</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>    knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span>n))</span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator </span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>    knn_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on validation set</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_valid_KB))))</span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>    n_neighbors.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation accuracy </span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>results_knn <span class="op">=</span> pd.DataFrame({<span class="st">'n_neighbors'</span>:n_neighbors,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>results_knn.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_neighbors</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>2.821323e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>2.825228e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2.851210e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>9</td>
<td>2.864460e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2.869202e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best n </span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator on the original data</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>knn_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>test_score_KNN_KB <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_test_KB))))</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>test_score_KNN_KB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>17582652.409168214</code></pre>
</div>
</div>
<p>We obtain a test score of 17â€™582â€™652.</p>
<ul>
<li><h3 id="decision-tree-and-random-forest-1" class="anchored">Decision tree and random forest</h3></li>
</ul>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune the parameter</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>n_trees<span class="op">=</span>[]</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">100</span>, step<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random forest pipeline</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>    rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span>n , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator </span></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>    rf_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on validation set</span></span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_valid_KB))))</span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a>    n_trees.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>results_rf <span class="op">=</span> pd.DataFrame({<span class="st">'n_trees'</span>:n_trees,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>results_rf.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_trees</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>93</td>
<td>2.738031e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>99</td>
<td>2.738949e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>97</td>
<td>2.740769e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>89</td>
<td>2.741849e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>63</td>
<td>2.741961e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best number of ntrees</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span><span class="dv">93</span> , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator </span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>rf_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>test_score_RF_KB <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_test_KB))))</span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>test_score_RF_KB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>16938380.214340754</code></pre>
</div>
</div>
<p>We obtain a test score of 16â€™938â€™380 with the random forest.</p>
<ul>
<li><h3 id="ridge-and-lasso-regression-1" class="anchored">Ridge and lasso regression</h3></li>
</ul>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune parameters</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span>[]</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.001</span>, <span class="fl">0.05</span>, step<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random forest pipeline</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>    reg_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'SGDRegressor'</span>, SGDRegressor (alpha<span class="op">=</span>i,max_iter<span class="op">=</span><span class="dv">1000</span>,penalty<span class="op">=</span><span class="st">'elasticnet'</span> ,tol<span class="op">=</span><span class="fl">1e-3</span>, loss<span class="op">=</span><span class="st">'huber'</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator</span></span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a>    reg_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on validation set</span></span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(reg_pipe.predict(X_valid_KB))))</span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a>    alpha.append(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>results_reg_KB <span class="op">=</span> pd.DataFrame({<span class="st">'alpha'</span>:alpha,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>results_reg_KB.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">alpha</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.003</td>
<td>3.332810e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>0.001</td>
<td>3.333645e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.004</td>
<td>3.334584e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.002</td>
<td>3.335439e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.005</td>
<td>3.336677e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best alpha </span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>reg_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler()),</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'SGDRegressor'</span>, SGDRegressor (alpha<span class="op">=</span><span class="fl">0.003</span>,max_iter<span class="op">=</span><span class="dv">1000</span>,penalty<span class="op">=</span><span class="st">'elasticnet'</span> ,tol<span class="op">=</span><span class="fl">1e-3</span>, loss<span class="op">=</span><span class="st">'huber'</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>reg_pipe.fit(X_train_KB, y_train[<span class="st">'MC'</span>])</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>test_score_reg_KB <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(reg_pipe.predict(X_test_KB))))</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>test_score_reg_KB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>21328567.545771167</code></pre>
</div>
</div>
<p>We obtain a test score of 21â€™345â€™491 with the regularization.</p>
</section>
<section id="d-model-fitting-with-a-subset---pca" class="level2">
<h2 class="anchored" data-anchor-id="d-model-fitting-with-a-subset---pca">d) Model fitting with a subset - PCA</h2>
<p>We saw before that I had many correlated variables. Therefore, in order to solve this problem, I am going to try to apply the PCA technique. First, I standardize the features:</p>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize the variables </span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>X_train_rescaled <span class="op">=</span> scaler.fit_transform(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import package</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a PCA transformer</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA to the rescaled data</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>X_train_pca<span class="op">=</span>pca.fit_transform(X_train_rescaled)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>X_train_pca.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(1840, 56)</code></pre>
</div>
</div>
<p>Now I am going to check the proportion of variance explained by the components.</p>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of variance explained</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>pve <span class="op">=</span> pca.explained_variance_ratio_</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative sum of variances</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>pve_cumsum <span class="op">=</span> np.cumsum(pve)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>xcor <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(pve) <span class="op">+</span> <span class="dv">1</span>) </span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>plt.bar(xcor, pve,color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>plt.xticks(xcor)</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>pve_cumsum <span class="op">=</span> np.cumsum(pve)</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>plt.step(xcor<span class="op">+</span><span class="fl">0.5</span>, pve_cumsum, label<span class="op">=</span><span class="st">'cumulative'</span>)</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="fl">0.9</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Proportion of the variance explained by the principal components'</span>)</span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Principal Components'</span>)</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Proportion of the variance explained'</span>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>, pve_cumsum.shape[<span class="dv">0</span>], <span class="dv">10</span>))</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that about 20 components can explain 90% of the variance. Therefore, I am going to use this number of components.</p>
<div id="cell-64" class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a PCA transformer with 0,90 of variance explained</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components <span class="op">=</span> <span class="fl">0.90</span>)</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply PCA to the rescaled data</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>X_train_pca<span class="op">=</span>pca.fit_transform(X_train_rescaled)</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>X_train_pca.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(1840, 21)</code></pre>
</div>
</div>
<p>I can also visualize the features on a 2d-plot and use a different color whether the company is considered as small, mid or large cap:</p>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a PCA with 2 components and fit </span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>pca2 <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>X_2d <span class="op">=</span> pca2.fit_transform(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-67" class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>X_2d[:,<span class="dv">0</span>], y<span class="op">=</span>X_2d[:,<span class="dv">1</span>],hue<span class="op">=</span>categorical.loc[X_train.index,<span class="st">'Size'</span>].values, hue_order <span class="op">=</span> [<span class="st">'small'</span>, <span class="st">'mid'</span>,<span class="st">'large'</span>])</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'First two components and size of companies'</span>)</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'1st component'</span>)</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'2nd component'</span>)</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that â€˜small companiesâ€™ have smaller 1st and 2nd components (bottom left corner in orange). In the other side, the largest companies in green are located on the top right corner.</p>
<p>I need to apply the same transformations (standardization and PCA) to the test and validation set.</p>
<div id="cell-70" class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize </span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>X_valid_rescaled <span class="op">=</span> scaler.transform(X_valid)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>X_test_rescaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform with the pca (90%)</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>X_valid_pca <span class="op">=</span> pca.transform(X_valid_rescaled)</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>X_test_pca <span class="op">=</span> pca.transform(X_test_rescaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><h3 id="k-nearest-neighbors-knn-2" class="anchored">K-nearest neighbors (KNN)</h3></li>
</ul>
<div id="cell-72" class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune parameters</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>n_neighbors<span class="op">=</span>[]</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">50</span>, step<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a k-NN pipeline</span></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>    knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span>n))</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator</span></span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>    knn_pipe.fit(X_train_pca, y_train[<span class="st">'MC'</span>])</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb263-15"><a href="#cb263-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on validation set</span></span>
<span id="cb263-16"><a href="#cb263-16" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_valid_pca))))</span>
<span id="cb263-17"><a href="#cb263-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb263-18"><a href="#cb263-18" aria-hidden="true" tabindex="-1"></a>    n_neighbors.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>results_knn <span class="op">=</span> pd.DataFrame({<span class="st">'n_neighbors'</span>:n_neighbors,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>results_knn.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_neighbors</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2.329356e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>2.954182e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>2.978214e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>9</td>
<td>3.001491e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>11</td>
<td>3.034130e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best n </span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'knn'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator </span></span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>knn_pipe.fit(X_train_pca, y_train[<span class="st">'MC'</span>])</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a>test_score_KNN_pca <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(knn_pipe.predict(X_test_pca))))</span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>test_score_KNN_pca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>16460404.860219397</code></pre>
</div>
</div>
<p>We obtain a test score of 16â€™460â€™404 with the KNN model on the pca feature space.</p>
<ul>
<li><h3 id="decision-tree-and-random-forest-2" class="anchored">Decision tree and random forest</h3></li>
</ul>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and tune parameters</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>n_trees<span class="op">=</span>[]</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>validation_score<span class="op">=</span>[]</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> np.arange(<span class="dv">1</span>,<span class="dv">100</span>,step<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a random forest pipeline</span></span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>    rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span>n , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit estimator </span></span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a>    rf_pipe.fit(X_train_pca, y_train[<span class="st">'MC'</span>])</span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute validation score on validation set</span></span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a>    validation_score.append(MAE(np.exp(y_valid[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_valid_pca))))</span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a>    n_trees.append(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by validation score</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>results_rf <span class="op">=</span> pd.DataFrame({<span class="st">'n_trees'</span>:n_trees,<span class="st">'validation MAE'</span>:validation_score})</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>results_rf.sort_values(by<span class="op">=</span><span class="st">'validation MAE'</span>, ascending<span class="op">=</span><span class="va">True</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_trees</th>
<th data-quarto-table-cell-role="th">validation MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>35</td>
<td>2.755373e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>2.756147e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.758124e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>36</td>
<td>2.763915e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>37</td>
<td>2.764401e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-79" class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick the best number of trees</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'rf'</span>, RandomForestRegressor (n_estimators<span class="op">=</span><span class="dv">35</span> , max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit estimator </span></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a>rf_pipe.fit(X_train_pca, y_train[<span class="st">'MC'</span>])</span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the test score</span></span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a>test_score_RF_pca <span class="op">=</span> (MAE(np.exp(y_test[<span class="st">'MC'</span>]), np.exp(rf_pipe.predict(X_test_pca))))</span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a>test_score_RF_pca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>17197300.465914935</code></pre>
</div>
</div>
<p>We obtain a test score of 17â€™197â€™300 with the random forest on the pca feature space.</p>
<p>No regularization for pca feature space: poor results of the model</p>
</section>
<a class="quarto-notebook-link" id="nblink-4" href="..\..\Documents\ML\Capstone\FinalProject\4_ML_models-preview.html#cell-0">Source: 4. Machine learning models</a></section>
<section id="final-comparison-and-conclusion" class="level1 quarto-embed-nb-cell">
<h1>5. Final comparison and conclusion</h1>
<p>First of all, I want to rank the models for each features spaces. Letâ€™s start by the original dataset:</p>
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>data_original<span class="op">=</span> [{<span class="st">'Baseline'</span>:mae_baseline, <span class="st">'Random Forest (Original)'</span>:test_score_RF,<span class="st">'K nearest neighbors (Original)'</span>:test_score_KNN ,<span class="st">'Regularization (Original)'</span>:test_score_reg}]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by MAE </span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>comparison_original <span class="op">=</span> pd.DataFrame(data_original).T</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>comparison_original.columns <span class="op">=</span> [<span class="st">'MAE Score'</span>]</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>comparison_original.sort_values(<span class="st">'MAE Score'</span>, ascending<span class="op">=</span><span class="va">False</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot </span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>colorlist<span class="op">=</span> [<span class="st">'lightsalmon'</span>,<span class="st">'thistle'</span>,<span class="st">'thistle'</span>,<span class="st">'thistle'</span>]</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>plt.bar(comparison_original.index,comparison_original[<span class="st">'MAE Score'</span>],color<span class="op">=</span>colorlist)</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Absolute Error'</span>)</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MAE of the different models for the original dataset'</span>)</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that all models perform better than the baseline. Random forest is the best model with a MAE of 13â€™813â€™525 thousands of US Dollars.</p>
<p>Then, we can plot the same graph for the SelectKBest dataset:</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Dataframe </span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>data_KB<span class="op">=</span> [{<span class="st">'Baseline'</span>:mae_baseline, <span class="st">'Random Forest (KBest)'</span>:test_score_RF_KB,<span class="st">'K nearest neighbors (KBest)'</span>:test_score_KNN_KB, <span class="st">'Regularization (Kbest)'</span>: test_score_reg_KB}]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by MAE</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>comparison_KB <span class="op">=</span> pd.DataFrame(data_KB).T</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>comparison_KB.columns <span class="op">=</span> [<span class="st">'MAE Score'</span>]</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>comparison_KB.sort_values(<span class="st">'MAE Score'</span>, ascending<span class="op">=</span><span class="va">False</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>colorlist<span class="op">=</span> [<span class="st">'lightsalmon'</span>,<span class="st">'darkseagreen'</span>,<span class="st">'darkseagreen'</span>,<span class="st">'darkseagreen'</span>]</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>plt.bar(comparison_KB.index,comparison_KB[<span class="st">'MAE Score'</span>],color<span class="op">=</span>colorlist)</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Absolute Error'</span>)</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MAE Score of the different models for the Select K Best dataset'</span>)</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that all models perform better than the baseline. Random forest is the best model with a MAE of 16â€™938â€™380 thousands of US Dollars.</p>
<p>We also see the ranking for the PCA features space:</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>data_pca<span class="op">=</span> [{<span class="st">'Baseline'</span>:mae_baseline, <span class="st">'Random Forest (PCA)'</span>:test_score_RF_pca,<span class="st">'K nearest neighbors (PCA)'</span>:test_score_KNN_pca}]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorty by MAE</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>comparison_pca <span class="op">=</span> pd.DataFrame(data_pca).T</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>comparison_pca.columns <span class="op">=</span> [<span class="st">'MAE Score'</span>]</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>comparison_pca.sort_values(<span class="st">'MAE Score'</span>, ascending<span class="op">=</span><span class="va">False</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot </span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="fl">10.5</span>, <span class="dv">8</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>colorlist<span class="op">=</span> [<span class="st">'lightsalmon'</span>,<span class="st">'lightblue'</span>,<span class="st">'lightblue'</span>]</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>plt.bar(comparison_pca.index,comparison_pca[<span class="st">'MAE Score'</span>],color<span class="op">=</span>colorlist)</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Absolute Error'</span>)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MAE Score of the different models for PCA dataset'</span>)</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>All models perform better than the baseline. But this time, KNN is the best model with a performance of 16â€™460â€™404 thousands of US Dollars.</p>
<p>Finally, I rank all models.</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe </span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>comparison_all <span class="op">=</span> pd.concat([comparison_original,comparison_pca,comparison_KB],axis<span class="op">=</span><span class="dv">0</span>).drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by MAE</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>comparison_all.sort_values(<span class="st">'MAE Score'</span>, ascending<span class="op">=</span><span class="va">False</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>colorlist<span class="op">=</span> [<span class="st">'lightsalmon'</span>, <span class="st">'darkseagreen'</span>,<span class="st">'thistle'</span>,<span class="st">'darkseagreen'</span>,<span class="st">'lightblue'</span>,<span class="st">'darkseagreen'</span>,<span class="st">'thistle'</span>,<span class="st">'lightblue'</span>,<span class="st">'thistle'</span>]</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>plt.bar(comparison_all.index,comparison_all[<span class="st">'MAE Score'</span>],color<span class="op">=</span>colorlist)</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Absolute Error'</span>)</span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MAE Score of the different models from different feature spaces'</span>)</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_2_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>We can see that the best model is the Random Forest on the original dataset with a MAE of 13â€™813â€™525 thousands of US Dollars. It means that the predictions are, in average, below or above the observed value by 13â€™813â€™525 thousands of US Dollars. Random forest seems to be the best model across the different features spaces. Indeed, it is the model that performs the best in 2 out of the 3 cases (and is very close to be the best one in the third case).</p></li>
<li><p>We can also say that the original dataset seems to be a good features space for this analysis. I suppose that the dataset has not enough strong significant features to work with only a small subset of features (as I did for the SelectKBest or PCA method). This could potentially explain why the original dataset performs better (?).</p></li>
<li><p>Finally, even though all the tested models perform better than the baseline, I found the results a bit disappointing. It is not a surprise since predicting companies value is a rather complex task.</p></li>
<li><p>In order to improve the models, I think a great way forward would be to work on temporal data and not do a snapshot like I did here. We could also work on a bigger sample of companies. On an other hand, we could have work on a classification task: try to predict whether a company is â€˜smallâ€™, â€˜midâ€™, or â€˜largeâ€™.</p></li>
</ul>
<a class="quarto-notebook-link" id="nblink-5" href="..\..\Documents\ML\Capstone\FinalProject\5_results-preview.html#cell-0">Source: 5. Final comparison and conclusion</a></section>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2023, GrÃ©goire Urvoy</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>