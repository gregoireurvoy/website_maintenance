<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.506">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Gregoire Urvoy – projet_5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Gregoire Urvoy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./home.html"> 
<span class="menu-text">Home page</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-visualizations" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Visualizations</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-visualizations">    
        <li>
    <a class="dropdown-item" href="./visualization_using_Tableau.html">
 <span class="dropdown-text">Visualization using Tableau</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./visualization_using_R.html">
 <span class="dropdown-text">Visualization using R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-academic-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Academic project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-academic-project">    
        <li>
    <a class="dropdown-item" href="./projet_1.html">
 <span class="dropdown-text">Analysis of ESG factors in investment decisionmaking (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_2.html">
 <span class="dropdown-text">Estimating market capitalisation of companies using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_3.html">
 <span class="dropdown-text">House prices predictions using machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_5.html">
 <span class="dropdown-text">Images classifier using deep learning and machine learning models (2021)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projet_4.html">
 <span class="dropdown-text">Open food facts dataset: simple analysis (2021)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-work-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Work project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-work-project">    
        <li>
    <a class="dropdown-item" href="./w_projet_1.html">
 <span class="dropdown-text">Proposal for a Maturity Continuum Model for Open Research Data (2019)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./w_projet_2.html">
 <span class="dropdown-text">Performance analysis of marathon runners using Strava data (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-football-stories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Football stories</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-football-stories">    
        <li>
    <a class="dropdown-item" href="./premiere_league.html">
 <span class="dropdown-text">Premier league - Simply the best</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./manchester.html">
 <span class="dropdown-text">Manchester - Blue or Red? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./t_maps.html">
 <span class="dropdown-text">How to plot maps with R?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./t_animated.html">
 <span class="dropdown-text">How to animate your plots with R? (in progress)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/gr%C3%A9goire-urvoy-456347a8/"> <i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#images-classifier-using-deep-learning-and-machine-learning-models" id="toc-images-classifier-using-deep-learning-and-machine-learning-models" class="nav-link active" data-scroll-target="#images-classifier-using-deep-learning-and-machine-learning-models">Images classifier using deep learning and machine learning models</a></li>
  <li><a href="#feature-extraction" id="toc-feature-extraction" class="nav-link" data-scroll-target="#feature-extraction">1. Feature extraction</a></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">2. Data exploration</a></li>
  <li><a href="#visual-search-with-k-nn" id="toc-visual-search-with-k-nn" class="nav-link" data-scroll-target="#visual-search-with-k-nn">3. Visual search with k-NN</a></li>
  <li><a href="#simple-decision-trees" id="toc-simple-decision-trees" class="nav-link" data-scroll-target="#simple-decision-trees">4. Simple decision trees</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">5. Logistic regression</a></li>
  <li><a href="#nonlinear-classifiers" id="toc-nonlinear-classifiers" class="nav-link" data-scroll-target="#nonlinear-classifiers">6. Nonlinear classifiers</a></li>
  <li><a href="#dense-networks" id="toc-dense-networks" class="nav-link" data-scroll-target="#dense-networks">7. Dense networks</a></li>
  <li><a href="#convnets" id="toc-convnets" class="nav-link" data-scroll-target="#convnets">8. Convnets</a></li>
  <li><a href="#resultls" id="toc-resultls" class="nav-link" data-scroll-target="#resultls">9. Resultls</a></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="..\..\Documents\ML\Course_4\01_Feature_extraction-preview.html"><i class="bi bi-journal-code"></i>1. Feature extraction</a></li><li><a href="..\..\Documents\ML\Course_4\02_Data_exploration-preview.html"><i class="bi bi-journal-code"></i>2. Data exploration</a></li><li><a href="..\..\Documents\ML\Course_4\03 Visual search with k-NN-preview.html"><i class="bi bi-journal-code"></i>3. Visual search with k-NN</a></li><li><a href="..\..\Documents\ML\Course_4\04 Simple decision tree-preview.html"><i class="bi bi-journal-code"></i>4. Simple decision trees</a></li><li><a href="..\..\Documents\ML\Course_4\05 Logistic regression baseline-preview.html"><i class="bi bi-journal-code"></i>5. Logistic regression</a></li><li><a href="..\..\Documents\ML\Course_4\06 Nonlinear classifiers-preview.html"><i class="bi bi-journal-code"></i>6. Nonlinear classifiers</a></li><li><a href="..\..\Documents\ML\Course_4\07 Dense networks-preview.html"><i class="bi bi-journal-code"></i>7. Dense networks</a></li><li><a href="..\..\Documents\ML\Course_4\08 Convnets-preview.html"><i class="bi bi-journal-code"></i>8. Convnets</a></li><li><a href="..\..\Documents\ML\Course_4\09 Results-preview.html"><i class="bi bi-journal-code"></i>9. Resultls</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="images-classifier-using-deep-learning-and-machine-learning-models" class="level1">
<h1>Images classifier using deep learning and machine learning models</h1>
<p>The goal of this project was to build different images classifier. I worked with the Swissroads data set which contains thousands images of vehicles found including cars, trucks, vans, bikes, motorcycles and others.</p>
<p>The ultimate goal is to test different classifiers and techniques and choose the best method.</p>
</section>
<section id="feature-extraction" class="level1 quarto-embed-nb-cell">
<h1>1. Feature extraction</h1>
<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow_hub <span class="im">as</span> hub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I decide to use the MobileNet V2 module. As written in the course, “By default, TensorFlow Hub image modules work with float32 images normalized between zero and one. The expected input size is written on the MobileNet V2 module page. In this case, it’s 224x224.”</p>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>generator <span class="op">=</span> ImageDataGenerator(rescale<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">255</span>, validation_split<span class="op">=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>trainset <span class="op">=</span> generator.flow_from_directory(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    os.path.join(<span class="st">'swissroads'</span>, <span class="st">'train'</span>), batch_size<span class="op">=</span><span class="dv">32</span>, target_size<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>), class_mode<span class="op">=</span><span class="st">'sparse'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>validset <span class="op">=</span> generator.flow_from_directory(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    os.path.join(<span class="st">'swissroads'</span>, <span class="st">'valid'</span>), batch_size<span class="op">=</span><span class="dv">32</span>, target_size<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>), class_mode<span class="op">=</span><span class="st">'sparse'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>testset <span class="op">=</span> generator.flow_from_directory(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    os.path.join(<span class="st">'swissroads'</span>, <span class="st">'test'</span>), batch_size<span class="op">=</span><span class="dv">32</span>, target_size<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>), class_mode<span class="op">=</span><span class="st">'sparse'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 280 images belonging to 6 classes.
Found 139 images belonging to 6 classes.
Found 50 images belonging to 6 classes.</code></pre>
</div>
</div>
<p>Everything seems to work correctly. There are indeed 6 different classes.</p>
<p>I create a graph, with characteristics 224x224 pour the number of pixels in width and length and 3 for the RBF colors.</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>img_graph <span class="op">=</span> tf.Graph()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> img_graph.as_default():</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    module_url <span class="op">=</span> <span class="st">'https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/feature_vector/2'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    feature_extractor <span class="op">=</span> hub.Module(module_url)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    input_imgs <span class="op">=</span> tf.placeholder(dtype<span class="op">=</span>tf.float32, shape<span class="op">=</span>[<span class="va">None</span>, <span class="dv">224</span>, <span class="dv">224</span>, <span class="dv">3</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    imgs_features <span class="op">=</span> feature_extractor(input_imgs)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    init_op <span class="op">=</span> tf.group([</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        tf.global_variables_initializer(), tf.tables_initializer()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>img_graph.finalize() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>INFO:tensorflow:Saver not created because there are no variables in the graph to restore</code></pre>
</div>
</div>
<p>Now, we can save our model.</p>
<p>We can see the different classes of the set:</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>trainset.class_indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'bike': 0, 'car': 1, 'motorcycle': 2, 'other': 3, 'truck': 4, 'van': 5}</code></pre>
</div>
</div>
<p>We can see what is inside the trainset for example:</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(trainset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>9</code></pre>
</div>
</div>
<p>This correspond to the number of batch. We have 280 and a batch size of 32 so it we should have no more than 9 batch.</p>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(trainset[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>2</code></pre>
</div>
</div>
<p>In each batch we have two elements.</p>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(trainset[<span class="dv">7</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>32</code></pre>
</div>
</div>
<p>The first element of the list in the image (in pixels).</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>trainset[<span class="dv">0</span>][<span class="dv">1</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>1.0</code></pre>
</div>
</div>
<p>And the second element is the label. Since it as a 1 on the second element, this image should correspond to a car.</p>
<div id="cell-20" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train_image<span class="op">=</span> []</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>train_label<span class="op">=</span>[]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>train_feature<span class="op">=</span>[]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tf.Session(graph<span class="op">=</span>img_graph) <span class="im">as</span> sess:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    sess.run(init_op)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(trainset)):</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> trainset[i][<span class="dv">0</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> trainset[i][<span class="dv">1</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> sess.run(imgs_features, feed_dict<span class="op">=</span>{input_imgs: image})</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        train_image.append(image)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        train_feature.append(feature)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        train_label.append(label)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>train_feature <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> train_feature <span class="cf">for</span> val <span class="kw">in</span> sublist] <span class="co">#found on internet to flatten the list (https://www.quora.com/How-can-I-drop-brackets-in-a-Python-list-in-order-to-go-from-1-2-3-to-1-2-3#:~:text=Flatten%20the%20list%20to%20%22remove,in%20your%20list%20of%20lists!&amp;text=Nested%20list%20comprehensions%20evaluate%20in,tab%20for%20each%20new%20loop.)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>train_image <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> train_image <span class="cf">for</span> val <span class="kw">in</span> sublist]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>train_label <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> train_label <span class="cf">for</span> val <span class="kw">in</span> sublist]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can then store the informations in a npz file:</p>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>np.savez(<span class="st">'trainset.npz'</span>, train_image<span class="op">=</span>train_image ,train_feature<span class="op">=</span>train_feature, train_label<span class="op">=</span>[<span class="bu">int</span>(a) <span class="cf">for</span> a <span class="kw">in</span> train_label], train_name<span class="op">=</span><span class="bu">list</span>(trainset.class_indices.keys()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>valid_image<span class="op">=</span> []</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>valid_label<span class="op">=</span>[]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>valid_feature<span class="op">=</span>[]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tf.Session(graph<span class="op">=</span>img_graph) <span class="im">as</span> sess:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    sess.run(init_op)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(validset)):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> validset[i][<span class="dv">0</span>]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> validset[i][<span class="dv">1</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> sess.run(imgs_features, feed_dict<span class="op">=</span>{input_imgs: image})</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        valid_image.append(image)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        valid_feature.append(feature)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        valid_label.append(label)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>valid_feature <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> valid_feature <span class="cf">for</span> val <span class="kw">in</span> sublist]</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>valid_image <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> valid_image <span class="cf">for</span> val <span class="kw">in</span> sublist]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>valid_label <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> valid_label <span class="cf">for</span> val <span class="kw">in</span> sublist]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>np.savez(<span class="st">'validset.npz'</span>, valid_image<span class="op">=</span>valid_image ,valid_feature<span class="op">=</span>valid_feature, valid_label<span class="op">=</span>[<span class="bu">int</span>(a) <span class="cf">for</span> a <span class="kw">in</span> valid_label], valid_name<span class="op">=</span><span class="bu">list</span>(validset.class_indices.keys()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>test_image<span class="op">=</span> []</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>test_label<span class="op">=</span>[]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>test_feature<span class="op">=</span>[]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tf.Session(graph<span class="op">=</span>img_graph) <span class="im">as</span> sess:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    sess.run(init_op)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(testset)):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> testset[i][<span class="dv">0</span>]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> testset[i][<span class="dv">1</span>]</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> sess.run(imgs_features, feed_dict<span class="op">=</span>{input_imgs: image})</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        test_image.append(image)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        test_feature.append(feature)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        test_label.append(label)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>test_feature <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> test_feature <span class="cf">for</span> val <span class="kw">in</span> sublist] </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>test_image <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> test_image <span class="cf">for</span> val <span class="kw">in</span> sublist]</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>test_label <span class="op">=</span> [val <span class="cf">for</span> sublist <span class="kw">in</span> test_label <span class="cf">for</span> val <span class="kw">in</span> sublist]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.savez(<span class="st">'testset.npz'</span>, test_image<span class="op">=</span>test_image ,test_feature<span class="op">=</span>test_feature, test_label<span class="op">=</span>[<span class="bu">int</span>(a) <span class="cf">for</span> a <span class="kw">in</span> test_label], test_name<span class="op">=</span><span class="bu">list</span>(validset.class_indices.keys()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I also need to create the csv file to load my results at each step of the project.</p>
<div id="cell-29" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">'model'</span>,<span class="st">'test_accuracy'</span>]).set_index(<span class="st">'model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<a class="quarto-notebook-link" id="nblink-1" href="..\..\Documents\ML\Course_4\01_Feature_extraction-preview.html#cell-0">Source: 1. Feature extraction</a></section>
<section id="data-exploration" class="level1 quarto-embed-nb-cell">
<h1>2. Data exploration</h1>
<ul>
<li>Plot a few images from each category</li>
</ul>
<p>For this task, I plot two images for each of the 6 categories: bike, car, motorcycle, other, truck and van.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> PIL.Image <span class="im">as</span> Image</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>bike1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/bike/bike-0100.png'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>bike1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-2-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bike2 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/bike/bike-0101.png'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bike2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>car1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/car/car-0097.png'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>car1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>car2 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/car/car-0098.png'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>car2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>motorcycle1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/motorcycle/motorcycle-0077.png'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>motorcycle1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>motorcycle2 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/motorcycle/motorcycle-0078.png'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>motorcycle2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>other1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/other/other-0049.png'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>other1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>other2 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/other/other-0050.png'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>other2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>truck1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/truck/truck-0064.png'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>truck1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>truck2<span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/truck/truck-0065.png'</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>truck2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>van1 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/van/van-0038.png'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>van1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>van2 <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'swissroads/test/van/van-0039.png'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>van2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Make a scree plot, how many PCA components explain 10%, 20%, …, 90% and 100% of the variance?</li>
</ul>
<p>First, I load the different elements of the train set.</p>
<div id="cell-17" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then I apply the PCA transformer.</p>
<div id="cell-19" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>pca3 <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>pca3.fit(X)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>pve <span class="op">=</span> pca3.explained_variance_ratio_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And I compute the cumulative sum.</p>
<div id="cell-21" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>sumpve <span class="op">=</span> np.cumsum(pve)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sumpve</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([0.1344936 , 0.2087489 , 0.2799862 , 0.31217173, 0.33760956,
       0.3583333 , 0.377379  , 0.3941875 , 0.40971527, 0.4247254 ,
       0.43830603, 0.4505505 , 0.46202305, 0.4730017 , 0.48389196,
       0.4941155 , 0.50366163, 0.51275325, 0.5213581 , 0.5296294 ,
       0.53732485, 0.5449765 , 0.55249184, 0.5598207 , 0.5669916 ,
       0.5740723 , 0.580814  , 0.58740735, 0.59383476, 0.600106  ,
       0.6061526 , 0.6121337 , 0.61808836, 0.62399113, 0.62979263,
       0.6354872 , 0.6409344 , 0.64629495, 0.65137005, 0.6563524 ,
       0.6611421 , 0.665837  , 0.67046773, 0.6750259 , 0.67948896,
       0.68384   , 0.68816215, 0.69243425, 0.6966555 , 0.70074064,
       0.7048151 , 0.7088197 , 0.7126935 , 0.7165307 , 0.7203316 ,
       0.7240459 , 0.72764814, 0.73117197, 0.7346603 , 0.738116  ,
       0.7415551 , 0.7449048 , 0.74818265, 0.7514316 , 0.75464255,
       0.7578165 , 0.76097137, 0.7641028 , 0.7670954 , 0.770061  ,
       0.7730154 , 0.77593666, 0.7788439 , 0.78169763, 0.78454155,
       0.78733283, 0.79009765, 0.79281014, 0.7954061 , 0.7979701 ,
       0.8005114 , 0.8030465 , 0.805536  , 0.80797756, 0.8103965 ,
       0.8127681 , 0.81513125, 0.8174775 , 0.8197751 , 0.8220363 ,
       0.8242911 , 0.82650936, 0.8286814 , 0.8308453 , 0.83299565,
       0.835124  , 0.8372309 , 0.8393252 , 0.84137243, 0.84337884,
       0.8453535 , 0.84732413, 0.8492778 , 0.8512061 , 0.85310227,
       0.85497504, 0.85683876, 0.85869616, 0.8604995 , 0.8622945 ,
       0.8640699 , 0.86583835, 0.8675804 , 0.8693112 , 0.8710044 ,
       0.8726823 , 0.8743508 , 0.8759999 , 0.87763053, 0.87923443,
       0.8808169 , 0.882386  , 0.88394123, 0.8854769 , 0.8870015 ,
       0.8884885 , 0.8899591 , 0.8914156 , 0.8928605 , 0.89429235,
       0.89570874, 0.8971153 , 0.8985121 , 0.8999    , 0.9012585 ,
       0.90258634, 0.90389186, 0.9051934 , 0.9064794 , 0.90774477,
       0.9090051 , 0.9102497 , 0.911492  , 0.91272146, 0.9139403 ,
       0.91514087, 0.9163284 , 0.91749656, 0.9186646 , 0.91982037,
       0.92095804, 0.92208314, 0.92319673, 0.92429626, 0.9253844 ,
       0.92646194, 0.92752826, 0.9285914 , 0.92964846, 0.9306856 ,
       0.93171144, 0.93272966, 0.9337378 , 0.9347365 , 0.9357302 ,
       0.936715  , 0.9376876 , 0.9386499 , 0.9395963 , 0.9405348 ,
       0.94146496, 0.94238806, 0.9433005 , 0.94420344, 0.9451    ,
       0.94598716, 0.946868  , 0.9477421 , 0.94860727, 0.94945776,
       0.9502957 , 0.9511272 , 0.951952  , 0.95276606, 0.9535655 ,
       0.95436054, 0.9551487 , 0.9559321 , 0.95670617, 0.95747715,
       0.9582351 , 0.9589877 , 0.9597309 , 0.9604704 , 0.961201  ,
       0.96192163, 0.9626343 , 0.96333694, 0.9640375 , 0.9647304 ,
       0.9654158 , 0.96609175, 0.96676433, 0.96743315, 0.968094  ,
       0.9687449 , 0.96938056, 0.97001123, 0.9706379 , 0.97126275,
       0.97188425, 0.9724932 , 0.9730992 , 0.9736906 , 0.97427183,
       0.97484964, 0.9754159 , 0.97597986, 0.9765347 , 0.97708565,
       0.9776333 , 0.97817403, 0.97870815, 0.97923785, 0.979764  ,
       0.98028374, 0.98080057, 0.9813143 , 0.98181945, 0.982322  ,
       0.98280835, 0.9832896 , 0.98376817, 0.9842444 , 0.98471665,
       0.9851765 , 0.98563117, 0.9860849 , 0.9865305 , 0.98697007,
       0.9874059 , 0.9878333 , 0.9882546 , 0.9886743 , 0.98909026,
       0.98949885, 0.98989886, 0.99029535, 0.9906846 , 0.991068  ,
       0.9914451 , 0.99181914, 0.9921912 , 0.9925563 , 0.9929159 ,
       0.993274  , 0.99362445, 0.9939673 , 0.9943079 , 0.99464387,
       0.99497235, 0.9952983 , 0.99561816, 0.9959284 , 0.99623525,
       0.99654055, 0.9968375 , 0.99713254, 0.9974232 , 0.9977091 ,
       0.9979863 , 0.998261  , 0.9985314 , 0.99879605, 0.99905246,
       0.9992982 , 0.99954075, 0.9997777 , 1.0000001 , 1.0000001 ],
      dtype=float32)</code></pre>
</div>
</div>
<p>I compute how many principal components I need to explain 5%, 10%, 15%, 20%, etc. of variance.</p>
<div id="cell-23" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rank <span class="op">=</span> []</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.05</span>,<span class="dv">1</span>,<span class="fl">0.05</span>):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> sumpve[j] <span class="op">&lt;</span> i:</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> j</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    rank.append(j)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>rank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>[0, 0, 1, 1, 2, 3, 5, 8, 11, 16, 22, 29, 38, 49, 63, 80, 103, 134, 180]</code></pre>
</div>
</div>
<p>Therefore, we need: - 1 component to get 10% of the variance - 2 components to get 20% - 4 components to get 30% - 9 components to get 40% - 17 components to get 50% - 30 components to get 60% - 50 components to get 70% - 81 components to get 80% - 135 components to get 90%</p>
<p>We can verify that on the folowwing scree plot:</p>
<div id="cell-25" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>xcor <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">250</span>,<span class="dv">10</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plt.plot(xcor, pve[xcor])</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(xcor)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>pve_cumsum <span class="op">=</span> np.cumsum(pve)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>plt.step(</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    xcor<span class="op">+</span><span class="fl">0.5</span>, </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    sumpve[xcor], </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'cumulative'</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    ,color<span class="op">=</span><span class="st">'red'</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'principal component'</span>)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'proportion of variance explained'</span>)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Visualize the features on a 2d-plot with PCA using the first two components. What can you say about the results?</li>
</ul>
<p>I apply the transformer with only 2 components this time.</p>
<div id="cell-28" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pca2 <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>X_2d <span class="op">=</span> pca2.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And I plot the two components and use a different color for each of the 6 categories in order to see if we can already distinguish clusters.</p>
<div id="cell-30" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> kind <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]:</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> (Y <span class="op">==</span> kind)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        X_2d[idx, <span class="dv">0</span>], X_2d[idx, <span class="dv">1</span>],</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span> names[kind]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'1st component'</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'2nd component'</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can already see some clear clusters with only the fist two components, like the bike and motorcycle clusters.</p>
<a class="quarto-notebook-link" id="nblink-2" href="..\..\Documents\ML\Course_4\02_Data_exploration-preview.html#cell-0">Source: 2. Data exploration</a></section>
<section id="visual-search-with-k-nn" class="level1 quarto-embed-nb-cell">
<h1>3. Visual search with k-NN</h1>
<ul>
<li>Fit and tune a k-NN classifier</li>
</ul>
<p>Again, I load the train set, validation set and test set.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I fit the KNClassifier. I test for n=5.</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'knn'</span>, KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>knn_pipe.fit(X_tr, Y_tr)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> knn_pipe.score(X_val, Y_val)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.892</code></pre>
</div>
</div>
<p>I generate the different k values in order to tune the model.</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>k_values <span class="op">=</span> np.r_[<span class="dv">1</span>, np.arange(<span class="dv">5</span>, <span class="dv">101</span>, step<span class="op">=</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply the grid search to find the optimal k.</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>gs_results <span class="op">=</span> []</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_values:</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    knn_pipe.set_params(knn__n_neighbors<span class="op">=</span>k)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    knn_pipe.fit(X_tr, Y_tr)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    gs_results.append({</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'k'</span>: k,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'train_accuracy'</span>: knn_pipe.score(X_tr, Y_tr),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'valid_accuracy'</span>: knn_pipe.score(X_val, Y_val)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>gs_results <span class="op">=</span> pd.DataFrame(gs_results)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>gs_results.sort_values(by<span class="op">=</span><span class="st">'valid_accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">k</th>
<th data-quarto-table-cell-role="th">train_accuracy</th>
<th data-quarto-table-cell-role="th">valid_accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>0.892857</td>
<td>0.899281</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>1.000000</td>
<td>0.892086</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>7</td>
<td>0.907143</td>
<td>0.892086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>8</td>
<td>0.889286</td>
<td>0.892086</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>9</td>
<td>0.900000</td>
<td>0.892086</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The best valid accuracy is obtain with k=6. I plot the curves.</p>
<div id="cell-11" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.plot(gs_results[<span class="st">'k'</span>], gs_results[<span class="st">'train_accuracy'</span>], label<span class="op">=</span><span class="st">'train curve'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.plot(gs_results[<span class="st">'k'</span>], gs_results[<span class="st">'valid_accuracy'</span>], label<span class="op">=</span><span class="st">'valid curve'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k'</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I can compute the associated test score:</p>
<div id="cell-13" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'knn'</span>, KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">6</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>knn_pipe.fit(X_tr, Y_tr)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> knn_pipe.score(X_te, Y_te)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.960</code></pre>
</div>
</div>
<p>We can also tune our model with the other parameters such as the weights functions and the distance type. To do that, we need to apply the grid search method for multiple parameters.</p>
<div id="cell-15" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>k_values <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">21</span>) </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>weights_functions <span class="op">=</span> [<span class="st">'uniform'</span>, <span class="st">'distance'</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>distance_types <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'knn'</span>, KNeighborsClassifier())</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>validation_scores <span class="op">=</span> []</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_values:</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> weights_functions:</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> distance_types:</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            pipe.set_params(knn__n_neighbors<span class="op">=</span>k, knn__weights<span class="op">=</span>f, knn__p<span class="op">=</span>d)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            pipe.fit(X_tr, Y_tr)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>            val_accuracy <span class="op">=</span> pipe.score(X_val, Y_val)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            test_accuracy <span class="op">=</span> pipe.score(X_te, Y_te)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>            validation_scores.append({</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'knn__n_neighbors'</span>: k,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'knn__weights'</span>: f,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'knn__p'</span>: d,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'valid_accuracy'</span>: val_accuracy,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">'test_accuracy'</span>: test_accuracy</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>scores_df <span class="op">=</span> pd.DataFrame(validation_scores)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>scores_df.sort_values(by<span class="op">=</span><span class="st">'valid_accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">knn__n_neighbors</th>
<th data-quarto-table-cell-role="th">knn__p</th>
<th data-quarto-table-cell-role="th">knn__weights</th>
<th data-quarto-table-cell-role="th">test_accuracy</th>
<th data-quarto-table-cell-role="th">valid_accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>6</td>
<td>1</td>
<td>uniform</td>
<td>0.98</td>
<td>0.920863</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>8</td>
<td>1</td>
<td>uniform</td>
<td>0.96</td>
<td>0.899281</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>6</td>
<td>2</td>
<td>uniform</td>
<td>0.96</td>
<td>0.899281</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>2</td>
<td>uniform</td>
<td>0.94</td>
<td>0.899281</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>5</td>
<td>1</td>
<td>uniform</td>
<td>0.96</td>
<td>0.899281</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'k-NN'</span>,<span class="st">'test_accuracy'</span>:scores_df.sort_values(by<span class="op">=</span><span class="st">'valid_accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'test_accuracy'</span>][<span class="dv">20</span>]}</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The best model is obtained with k=6, the uniform weight function and the first distance type. I can compute the associated test score:</p>
<div id="cell-22" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>k<span class="op">=</span><span class="dv">6</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>weights_functions <span class="op">=</span> <span class="st">'uniform'</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>distance_types <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>pipe.set_params(knn__n_neighbors<span class="op">=</span>k, knn__weights<span class="op">=</span>weights_functions, knn__p<span class="op">=</span>distance_types)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>test_score <span class="op">=</span> pipe.score(X_te, Y_te)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test score:'</span>,test_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test score: 0.96</code></pre>
</div>
</div>
<ul>
<li>Pick an image from the test set and plot its 10 nearest neighbors from the train set. Hint: take a look at the kneighbors() method from Scikit-learn k-NN estimators.</li>
</ul>
<p>I create the knn using 6 neighbors and a distance type of 1 since it gave me the best results (as we can see above).</p>
<div id="cell-25" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> NearestNeighbors</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">6</span>,p<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>knn.fit(X_te)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>ten_kneighbors <span class="op">=</span> knn.kneighbors(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>),n_neighbors<span class="op">=</span><span class="dv">10</span> ,return_distance<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>ten_kneighbors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([[ 0,  4, 10,  7,  2,  1,  9,  6, 11,  8]])</code></pre>
</div>
</div>
<p>I plot the images of the 10 nearest neighbors.</p>
<div id="cell-28" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,ten_kneighbors.shape[<span class="dv">1</span>]):</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    plt.imshow(images_te[ten_kneighbors[<span class="dv">0</span>,i]])</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-17-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As expected, we can see that all the nearest neighbors are also bycicles (since the first image was also a bike).</p>
<a class="quarto-notebook-link" id="nblink-3" href="..\..\Documents\ML\Course_4\03 Visual search with k-NN-preview.html#cell-0">Source: 3. Visual search with k-NN</a></section>
<section id="simple-decision-trees" class="level1 quarto-embed-nb-cell">
<h1>4. Simple decision trees</h1>
<ul>
<li>What accuracy can you achieve with a depth of 3?</li>
</ul>
<p>I first load the sets.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I create the tree.</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    criterion<span class="op">=</span><span class="st">'gini'</span>, max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I fit the tree with the train set and get the score of the test set.</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dt.fit(X_tr, Y_tr)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>dt.score(X_te,Y_te)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>0.66</code></pre>
</div>
</div>
<ul>
<li>Plot the corresponding tree with graphviz</li>
</ul>
<p>I create the tree with the data from above.</p>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> export_graphviz</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>dot_data <span class="op">=</span> export_graphviz(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    dt, out_file<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    class_names<span class="op">=</span>names_te,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    filled<span class="op">=</span><span class="va">True</span>, rounded<span class="op">=</span><span class="va">True</span>, proportion<span class="op">=</span><span class="va">True</span>   </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I plot the tree.</p>
<div id="cell-12" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> graphviz</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>graphviz.Source(dot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-6-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Do you get better results if you reduce the number of dimensions with PCA first?</li>
</ul>
<p>I use the same code as the second task of the project.</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>X_2d_tr <span class="op">=</span> pca.fit_transform(X_tr)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>X_2d_te <span class="op">=</span> pca.transform(X_te)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify the shapes of the data.</p>
<div id="cell-17" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_2d_tr.shape)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_tr.shape)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_2d_te.shape)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_te.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(280, 2)
(280,)
(50, 2)
(50,)</code></pre>
</div>
</div>
<p>We recreate the same decision tree to avoid clutter.</p>
<div id="cell-19" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> DecisionTreeClassifier(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    criterion<span class="op">=</span><span class="st">'gini'</span>, max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit the tree with the training set and get the score with the test set.</p>
<div id="cell-21" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dt.fit(X_2d_tr, Y_tr)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>dt.score(X_2d_te,Y_te)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.74</code></pre>
</div>
</div>
<p>Indeed, we obtain a better score with the PCA (0.74&gt;0.66).</p>
<p>I upload the results in the csv file.</p>
<div id="cell-24" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'decision tree'</span>,<span class="st">'test_accuracy'</span>:dt.score(X_2d_te,Y_te)}</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could try to see what is the best PCA number.</p>
<div id="cell-29" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> pd.DataFrame(np.zeros((<span class="dv">10</span>, <span class="dv">2</span>)),columns<span class="op">=</span>[<span class="st">'n'</span>,<span class="st">'Test_Score'</span>])</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">11</span>):</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA(n_components<span class="op">=</span>i)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    X_2d_tr <span class="op">=</span> pca.fit_transform(X_tr)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    X_2d_te <span class="op">=</span> pca.transform(X_te)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    dt.fit(X_2d_tr, Y_tr)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    dt.score(X_2d_te,Y_te)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    scores.n[i]<span class="op">=</span>i</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    scores.Test_Score[i]<span class="op">=</span>dt.score(X_2d_te,Y_te)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> scores.iloc[<span class="dv">2</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>scores.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">Test_Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.0</td>
<td>0.74</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3.0</td>
<td>0.74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>0.74</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>5.0</td>
<td>0.74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>6.0</td>
<td>0.74</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The best score is obtained when n&gt;2.</p>
<a class="quarto-notebook-link" id="nblink-4" href="..\..\Documents\ML\Course_4\04 Simple decision tree-preview.html#cell-0">Source: 4. Simple decision trees</a></section>
<section id="logistic-regression" class="level1 quarto-embed-nb-cell">
<h1>5. Logistic regression</h1>
<ul>
<li>Evaluate a logistic regression model (without any hyperparameters tuning)</li>
</ul>
<p>I first load the data sets.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I apply the softmax regression method.</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.exceptions <span class="im">import</span> ConvergenceWarning</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(<span class="st">'ignore'</span>, ConvergenceWarning)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> make_pipeline( LogisticRegression(multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>logreg.fit(X_tr, Y_tr)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> logreg.score(X_val, Y_val)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Validation accuracy: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(accuracy))</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> logreg.score(X_te, Y_te)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test accuracy: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Validation accuracy: 0.914
Test accuracy: 0.940</code></pre>
</div>
</div>
<ul>
<li>Tune its regularization strength parameter with cross-validated grid-search and compare the accuracy to the untuned one</li>
</ul>
<p>The cross-validated grid-search function that we have seen during the course (cross_validate()) takes the dataset and splits automatically into a train and a validation set. However, the validation set is already given separately for this project. Therefore I decide to merge the our train and validation set and use this as my basic dataset. Since the validation set is random data from the whole set, it should not be a problem to do that.</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_tr.shape)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val.shape)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_tr.shape)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_val.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(280, 1280)
(139, 1280)
(280,)
(139,)</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.concatenate((X_tr,X_val),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.concatenate((Y_tr,Y_val),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.shape)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(419, 1280)
(419,)</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>logreg_estimator <span class="op">=</span> Pipeline([</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'logreg'</span>, LogisticRegression())</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>Cs <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>, num<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>grids <span class="op">=</span> [{</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__multi_class'</span>: [<span class="st">'ovr'</span>],</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__solver'</span>: [<span class="st">'liblinear'</span>],</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__C'</span>: Cs</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>}, {</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__multi_class'</span>: [<span class="st">'multinomial'</span>],</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__solver'</span>: [<span class="st">'saga'</span>],</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'logreg__C'</span>: Cs</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>logreg_gscv <span class="op">=</span> GridSearchCV(logreg_estimator, grids, cv<span class="op">=</span><span class="dv">5</span>, refit<span class="op">=</span><span class="va">True</span>, return_train_score<span class="op">=</span><span class="va">True</span>,verbose<span class="op">=</span><span class="dv">1</span>,n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>logreg_gscv.fit(X, Y)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>logreg_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'strategy'</span>: logreg_gscv.cv_results_[<span class="st">'param_logreg__multi_class'</span>],</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: logreg_gscv.cv_results_[<span class="st">'param_logreg__C'</span>],</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_tr'</span>: logreg_gscv.cv_results_[<span class="st">'mean_train_score'</span>],</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_te'</span>: logreg_gscv.cv_results_[<span class="st">'mean_test_score'</span>],</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'std_te'</span>: logreg_gscv.cv_results_[<span class="st">'std_test_score'</span>]</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>logreg_results.sort_values(by<span class="op">=</span><span class="st">'mean_te'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 40 candidates, totalling 200 fits</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">strategy</th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">mean_tr</th>
<th data-quarto-table-cell-role="th">mean_te</th>
<th data-quarto-table-cell-role="th">std_te</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>multinomial</td>
<td>61.5848</td>
<td>1.0</td>
<td>0.914081</td>
<td>0.017486</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>multinomial</td>
<td>4281.33</td>
<td>1.0</td>
<td>0.914081</td>
<td>0.014418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>multinomial</td>
<td>1832.98</td>
<td>1.0</td>
<td>0.911695</td>
<td>0.015967</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>multinomial</td>
<td>4.83293</td>
<td>1.0</td>
<td>0.911695</td>
<td>0.015761</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>multinomial</td>
<td>335.982</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.012290</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>multinomial</td>
<td>143.845</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.012290</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>multinomial</td>
<td>26.3665</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.019254</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>multinomial</td>
<td>11.2884</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.012439</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>multinomial</td>
<td>2.06914</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.015569</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>multinomial</td>
<td>0.0695193</td>
<td>1.0</td>
<td>0.909308</td>
<td>0.016423</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> make_pipeline( LogisticRegression(multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>,C<span class="op">=</span><span class="fl">0.0297635</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>logreg.fit(X, Y)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> logreg.score(X_te, Y_te)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Accuracy: </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.920</code></pre>
</div>
</div>
<p>Regularization does not seem to enhance the accuracy of the model.</p>
<div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'logistic'</span>,<span class="st">'test_accuracy'</span>:logreg.score(X_te, Y_te)}</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>tableau <span class="op">=</span> logreg_results.sort_values(by<span class="op">=</span><span class="st">'C'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>plt.semilogx(tableau[tableau[<span class="st">'strategy'</span>]<span class="op">==</span> <span class="st">'ovr'</span>].sort_values(by<span class="op">=</span><span class="st">'C'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'C'</span>], tableau[tableau[<span class="st">'strategy'</span>]<span class="op">==</span> <span class="st">'ovr'</span>].sort_values(by<span class="op">=</span><span class="st">'C'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'mean_te'</span>])</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I plot with the other strategy.</p>
<div id="cell-20" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>plt.semilogx(tableau[tableau[<span class="st">'strategy'</span>]<span class="op">==</span> <span class="st">'multinomial'</span>].sort_values(by<span class="op">=</span><span class="st">'C'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'C'</span>], tableau[tableau[<span class="st">'strategy'</span>]<span class="op">==</span> <span class="st">'multinomial'</span>].sort_values(by<span class="op">=</span><span class="st">'C'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'mean_te'</span>])</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Pick ten images and compute the probability for each class using the predict_proba() function of your estimator. Plot the results for each image and comment your findings. For example, you can plot the ten images in subplots and collect the probabilities in a DataFrame.</li>
</ul>
<p>I select 10 random images from the test set and compute the associated probabilities with my best estimator.</p>
<div id="cell-23" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> randrange</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> seed</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">0</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>i<span class="op">=</span><span class="dv">0</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">10</span>):</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    a<span class="op">=</span>randrange(<span class="dv">0</span>,<span class="bu">len</span>(X_te))</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    plt.imshow(images_te[a])</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(names_te)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(logreg.predict_proba(X_te[a].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>)))</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    i<span class="op">=</span><span class="dv">1</span><span class="op">+</span>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[1.67733772e-03 1.31682584e-03 9.84926992e-01 9.41871430e-03
  2.02255744e-03 6.37572917e-04]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[0.00848476 0.0425322  0.00605633 0.23887549 0.08617596 0.61787526]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[1.52949697e-02 4.86864710e-03 9.63393794e-01 8.74335736e-03
  6.78372346e-03 9.15508023e-04]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[9.97388287e-01 2.94495481e-04 1.34330750e-03 7.41756132e-04
  1.00760168e-04 1.31393680e-04]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[1.01474072e-03 9.88172314e-01 8.63270453e-04 1.23008703e-03
  1.37771077e-03 7.34187679e-03]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[0.00648867 0.00426102 0.00696245 0.94648625 0.03263764 0.00316397]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[1.90600581e-03 1.78061064e-03 9.90901807e-01 3.62147450e-03
  1.20981638e-03 5.80285434e-04]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[0.00873421 0.02237223 0.86490402 0.0933992  0.00926808 0.00132226]]
['bike' 'car' 'motorcycle' 'other' 'truck' 'van']
[[7.01139866e-04 9.91077878e-01 7.74640152e-04 1.09207282e-03
  5.86732763e-04 5.76753684e-03]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-15-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, the model always find the good image (in terms of biggest probability).</p>
<ul>
<li>Finally, vary the regularization strength of your estimator. What is the effect on the probabilities? Write your observations in a markdown cell.</li>
</ul>
<p>I take one image from each category and vary the regularization term C to see the effect on the probabilities.</p>
<div id="cell-27" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>col_names <span class="op">=</span> [<span class="st">'C'</span>,<span class="st">'bike'</span>, <span class="st">'car'</span>, <span class="st">'motorcycle'</span>, <span class="st">'other'</span>, <span class="st">'truck'</span>, <span class="st">'van'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-28" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>range_C <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="bike" class="level4">
<h4 class="anchored" data-anchor-id="bike">Bike</h4>
<div id="cell-30" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>bike_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>bike_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">0</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline( LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    bike_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">0</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>bike_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.16671</td>
<td>0.166696</td>
<td>0.166673</td>
<td>0.166641</td>
<td>0.166654</td>
<td>0.166626</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.173206</td>
<td>0.172175</td>
<td>0.167969</td>
<td>0.161903</td>
<td>0.165045</td>
<td>0.159703</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.228178</td>
<td>0.212173</td>
<td>0.175621</td>
<td>0.125435</td>
<td>0.149497</td>
<td>0.109096</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.364277</td>
<td>0.168192</td>
<td>0.161751</td>
<td>0.102864</td>
<td>0.123202</td>
<td>0.0797131</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.857242</td>
<td>0.0251372</td>
<td>0.0371105</td>
<td>0.0373727</td>
<td>0.0229972</td>
<td>0.0201403</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.991742</td>
<td>0.00124352</td>
<td>0.00173849</td>
<td>0.00343773</td>
<td>0.000949455</td>
<td>0.000889036</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>0.999745</td>
<td>1.57503e-05</td>
<td>4.38189e-05</td>
<td>0.000172652</td>
<td>1.23125e-05</td>
<td>1.06864e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>0.999904</td>
<td>6.77624e-06</td>
<td>1.59024e-05</td>
<td>6.75801e-05</td>
<td>2.50978e-06</td>
<td>2.93493e-06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>0.999959</td>
<td>1.28155e-06</td>
<td>6.5071e-06</td>
<td>3.11746e-05</td>
<td>1.11263e-06</td>
<td>1.05689e-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>0.999894</td>
<td>6.25005e-06</td>
<td>1.40269e-05</td>
<td>7.96064e-05</td>
<td>3.13887e-06</td>
<td>3.23863e-06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="car" class="level4">
<h4 class="anchored" data-anchor-id="car">Car</h4>
<div id="cell-35" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>car_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>car_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-37" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">13</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline(LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    car_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">13</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>car_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.166687</td>
<td>0.1667</td>
<td>0.166671</td>
<td>0.166645</td>
<td>0.166658</td>
<td>0.166638</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.172878</td>
<td>0.172528</td>
<td>0.167943</td>
<td>0.161914</td>
<td>0.16502</td>
<td>0.159716</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.218768</td>
<td>0.221134</td>
<td>0.174619</td>
<td>0.125522</td>
<td>0.150345</td>
<td>0.109612</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.172705</td>
<td>0.348096</td>
<td>0.151556</td>
<td>0.105887</td>
<td>0.130944</td>
<td>0.0908117</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.0179324</td>
<td>0.887413</td>
<td>0.0205776</td>
<td>0.0245222</td>
<td>0.0187384</td>
<td>0.0308163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.000563818</td>
<td>0.995474</td>
<td>0.000656942</td>
<td>0.000755771</td>
<td>0.000515995</td>
<td>0.00203337</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>1.07619e-05</td>
<td>0.999865</td>
<td>9.81102e-06</td>
<td>1.25539e-05</td>
<td>7.19507e-06</td>
<td>9.44414e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>2.19065e-06</td>
<td>0.999953</td>
<td>2.87351e-06</td>
<td>3.45583e-06</td>
<td>2.1278e-06</td>
<td>3.68259e-05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>4.39436e-06</td>
<td>0.999927</td>
<td>3.90908e-06</td>
<td>5.43666e-06</td>
<td>2.54504e-06</td>
<td>5.69631e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>3.06237e-06</td>
<td>0.999949</td>
<td>4.51504e-06</td>
<td>3.74466e-06</td>
<td>2.29489e-06</td>
<td>3.73611e-05</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="motorcycle" class="level4">
<h4 class="anchored" data-anchor-id="motorcycle">Motorcycle</h4>
<div id="cell-40" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>motorcycle_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>motorcycle_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">26</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline( LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    motorcycle_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">26</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>motorcycle_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.166692</td>
<td>0.166692</td>
<td>0.16668</td>
<td>0.166646</td>
<td>0.166658</td>
<td>0.166632</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.172987</td>
<td>0.172233</td>
<td>0.168144</td>
<td>0.16189</td>
<td>0.165048</td>
<td>0.159698</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.222368</td>
<td>0.213497</td>
<td>0.178799</td>
<td>0.125745</td>
<td>0.150598</td>
<td>0.108993</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.233316</td>
<td>0.189038</td>
<td>0.245599</td>
<td>0.112467</td>
<td>0.136367</td>
<td>0.083213</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.106879</td>
<td>0.0509277</td>
<td>0.697114</td>
<td>0.0673747</td>
<td>0.0530585</td>
<td>0.0246463</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.0131358</td>
<td>0.00412597</td>
<td>0.96856</td>
<td>0.00624701</td>
<td>0.00707047</td>
<td>0.000860373</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>0.00108783</td>
<td>0.000183078</td>
<td>0.997918</td>
<td>0.000314871</td>
<td>0.000485094</td>
<td>1.074e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>0.000615538</td>
<td>5.65981e-05</td>
<td>0.998906</td>
<td>0.000159</td>
<td>0.000259885</td>
<td>2.72862e-06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>0.000515385</td>
<td>7.49919e-05</td>
<td>0.998964</td>
<td>0.000174475</td>
<td>0.000268118</td>
<td>3.39689e-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>0.000619043</td>
<td>6.61948e-05</td>
<td>0.998876</td>
<td>0.000164927</td>
<td>0.000270052</td>
<td>4.11387e-06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="other" class="level4">
<h4 class="anchored" data-anchor-id="other">Other</h4>
<div id="cell-45" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>other_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-46" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>other_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">33</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline( LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>    other_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">33</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>other_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.166693</td>
<td>0.16669</td>
<td>0.166673</td>
<td>0.166647</td>
<td>0.166661</td>
<td>0.166636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.172891</td>
<td>0.172302</td>
<td>0.168024</td>
<td>0.161979</td>
<td>0.165082</td>
<td>0.159722</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.22049</td>
<td>0.214569</td>
<td>0.177028</td>
<td>0.126408</td>
<td>0.15203</td>
<td>0.109475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.205163</td>
<td>0.205092</td>
<td>0.196376</td>
<td>0.133721</td>
<td>0.167385</td>
<td>0.0922635</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.0795713</td>
<td>0.0746339</td>
<td>0.173708</td>
<td>0.385638</td>
<td>0.229876</td>
<td>0.0565718</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.0187512</td>
<td>0.0109184</td>
<td>0.0710302</td>
<td>0.672542</td>
<td>0.218377</td>
<td>0.00838142</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>0.00485905</td>
<td>0.00131337</td>
<td>0.0266977</td>
<td>0.836323</td>
<td>0.129995</td>
<td>0.000811631</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>0.00195899</td>
<td>0.000392279</td>
<td>0.0188389</td>
<td>0.867008</td>
<td>0.111527</td>
<td>0.000274337</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>0.00265511</td>
<td>0.000503708</td>
<td>0.0206401</td>
<td>0.874637</td>
<td>0.101173</td>
<td>0.000391244</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>0.0022698</td>
<td>0.000551082</td>
<td>0.0158346</td>
<td>0.835776</td>
<td>0.145239</td>
<td>0.000329257</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="truck" class="level4">
<h4 class="anchored" data-anchor-id="truck">Truck</h4>
<div id="cell-50" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>truck_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>truck_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-52" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">43</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline(LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    truck_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">43</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>truck_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.166694</td>
<td>0.166696</td>
<td>0.166672</td>
<td>0.166645</td>
<td>0.166663</td>
<td>0.16663</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.172938</td>
<td>0.172331</td>
<td>0.167922</td>
<td>0.161964</td>
<td>0.165103</td>
<td>0.159743</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.219933</td>
<td>0.214907</td>
<td>0.175328</td>
<td>0.126725</td>
<td>0.153051</td>
<td>0.110056</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.200652</td>
<td>0.211369</td>
<td>0.168458</td>
<td>0.132846</td>
<td>0.189481</td>
<td>0.0971939</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.056008</td>
<td>0.0745657</td>
<td>0.0542732</td>
<td>0.258366</td>
<td>0.4876</td>
<td>0.0691864</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.00534244</td>
<td>0.0102937</td>
<td>0.0041802</td>
<td>0.134445</td>
<td>0.840167</td>
<td>0.00557214</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>0.000378198</td>
<td>0.000757682</td>
<td>0.000197872</td>
<td>0.0389118</td>
<td>0.959517</td>
<td>0.000237887</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>0.000166384</td>
<td>0.000405344</td>
<td>9.6242e-05</td>
<td>0.0312516</td>
<td>0.967962</td>
<td>0.000118601</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>0.000132615</td>
<td>0.000279562</td>
<td>5.80725e-05</td>
<td>0.0268658</td>
<td>0.972578</td>
<td>8.63034e-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>0.000108849</td>
<td>0.000240686</td>
<td>5.1481e-05</td>
<td>0.0228083</td>
<td>0.976721</td>
<td>6.97044e-05</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="van" class="level4">
<h4 class="anchored" data-anchor-id="van">Van</h4>
<div id="cell-55" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>van_table <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-56" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>van_table[<span class="st">'C'</span>] <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>,<span class="dv">4</span>,num<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(images_te[<span class="dv">49</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(range_C)) :</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    logreg <span class="op">=</span> make_pipeline(LogisticRegression(C<span class="op">=</span>range_C[j], multi_class<span class="op">=</span><span class="st">'multinomial'</span>, solver<span class="op">=</span><span class="st">'saga'</span>))</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    logreg.fit(X_tr, Y_tr)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'bike'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'car'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'motorcycle'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'other'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">3</span>]</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'truck'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">4</span>]</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>    van_table.loc[j,<span class="st">'van'</span>] <span class="op">=</span> logreg.predict_proba(X_te[<span class="dv">49</span>].reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>][<span class="dv">5</span>]</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>van_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C</th>
<th data-quarto-table-cell-role="th">bike</th>
<th data-quarto-table-cell-role="th">car</th>
<th data-quarto-table-cell-role="th">motorcycle</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">truck</th>
<th data-quarto-table-cell-role="th">van</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000e-08</td>
<td>0.166689</td>
<td>0.166687</td>
<td>0.166669</td>
<td>0.166646</td>
<td>0.166665</td>
<td>0.166643</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.154435e-07</td>
<td>0.172933</td>
<td>0.172294</td>
<td>0.167892</td>
<td>0.161917</td>
<td>0.165156</td>
<td>0.159808</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.641589e-06</td>
<td>0.219668</td>
<td>0.215655</td>
<td>0.175138</td>
<td>0.126351</td>
<td>0.152427</td>
<td>0.110762</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.000000e-04</td>
<td>0.197421</td>
<td>0.22334</td>
<td>0.162916</td>
<td>0.120849</td>
<td>0.181751</td>
<td>0.113723</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2.154435e-03</td>
<td>0.0603387</td>
<td>0.0891248</td>
<td>0.054002</td>
<td>0.103107</td>
<td>0.265111</td>
<td>0.428316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>4.641589e-02</td>
<td>0.00871392</td>
<td>0.0115041</td>
<td>0.00540101</td>
<td>0.023631</td>
<td>0.104446</td>
<td>0.846304</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.000000e+00</td>
<td>0.000890357</td>
<td>0.00103803</td>
<td>0.000308159</td>
<td>0.003582</td>
<td>0.027256</td>
<td>0.966925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2.154435e+01</td>
<td>0.00056502</td>
<td>0.000575758</td>
<td>8.43756e-05</td>
<td>0.00218135</td>
<td>0.0210307</td>
<td>0.975563</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.641589e+02</td>
<td>0.000535682</td>
<td>0.000454719</td>
<td>0.000156076</td>
<td>0.00228876</td>
<td>0.0219212</td>
<td>0.974644</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1.000000e+04</td>
<td>0.000320905</td>
<td>0.000460301</td>
<td>9.14838e-05</td>
<td>0.00193528</td>
<td>0.0160996</td>
<td>0.981092</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that when C is very low (i.e.&nbsp;strong regularization), the probabilities tend to 0.166 (or 1/6), that is uniform distribution. The model becomes useless. However, when we increase C, the model predicts better the different categories.</p>
</section>
<a class="quarto-notebook-link" id="nblink-5" href="..\..\Documents\ML\Course_4\05 Logistic regression baseline-preview.html#cell-0">Source: 5. Logistic regression</a></section>
<section id="nonlinear-classifiers" class="level1 quarto-embed-nb-cell">
<h1>6. Nonlinear classifiers</h1>
<ul>
<li>Try with a random Forest, does increasing the number of trees help?</li>
</ul>
<p>First, I load the data sets.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I create deep decision trees and vary the number of trees.</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>dt_max_depth <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">1</span>, max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>dt_max_depth.fit(X_tr, Y_tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>RandomForestClassifier(bootstrap=True, class_weight=None, criterion='gini',
            max_depth=None, max_features='auto', max_leaf_nodes=None,
            min_impurity_decrease=0.0, min_impurity_split=None,
            min_samples_leaf=1, min_samples_split=2,
            min_weight_fraction_leaf=0.0, n_estimators=1, n_jobs=None,
            oob_score=False, random_state=0, verbose=0, warm_start=False)</code></pre>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>rf_100 <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>, max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>rf_100.fit(X_tr, Y_tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>RandomForestClassifier(bootstrap=True, class_weight=None, criterion='gini',
            max_depth=None, max_features='auto', max_leaf_nodes=None,
            min_impurity_decrease=0.0, min_impurity_split=None,
            min_samples_leaf=1, min_samples_split=2,
            min_weight_fraction_leaf=0.0, n_estimators=100, n_jobs=None,
            oob_score=False, random_state=0, verbose=0, warm_start=False)</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>rf_1000 <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">1000</span>, max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>rf_1000.fit(X_tr, Y_tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>RandomForestClassifier(bootstrap=True, class_weight=None, criterion='gini',
            max_depth=None, max_features='auto', max_leaf_nodes=None,
            min_impurity_decrease=0.0, min_impurity_split=None,
            min_samples_leaf=1, min_samples_split=2,
            min_weight_fraction_leaf=0.0, n_estimators=1000, n_jobs=None,
            oob_score=False, random_state=0, verbose=0, warm_start=False)</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_validate</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>dt_scores <span class="op">=</span> cross_validate(dt_max_depth, X_tr, Y_tr, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Decision tree - mean test </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    np.mean(dt_scores[<span class="st">'test_score'</span>])))</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>rf_scores <span class="op">=</span> cross_validate(rf_100, X_tr, Y_tr, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Random forest - mean test </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    np.mean(rf_scores[<span class="st">'test_score'</span>])))</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>rf_scores <span class="op">=</span> cross_validate(rf_1000, X_tr, Y_tr, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Large Random forest - mean test </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    np.mean(rf_scores[<span class="st">'test_score'</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Decision tree - mean test 0.563
Random forest - mean test 0.861
Large Random forest - mean test 0.900</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'random forest'</span>,<span class="st">'test_accuracy'</span>:<span class="bu">round</span>(np.mean(rf_scores[<span class="st">'test_score'</span>]),<span class="dv">2</span>)}</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>range_i <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>]</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>scores_valid <span class="op">=</span> []</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>scores_test <span class="op">=</span> []</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> range_i:</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    rfc <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span>i, max_depth<span class="op">=</span><span class="va">None</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>    rfc.fit(X_tr,Y_tr)</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    scores_valid.append(rfc.score(X_val,Y_val))</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    scores_test.append(rfc.score(X_te,Y_te))</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>plt.plot(range_i, scores_test, label<span class="op">=</span><span class="st">'Test score'</span>)</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>plt.plot(range_i, scores_valid, label<span class="op">=</span><span class="st">'Validation score'</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of trees'</span>)</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean test'</span>)</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Performance depending of the number of trees'</span>)</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the performance increases with the number of trees. From 20 trees, it seems to stabilize a bit.</p>
<ul>
<li>Try with SVMs - does the RBF kernel perform better than the linear one?</li>
</ul>
<p>I first try the linear SVM:</p>
<div id="cell-18" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>linear_svc <span class="op">=</span> LinearSVC()</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>linear_svc.fit(X_tr, Y_tr)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'SVC - val score </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(linear_svc.score(X_val,Y_val)))</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'SVC - test score </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(linear_svc.score(X_te,Y_te)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SVC - val score 0.906
SVC - test score 0.920</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'svm linear'</span>,<span class="st">'test_accuracy'</span>:linear_svc.score(X_te,Y_te)}</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then the RBF kernel:</p>
<div id="cell-23" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>rbf_svc_c1 <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">'rbf'</span>, C<span class="op">=</span><span class="dv">1</span>,gamma<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>rbf_svc_c1.fit(X_tr, Y_tr)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'SVC - val score </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(rbf_svc_c1.score(X_val,Y_val)))</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'SVC - test score </span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>(rbf_svc_c1.score(X_te,Y_te)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SVC - val score 0.921
SVC - test score 0.960</code></pre>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'svm rbf'</span>,<span class="st">'test_accuracy'</span>:rbf_svc_c1.score(X_te,Y_te)}</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The performance increases with the non linear classifier SVM.</p>
<p>I can try to vary the C value:</p>
<div id="cell-29" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>range_i <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">8</span>, <span class="dv">1</span>, num<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>scores_valid <span class="op">=</span> []</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>scores_test <span class="op">=</span> []</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> range_i:</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    rbf_svc_c1 <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">'rbf'</span>, C<span class="op">=</span>i ,gamma<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    rbf_svc_c1.fit(X_tr, Y_tr)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    scores_valid.append(rbf_svc_c1.score(X_val,Y_val))</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    scores_test.append(rbf_svc_c1.score(X_te,Y_te))</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>plt.plot(range_i, scores_test,label<span class="op">=</span><span class="st">'Test score'</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>plt.plot(range_i, scores_valid,label<span class="op">=</span><span class="st">'Validation score'</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'C'</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean test'</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Performance depending of C'</span>)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-6" href="..\..\Documents\ML\Course_4\06 Nonlinear classifiers-preview.html#cell-0">Source: 6. Nonlinear classifiers</a></section>
<section id="dense-networks" class="level1 quarto-embed-nb-cell">
<h1>7. Dense networks</h1>
<ul>
<li>1-layer dense network i.e.&nbsp;no hidden layer, just the input and output ones</li>
</ul>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> Sequential</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I create the model with 1 layer.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>model.add(Dense(<span class="dv">6</span>, activation<span class="op">=</span><span class="st">'softmax'</span>, input_dim<span class="op">=</span><span class="dv">1280</span>))</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 6)                 7686      
=================================================================
Total params: 7,686
Trainable params: 7,686
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> optimizers</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'sgd'</span>, loss<span class="op">=</span><span class="st">'sparse_categorical_crossentropy'</span>, metrics<span class="op">=</span>[<span class="st">'acc'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can now load the data sets.</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>X_tr, y<span class="op">=</span>Y_tr,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(X_val,Y_val), batch_size<span class="op">=</span><span class="dv">32</span>, epochs<span class="op">=</span><span class="dv">50</span>, shuffle<span class="op">=</span><span class="va">True</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train on 280 samples, validate on 139 samples
Epoch 1/50
280/280 [==============================] - 1s 2ms/step - loss: 1.4758 - acc: 0.4643 - val_loss: 1.0158 - val_acc: 0.7050
Epoch 2/50
280/280 [==============================] - 0s 67us/step - loss: 0.8911 - acc: 0.7393 - val_loss: 0.7403 - val_acc: 0.8058
Epoch 3/50
280/280 [==============================] - 0s 62us/step - loss: 0.6684 - acc: 0.8107 - val_loss: 0.6159 - val_acc: 0.8201
Epoch 4/50
280/280 [==============================] - 0s 66us/step - loss: 0.5402 - acc: 0.8714 - val_loss: 0.5278 - val_acc: 0.8561
Epoch 5/50
280/280 [==============================] - 0s 67us/step - loss: 0.4592 - acc: 0.9107 - val_loss: 0.4822 - val_acc: 0.8633
Epoch 6/50
280/280 [==============================] - 0s 71us/step - loss: 0.4017 - acc: 0.9107 - val_loss: 0.4404 - val_acc: 0.8777
Epoch 7/50
280/280 [==============================] - 0s 63us/step - loss: 0.3579 - acc: 0.9250 - val_loss: 0.4074 - val_acc: 0.8921
Epoch 8/50
280/280 [==============================] - 0s 62us/step - loss: 0.3232 - acc: 0.9286 - val_loss: 0.3888 - val_acc: 0.9137
Epoch 9/50
280/280 [==============================] - 0s 65us/step - loss: 0.2978 - acc: 0.9393 - val_loss: 0.3655 - val_acc: 0.8993
Epoch 10/50
280/280 [==============================] - 0s 62us/step - loss: 0.2755 - acc: 0.9464 - val_loss: 0.3547 - val_acc: 0.9065
Epoch 11/50
280/280 [==============================] - 0s 64us/step - loss: 0.2560 - acc: 0.9500 - val_loss: 0.3402 - val_acc: 0.9137
Epoch 12/50
280/280 [==============================] - 0s 63us/step - loss: 0.2405 - acc: 0.9500 - val_loss: 0.3341 - val_acc: 0.9065
Epoch 13/50
280/280 [==============================] - 0s 63us/step - loss: 0.2253 - acc: 0.9500 - val_loss: 0.3264 - val_acc: 0.9137
Epoch 14/50
280/280 [==============================] - 0s 64us/step - loss: 0.2132 - acc: 0.9536 - val_loss: 0.3154 - val_acc: 0.9065
Epoch 15/50
280/280 [==============================] - 0s 66us/step - loss: 0.2044 - acc: 0.9643 - val_loss: 0.3085 - val_acc: 0.9065
Epoch 16/50
280/280 [==============================] - 0s 115us/step - loss: 0.1929 - acc: 0.9643 - val_loss: 0.3079 - val_acc: 0.9065
Epoch 17/50
280/280 [==============================] - 0s 81us/step - loss: 0.1830 - acc: 0.9714 - val_loss: 0.2996 - val_acc: 0.9065
Epoch 18/50
280/280 [==============================] - 0s 82us/step - loss: 0.1743 - acc: 0.9679 - val_loss: 0.2954 - val_acc: 0.9065
Epoch 19/50
280/280 [==============================] - 0s 67us/step - loss: 0.1681 - acc: 0.9750 - val_loss: 0.2923 - val_acc: 0.9065
Epoch 20/50
280/280 [==============================] - 0s 96us/step - loss: 0.1612 - acc: 0.9786 - val_loss: 0.2897 - val_acc: 0.9065
Epoch 21/50
280/280 [==============================] - 0s 60us/step - loss: 0.1545 - acc: 0.9857 - val_loss: 0.2837 - val_acc: 0.9065
Epoch 22/50
280/280 [==============================] - 0s 60us/step - loss: 0.1487 - acc: 0.9857 - val_loss: 0.2784 - val_acc: 0.9065
Epoch 23/50
280/280 [==============================] - 0s 63us/step - loss: 0.1440 - acc: 0.9821 - val_loss: 0.2766 - val_acc: 0.9065
Epoch 24/50
280/280 [==============================] - 0s 63us/step - loss: 0.1388 - acc: 0.9857 - val_loss: 0.2764 - val_acc: 0.9065
Epoch 25/50
280/280 [==============================] - 0s 69us/step - loss: 0.1346 - acc: 0.9893 - val_loss: 0.2729 - val_acc: 0.9065
Epoch 26/50
280/280 [==============================] - 0s 61us/step - loss: 0.1295 - acc: 0.9893 - val_loss: 0.2716 - val_acc: 0.9065
Epoch 27/50
280/280 [==============================] - 0s 62us/step - loss: 0.1252 - acc: 0.9893 - val_loss: 0.2717 - val_acc: 0.9137
Epoch 28/50
280/280 [==============================] - 0s 64us/step - loss: 0.1216 - acc: 0.9929 - val_loss: 0.2709 - val_acc: 0.9065
Epoch 29/50
280/280 [==============================] - 0s 60us/step - loss: 0.1179 - acc: 0.9929 - val_loss: 0.2674 - val_acc: 0.9065
Epoch 30/50
280/280 [==============================] - 0s 62us/step - loss: 0.1149 - acc: 0.9929 - val_loss: 0.2679 - val_acc: 0.9065
Epoch 31/50
280/280 [==============================] - 0s 59us/step - loss: 0.1107 - acc: 0.9929 - val_loss: 0.2654 - val_acc: 0.9137
Epoch 32/50
280/280 [==============================] - 0s 60us/step - loss: 0.1082 - acc: 0.9929 - val_loss: 0.2624 - val_acc: 0.9065
Epoch 33/50
280/280 [==============================] - 0s 60us/step - loss: 0.1054 - acc: 0.9929 - val_loss: 0.2617 - val_acc: 0.9065
Epoch 34/50
280/280 [==============================] - 0s 65us/step - loss: 0.1024 - acc: 0.9929 - val_loss: 0.2609 - val_acc: 0.9065
Epoch 35/50
280/280 [==============================] - 0s 70us/step - loss: 0.1000 - acc: 0.9929 - val_loss: 0.2592 - val_acc: 0.9065
Epoch 36/50
280/280 [==============================] - 0s 64us/step - loss: 0.0977 - acc: 0.9929 - val_loss: 0.2586 - val_acc: 0.9137
Epoch 37/50
280/280 [==============================] - 0s 64us/step - loss: 0.0951 - acc: 0.9929 - val_loss: 0.2568 - val_acc: 0.9065
Epoch 38/50
280/280 [==============================] - 0s 64us/step - loss: 0.0930 - acc: 0.9929 - val_loss: 0.2566 - val_acc: 0.9065
Epoch 39/50
280/280 [==============================] - 0s 65us/step - loss: 0.0907 - acc: 0.9929 - val_loss: 0.2559 - val_acc: 0.9137
Epoch 40/50
280/280 [==============================] - 0s 62us/step - loss: 0.0885 - acc: 0.9929 - val_loss: 0.2567 - val_acc: 0.9137
Epoch 41/50
280/280 [==============================] - 0s 63us/step - loss: 0.0865 - acc: 0.9929 - val_loss: 0.2553 - val_acc: 0.9137
Epoch 42/50
280/280 [==============================] - 0s 62us/step - loss: 0.0846 - acc: 0.9929 - val_loss: 0.2545 - val_acc: 0.9137
Epoch 43/50
280/280 [==============================] - 0s 77us/step - loss: 0.0826 - acc: 0.9929 - val_loss: 0.2546 - val_acc: 0.9137
Epoch 44/50
280/280 [==============================] - 0s 70us/step - loss: 0.0811 - acc: 0.9929 - val_loss: 0.2552 - val_acc: 0.9137
Epoch 45/50
280/280 [==============================] - 0s 64us/step - loss: 0.0794 - acc: 0.9929 - val_loss: 0.2532 - val_acc: 0.9137
Epoch 46/50
280/280 [==============================] - 0s 69us/step - loss: 0.0778 - acc: 0.9929 - val_loss: 0.2538 - val_acc: 0.9137
Epoch 47/50
280/280 [==============================] - 0s 77us/step - loss: 0.0762 - acc: 0.9929 - val_loss: 0.2535 - val_acc: 0.9137
Epoch 48/50
280/280 [==============================] - 0s 75us/step - loss: 0.0747 - acc: 0.9929 - val_loss: 0.2518 - val_acc: 0.9137
Epoch 49/50
280/280 [==============================] - 0s 69us/step - loss: 0.0732 - acc: 0.9964 - val_loss: 0.2520 - val_acc: 0.9137
Epoch 50/50
280/280 [==============================] - 0s 64us/step - loss: 0.0718 - acc: 0.9964 - val_loss: 0.2508 - val_acc: 0.9137</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'loss'</span>], label<span class="op">=</span><span class="st">'train loss'</span>)</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'val_loss'</span>], label<span class="op">=</span><span class="st">'val loss'</span>)</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Validation loss </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_loss'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'loss value'</span>)</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'acc'</span>], label<span class="op">=</span><span class="st">'train acc'</span>)</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'val_acc'</span>], label<span class="op">=</span><span class="st">'val acc'</span>)</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Validation accuracy </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_acc'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>(test_loss, test_accuracy) <span class="op">=</span> model.evaluate(X_te, Y_te, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test loss: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(test_loss)) </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test accuracy: </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(<span class="dv">100</span><span class="op">*</span>test_accuracy)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>50/50 [==============================] - 0s 112us/step
Test loss: 0.21
Test accuracy: 92.00%</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'1-layer nn'</span>,<span class="st">'test_accuracy'</span>:<span class="bu">round</span>(test_accuracy,<span class="dv">2</span>)}</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>2-layer dense network i.e.&nbsp;one hidden layer</li>
</ul>
<p>I create the model with 2 layers:</p>
<div id="cell-17" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> Sequential()</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>model_2.add(Dense(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">'relu'</span>, input_dim<span class="op">=</span><span class="dv">1280</span>))</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>model_2.add(Dense(<span class="dv">6</span>, activation<span class="op">=</span><span class="st">'softmax'</span>))</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>model_2.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense_1 (Dense)              (None, 50)                64050     
_________________________________________________________________
dense_2 (Dense)              (None, 6)                 306       
=================================================================
Total params: 64,356
Trainable params: 64,356
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>model_2.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">'sgd'</span>, loss<span class="op">=</span><span class="st">'sparse_categorical_crossentropy'</span>, metrics<span class="op">=</span>[<span class="st">'acc'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model_2.fit(</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>X_tr, y<span class="op">=</span>Y_tr,</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(X_val,Y_val), batch_size<span class="op">=</span><span class="dv">32</span>, epochs<span class="op">=</span><span class="dv">50</span>, shuffle<span class="op">=</span><span class="va">True</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train on 280 samples, validate on 139 samples
Epoch 1/50
280/280 [==============================] - 1s 2ms/step - loss: 1.5272 - acc: 0.4214 - val_loss: 1.0659 - val_acc: 0.7122
Epoch 2/50
280/280 [==============================] - 0s 116us/step - loss: 0.9486 - acc: 0.7500 - val_loss: 0.7731 - val_acc: 0.7986
Epoch 3/50
280/280 [==============================] - 0s 118us/step - loss: 0.6889 - acc: 0.8179 - val_loss: 0.6228 - val_acc: 0.8201
Epoch 4/50
280/280 [==============================] - 0s 121us/step - loss: 0.5490 - acc: 0.8607 - val_loss: 0.5392 - val_acc: 0.8489
Epoch 5/50
280/280 [==============================] - 0s 120us/step - loss: 0.4590 - acc: 0.8893 - val_loss: 0.4809 - val_acc: 0.8561
Epoch 6/50
280/280 [==============================] - 0s 117us/step - loss: 0.3946 - acc: 0.8964 - val_loss: 0.4423 - val_acc: 0.8561
Epoch 7/50
280/280 [==============================] - 0s 118us/step - loss: 0.3472 - acc: 0.9250 - val_loss: 0.4130 - val_acc: 0.8849
Epoch 8/50
280/280 [==============================] - 0s 119us/step - loss: 0.3116 - acc: 0.9214 - val_loss: 0.3899 - val_acc: 0.8849
Epoch 9/50
280/280 [==============================] - 0s 120us/step - loss: 0.2860 - acc: 0.9321 - val_loss: 0.3731 - val_acc: 0.8921
Epoch 10/50
280/280 [==============================] - 0s 124us/step - loss: 0.2567 - acc: 0.9464 - val_loss: 0.3563 - val_acc: 0.9065
Epoch 11/50
280/280 [==============================] - 0s 119us/step - loss: 0.2345 - acc: 0.9500 - val_loss: 0.3431 - val_acc: 0.9065
Epoch 12/50
280/280 [==============================] - 0s 121us/step - loss: 0.2162 - acc: 0.9643 - val_loss: 0.3340 - val_acc: 0.9065
Epoch 13/50
280/280 [==============================] - 0s 118us/step - loss: 0.2006 - acc: 0.9679 - val_loss: 0.3238 - val_acc: 0.9065
Epoch 14/50
280/280 [==============================] - 0s 125us/step - loss: 0.1876 - acc: 0.9679 - val_loss: 0.3161 - val_acc: 0.8993
Epoch 15/50
280/280 [==============================] - 0s 114us/step - loss: 0.1755 - acc: 0.9714 - val_loss: 0.3101 - val_acc: 0.9065
Epoch 16/50
280/280 [==============================] - 0s 124us/step - loss: 0.1648 - acc: 0.9786 - val_loss: 0.3042 - val_acc: 0.9065
Epoch 17/50
280/280 [==============================] - 0s 122us/step - loss: 0.1557 - acc: 0.9821 - val_loss: 0.3002 - val_acc: 0.9065
Epoch 18/50
280/280 [==============================] - 0s 121us/step - loss: 0.1465 - acc: 0.9893 - val_loss: 0.2954 - val_acc: 0.9065
Epoch 19/50
280/280 [==============================] - 0s 117us/step - loss: 0.1393 - acc: 0.9857 - val_loss: 0.2928 - val_acc: 0.8993
Epoch 20/50
280/280 [==============================] - 0s 117us/step - loss: 0.1322 - acc: 0.9893 - val_loss: 0.2892 - val_acc: 0.8993
Epoch 21/50
280/280 [==============================] - 0s 134us/step - loss: 0.1253 - acc: 0.9929 - val_loss: 0.2857 - val_acc: 0.9065
Epoch 22/50
280/280 [==============================] - 0s 119us/step - loss: 0.1200 - acc: 0.9929 - val_loss: 0.2846 - val_acc: 0.8993
Epoch 23/50
280/280 [==============================] - 0s 117us/step - loss: 0.1151 - acc: 0.9893 - val_loss: 0.2826 - val_acc: 0.8993
Epoch 24/50
280/280 [==============================] - 0s 117us/step - loss: 0.1098 - acc: 0.9929 - val_loss: 0.2800 - val_acc: 0.8993
Epoch 25/50
280/280 [==============================] - 0s 116us/step - loss: 0.1048 - acc: 0.9929 - val_loss: 0.2791 - val_acc: 0.8993
Epoch 26/50
280/280 [==============================] - 0s 119us/step - loss: 0.1013 - acc: 0.9929 - val_loss: 0.2773 - val_acc: 0.8993
Epoch 27/50
280/280 [==============================] - 0s 119us/step - loss: 0.0978 - acc: 0.9929 - val_loss: 0.2780 - val_acc: 0.8993
Epoch 28/50
280/280 [==============================] - 0s 118us/step - loss: 0.0953 - acc: 0.9929 - val_loss: 0.2763 - val_acc: 0.8993
Epoch 29/50
280/280 [==============================] - 0s 133us/step - loss: 0.0901 - acc: 0.9929 - val_loss: 0.2758 - val_acc: 0.8993
Epoch 30/50
280/280 [==============================] - 0s 135us/step - loss: 0.0866 - acc: 0.9929 - val_loss: 0.2745 - val_acc: 0.8993
Epoch 31/50
280/280 [==============================] - 0s 361us/step - loss: 0.0840 - acc: 0.9929 - val_loss: 0.2719 - val_acc: 0.9065
Epoch 32/50
280/280 [==============================] - 0s 129us/step - loss: 0.0814 - acc: 0.9929 - val_loss: 0.2717 - val_acc: 0.9065
Epoch 33/50
280/280 [==============================] - 0s 121us/step - loss: 0.0784 - acc: 0.9929 - val_loss: 0.2721 - val_acc: 0.8993
Epoch 34/50
280/280 [==============================] - 0s 103us/step - loss: 0.0758 - acc: 0.9929 - val_loss: 0.2722 - val_acc: 0.8993
Epoch 35/50
280/280 [==============================] - 0s 121us/step - loss: 0.0732 - acc: 0.9929 - val_loss: 0.2702 - val_acc: 0.9065
Epoch 36/50
280/280 [==============================] - 0s 119us/step - loss: 0.0711 - acc: 0.9929 - val_loss: 0.2701 - val_acc: 0.9065
Epoch 37/50
280/280 [==============================] - 0s 118us/step - loss: 0.0695 - acc: 0.9929 - val_loss: 0.2688 - val_acc: 0.9065
Epoch 38/50
280/280 [==============================] - 0s 119us/step - loss: 0.0670 - acc: 0.9929 - val_loss: 0.2686 - val_acc: 0.9065
Epoch 39/50
280/280 [==============================] - 0s 131us/step - loss: 0.0646 - acc: 0.9964 - val_loss: 0.2692 - val_acc: 0.9065
Epoch 40/50
280/280 [==============================] - 0s 112us/step - loss: 0.0634 - acc: 0.9964 - val_loss: 0.2677 - val_acc: 0.9065
Epoch 41/50
280/280 [==============================] - 0s 108us/step - loss: 0.0607 - acc: 0.9964 - val_loss: 0.2677 - val_acc: 0.9065
Epoch 42/50
280/280 [==============================] - 0s 121us/step - loss: 0.0599 - acc: 0.9964 - val_loss: 0.2676 - val_acc: 0.9065
Epoch 43/50
280/280 [==============================] - 0s 114us/step - loss: 0.0577 - acc: 0.9964 - val_loss: 0.2676 - val_acc: 0.9065
Epoch 44/50
280/280 [==============================] - 0s 108us/step - loss: 0.0561 - acc: 0.9964 - val_loss: 0.2676 - val_acc: 0.9065
Epoch 45/50
280/280 [==============================] - 0s 124us/step - loss: 0.0549 - acc: 0.9964 - val_loss: 0.2662 - val_acc: 0.9065
Epoch 46/50
280/280 [==============================] - 0s 131us/step - loss: 0.0533 - acc: 0.9964 - val_loss: 0.2658 - val_acc: 0.9065
Epoch 47/50
280/280 [==============================] - 0s 106us/step - loss: 0.0520 - acc: 0.9964 - val_loss: 0.2662 - val_acc: 0.9065
Epoch 48/50
280/280 [==============================] - 0s 126us/step - loss: 0.0508 - acc: 0.9964 - val_loss: 0.2664 - val_acc: 0.9065
Epoch 49/50
280/280 [==============================] - 0s 113us/step - loss: 0.0495 - acc: 0.9964 - val_loss: 0.2659 - val_acc: 0.9065
Epoch 50/50
280/280 [==============================] - 0s 122us/step - loss: 0.0484 - acc: 0.9964 - val_loss: 0.2661 - val_acc: 0.9065</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'loss'</span>], label<span class="op">=</span><span class="st">'train loss'</span>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'val_loss'</span>], label<span class="op">=</span><span class="st">'val loss'</span>)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Validation loss </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_loss'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'loss value'</span>)</span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'acc'</span>], label<span class="op">=</span><span class="st">'train acc'</span>)</span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'val_acc'</span>], label<span class="op">=</span><span class="st">'val acc'</span>)</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Validation accuracy </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_acc'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>(test_loss, test_accuracy) <span class="op">=</span> model_2.evaluate(X_te, Y_te, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test loss: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(test_loss)) </span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test accuracy: </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(<span class="dv">100</span><span class="op">*</span>test_accuracy)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>50/50 [==============================] - 0s 152us/step
Test loss: 0.20
Test accuracy: 94.00%</code></pre>
</div>
</div>
<p>It improves a bit the test accuracy.</p>
<div id="cell-23" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'2-layer nn'</span>,<span class="st">'test_accuracy'</span>:<span class="bu">round</span>(test_accuracy,<span class="dv">2</span>)}</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<a class="quarto-notebook-link" id="nblink-7" href="..\..\Documents\ML\Course_4\07 Dense networks-preview.html#cell-0">Source: 7. Dense networks</a></section>
<section id="convnets" class="level1 quarto-embed-nb-cell">
<h1>8. Convnets</h1>
<ul>
<li>What accuracy can you achieve?</li>
</ul>
<p>I first load the datasets.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'trainset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    X_tr <span class="op">=</span> npz_file[<span class="st">'train_feature'</span>]</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    Y_tr <span class="op">=</span> npz_file[<span class="st">'train_label'</span>]</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    names_tr <span class="op">=</span> npz_file[<span class="st">'train_name'</span>]</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    images_tr <span class="op">=</span> npz_file[<span class="st">'train_image'</span>]</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'validset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    X_val <span class="op">=</span> npz_file[<span class="st">'valid_feature'</span>]</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>    Y_val <span class="op">=</span> npz_file[<span class="st">'valid_label'</span>]</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>    names_val <span class="op">=</span> npz_file[<span class="st">'valid_name'</span>]</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    images_val <span class="op">=</span> npz_file[<span class="st">'valid_image'</span>]</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.load(<span class="st">'testset.npz'</span>, allow_pickle<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> npz_file:</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    X_te <span class="op">=</span> npz_file[<span class="st">'test_feature'</span>]</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    Y_te <span class="op">=</span> npz_file[<span class="st">'test_label'</span>]</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>    names_te <span class="op">=</span> npz_file[<span class="st">'test_name'</span>]</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a>    images_te <span class="op">=</span> npz_file[<span class="st">'test_image'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>images_tr.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>(280, 224, 224, 3)</code></pre>
</div>
</div>
<p>The shape is different now: 280 images, 224 pixels in length and width and 3 for the RBF colors.</p>
<p>So I have to work with the images directly and not with the features.</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow.keras <span class="im">as</span> keras</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.Conv2D(filters<span class="op">=</span><span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">5</span>, strides<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>                              activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(<span class="dv">224</span>, <span class="dv">224</span>, <span class="dv">3</span>)))</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.MaxPool2D(pool_size<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.Conv2D(filters<span class="op">=</span><span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, strides<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>                              activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.MaxPool2D(pool_size<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.Flatten())</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>model.add(keras.layers.Dense(units<span class="op">=</span><span class="bu">len</span>(names_tr), activation<span class="op">=</span><span class="st">'softmax'</span>))</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 110, 110, 64)      4864      
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 55, 55, 64)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 53, 53, 64)        36928     
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 26, 26, 64)        0         
_________________________________________________________________
flatten (Flatten)            (None, 43264)             0         
_________________________________________________________________
dense (Dense)                (None, 6)                 259590    
=================================================================
Total params: 301,382
Trainable params: 301,382
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>keras.optimizers.Adam(), loss<span class="op">=</span><span class="st">'sparse_categorical_crossentropy'</span>, metrics<span class="op">=</span>[<span class="st">'acc'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>early_stopping <span class="op">=</span> keras.callbacks.EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, patience<span class="op">=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  x<span class="op">=</span>images_tr, y<span class="op">=</span>Y_tr, validation_data<span class="op">=</span>(images_val,Y_val),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">32</span>, epochs<span class="op">=</span><span class="dv">50</span>, shuffle<span class="op">=</span><span class="va">False</span>, callbacks<span class="op">=</span>[early_stopping]</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train on 280 samples, validate on 139 samples
Epoch 1/50
280/280 [==============================] - 6s 21ms/step - loss: 1.8190 - acc: 0.2500 - val_loss: 1.7580 - val_acc: 0.2302
Epoch 2/50
280/280 [==============================] - 4s 13ms/step - loss: 1.6767 - acc: 0.3286 - val_loss: 1.6980 - val_acc: 0.2302
Epoch 3/50
280/280 [==============================] - 4s 14ms/step - loss: 1.5277 - acc: 0.3500 - val_loss: 1.6350 - val_acc: 0.2734
Epoch 4/50
280/280 [==============================] - 4s 13ms/step - loss: 1.2265 - acc: 0.5464 - val_loss: 1.6170 - val_acc: 0.3381
Epoch 5/50
280/280 [==============================] - 4s 14ms/step - loss: 0.8568 - acc: 0.6679 - val_loss: 1.5506 - val_acc: 0.4101
Epoch 6/50
280/280 [==============================] - 4s 14ms/step - loss: 0.6211 - acc: 0.8000 - val_loss: 1.4878 - val_acc: 0.4748
Epoch 7/50
280/280 [==============================] - 4s 14ms/step - loss: 0.3643 - acc: 0.8821 - val_loss: 1.6023 - val_acc: 0.4604
Epoch 8/50
280/280 [==============================] - 4s 15ms/step - loss: 0.1790 - acc: 0.9821 - val_loss: 2.0222 - val_acc: 0.4317
Epoch 9/50
280/280 [==============================] - 4s 15ms/step - loss: 0.0766 - acc: 0.9929 - val_loss: 2.0663 - val_acc: 0.4245
Epoch 10/50
280/280 [==============================] - 4s 13ms/step - loss: 0.0337 - acc: 0.9964 - val_loss: 1.9994 - val_acc: 0.4460
Epoch 11/50
280/280 [==============================] - 4s 13ms/step - loss: 0.0141 - acc: 1.0000 - val_loss: 2.0683 - val_acc: 0.4460
Epoch 12/50
280/280 [==============================] - 4s 13ms/step - loss: 0.0062 - acc: 1.0000 - val_loss: 2.2585 - val_acc: 0.4317</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'loss'</span>], label<span class="op">=</span><span class="st">'train loss'</span>)</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(history.history[<span class="st">'val_loss'</span>], label<span class="op">=</span><span class="st">'val loss'</span>)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Validation loss </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_loss'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'loss value'</span>)</span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'acc'</span>], label<span class="op">=</span><span class="st">'train acc'</span>)</span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(history.history[<span class="st">'val_acc'</span>], label<span class="op">=</span><span class="st">'val acc'</span>)</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Validation accuracy </span><span class="sc">{:.3f}</span><span class="st"> (mean last 3)'</span>.<span class="bu">format</span>(</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>    np.mean(history.history[<span class="st">'val_acc'</span>][<span class="op">-</span><span class="dv">3</span>:]) </span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'epoch'</span>)</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>(test_loss, test_accuracy) <span class="op">=</span> model.evaluate(images_te, Y_te, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test loss: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(test_loss)) </span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test accuracy: </span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(<span class="dv">100</span><span class="op">*</span>test_accuracy)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>50/50 [==============================] - 0s 6ms/step
Test loss: 2.27
Test accuracy: 42.00%</code></pre>
</div>
</div>
<p>I have an accuracy of 40-50% which is quite bad results.</p>
<div id="cell-15" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>new_row <span class="op">=</span> {<span class="st">'model'</span>:<span class="st">'cnn'</span>,<span class="st">'test_accuracy'</span>:<span class="bu">round</span>(test_accuracy,<span class="dv">2</span>)}</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.append(new_row,ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>Results.to_csv(<span class="vs">r"Results.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Can you get good results? - If not, why?</li>
</ul>
<p>I could maybe have better results if I try to tune a bit the model (kernel size, padding, number of layers, etc.) but it could not be better than the other models. This is because the other models has been pre-trained with the high level features on a much bigger dataset than this one.</p>
<a class="quarto-notebook-link" id="nblink-8" href="..\..\Documents\ML\Course_4\08 Convnets-preview.html#cell-0">Source: 8. Convnets</a></section>
<section id="resultls" class="level1 quarto-embed-nb-cell">
<h1>9. Resultls</h1>
<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> pd.read_csv(<span class="st">'Results.csv'</span>).drop(<span class="st">'Unnamed: 0'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>Results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">test_accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>k-NN</td>
<td>0.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>decision tree</td>
<td>0.74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>logistic</td>
<td>0.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>random forest</td>
<td>0.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>svm linear</td>
<td>0.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>svm rbf</td>
<td>0.96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1-layer nn</td>
<td>0.92</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2-layer nn</td>
<td>0.94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>cnn</td>
<td>0.42</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>Results <span class="op">=</span> Results.sort_values(<span class="st">'test_accuracy'</span>)</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>plt.bar(Results.model,Results.test_accuracy,color<span class="op">=</span><span class="st">'lightsalmon'</span>)</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Model type'</span>)</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Test accuracy'</span>)</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Performance of the different models'</span>)</span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="projet_5_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-9" href="..\..\Documents\ML\Course_4\09 Results-preview.html#cell-0">Source: 9. Resultls</a></section>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2023, Grégoire Urvoy</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>